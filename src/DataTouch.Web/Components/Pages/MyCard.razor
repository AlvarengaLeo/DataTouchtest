@page "/cards/mine"
@attribute [Authorize]
@inject DataTouchDbContext DbContext
@inject AuthService AuthService
@inject ISnackbar Snackbar
@inject NavigationManager Navigation
@inject IWebHostEnvironment Environment
@inject IJSRuntime JSRuntime
@using System.Text.Json
@using System.IO
@using DataTouch.Web.Models

<PageTitle>Mi Tarjeta - DataTouch</PageTitle>

@if (_isLoading)
{
    <MudProgressLinear Color="Color.Primary" Indeterminate="true" />
}
else if (_card == null)
{
    <MudAlert Severity="Severity.Warning">No tienes una tarjeta asignada.</MudAlert>
}
else
{
    <div class="mycard-container">
        @* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PAGE HEADER - PREMIUM ENTERPRISE STYLE
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• *@
        <header class="page-header">
            <div class="header-content">
                <div class="header-icon">
                    <MudIcon Icon="@Icons.Material.Filled.Person" Size="Size.Large" />
                </div>
                <div class="header-text">
                    <h1 class="header-title">Perfil PÃºblico</h1>
                    <p class="header-subtitle">Tu identidad digital profesional</p>
                </div>
            </div>
            @* Save Status Indicator *@
            <div class="save-status">
                @if (_isSaving)
                {
                    <div class="status-indicator status-saving">
                        <MudProgressCircular Size="Size.Small" Indeterminate="true" Color="Color.Primary" />
                        <span>Guardando...</span>
                    </div>
                }
                else if (_hasUnsavedChanges)
                {
                    <div class="status-indicator status-unsaved">
                        <MudIcon Icon="@Icons.Material.Filled.Edit" Size="Size.Small" />
                        <span>Cambios sin guardar</span>
                    </div>
                }
                else
                {
                    <div class="status-indicator status-saved">
                        <MudIcon Icon="@Icons.Material.Filled.CheckCircle" Size="Size.Small" />
                        <span>Guardado</span>
                        @if (_card.UpdatedAt.HasValue)
                        {
                            <span class="last-updated">Â· @FormatLastUpdated(_card.UpdatedAt.Value)</span>
                        }
                    </div>
                }
            </div>
        </header>

        <div class="editor-layout">
            @* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
               LEFT COLUMN: FORM EDITOR
               â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• *@
            <main class="editor-main">

                @* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                   LEVEL 2 (COLLAPSIBLE): APARIENCIA
                   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ *@
                <section class="section-card section-level-2 section-appearance">
                    <div class="section-header section-header-collapsible" @onclick="ToggleAppearanceSection">
                        <div class="section-icon icon-appearance">
                            <MudIcon Icon="@Icons.Material.Filled.Palette" Size="Size.Medium" />
                        </div>
                        <div class="section-header-text">
                            <h2 class="section-title">Apariencia</h2>
                            <p class="section-description">Personaliza el fondo y el estilo visual de tu tarjeta pÃºblica.</p>
                        </div>
                        <div class="appearance-chips-summary">
                            <span class="summary-chip">Fondo: @GetBackgroundSummary()</span>
                            <span class="summary-chip">Tarjeta: @GetCardSummary()</span>
                            <span class="summary-chip">Acciones: @GetButtonsSummary()</span>
                        </div>
                        <MudIcon Icon="@(_appearanceSectionExpanded ? Icons.Material.Filled.ExpandLess : Icons.Material.Filled.ExpandMore)" 
                                 Size="Size.Medium" 
                                 Class="section-collapse-icon" />
                    </div>
                    <MudCollapse Expanded="_appearanceSectionExpanded">
                        <div class="section-content appearance-content">
                            @* PRESETS RECOMENDADOS - CATEGORIZED *@
                            <div class="appearance-block appearance-presets-block">
                                <h3 class="appearance-block-title">Elige tu estilo</h3>
                                
                                @* DARK PRESETS *@
                                <div class="preset-category">
                                    <span class="preset-category-label">
                                        <MudIcon Icon="@Icons.Material.Filled.DarkMode" Size="Size.Small" />
                                        Oscuros
                                    </span>
                                    <div class="appearance-presets-grid">
                                        @foreach (var preset in _presets.Where(p => p.Category == "dark"))
                                        {
                                            <MudTooltip Text="@preset.Personality" Placement="Placement.Top" Arrow="true">
                                                <div class="appearance-preset-card @(preset.Id == _selectedPreset ? "selected" : "")" 
                                                     @onclick="() => ApplyPreset(preset.Id)">
                                                    <div class="preset-preview" style="background: @preset.BackgroundValue;">
                                                        <div class="preset-accent-dot" style="background: @preset.AccentColor;"></div>
                                                    </div>
                                                    <span class="preset-name">@preset.Name</span>
                                                    @if (preset.Id == _selectedPreset)
                                                    {
                                                        <span class="preset-check">
                                                            <MudIcon Icon="@Icons.Material.Filled.Check" Size="Size.Small" />
                                                        </span>
                                                    }
                                                </div>
                                            </MudTooltip>
                                        }
                                    </div>
                                </div>
                                
                                @* LIGHT PRESETS *@
                                <div class="preset-category">
                                    <span class="preset-category-label">
                                        <MudIcon Icon="@Icons.Material.Filled.LightMode" Size="Size.Small" />
                                        Claros
                                    </span>
                                    <div class="appearance-presets-grid">
                                        @foreach (var preset in _presets.Where(p => p.Category == "light"))
                                        {
                                            <MudTooltip Text="@preset.Personality" Placement="Placement.Top" Arrow="true">
                                                <div class="appearance-preset-card light @(preset.Id == _selectedPreset ? "selected" : "")" 
                                                     @onclick="() => ApplyPreset(preset.Id)">
                                                    <div class="preset-preview" style="background: @preset.BackgroundValue;">
                                                        <div class="preset-accent-dot" style="background: @preset.AccentColor;"></div>
                                                    </div>
                                                    <span class="preset-name">@preset.Name</span>
                                                    @if (preset.Id == _selectedPreset)
                                                    {
                                                        <span class="preset-check light">
                                                            <MudIcon Icon="@Icons.Material.Filled.Check" Size="Size.Small" />
                                                        </span>
                                                    }
                                                </div>
                                            </MudTooltip>
                                        }
                                    </div>
                                </div>
                            </div>

                            @* FONDO (SIMPLIFICADO: COLORES / IMAGEN) *@
                            <div class="appearance-options-simple">
                                <div class="appearance-block appearance-block-full">
                                    <h3 class="appearance-block-title">Fondo</h3>
                                    <div class="segment-selector segment-selector-centered">
                                        <button class="segment-btn @(_cardStyle.BackgroundType != "image" ? "active" : "")" 
                                                @onclick="SetBackgroundColores">
                                            <MudIcon Icon="@Icons.Material.Filled.Palette" Size="Size.Small" />
                                            Colores
                                        </button>
                                        <button class="segment-btn @(_cardStyle.BackgroundType == "image" ? "active" : "")" 
                                                @onclick="SetBackgroundImage">
                                            <MudIcon Icon="@Icons.Material.Filled.Image" Size="Size.Small" />
                                            Imagen
                                        </button>
                                    </div>
                                    @if (_cardStyle.BackgroundType == "image")
                                    {
                                        <div class="image-upload-section">
                                            <MudFileUpload T="IBrowserFile" 
                                                           FilesChanged="UploadBackgroundImage" 
                                                           Accept="image/png,image/jpeg,image/webp"
                                                           Class="mt-3">
                                                <ActivatorContent>
                                                    <MudButton Variant="Variant.Outlined" 
                                                               Color="Color.Primary" 
                                                               StartIcon="@Icons.Material.Filled.Upload"
                                                               Size="Size.Small">
                                                        Subir imagen
                                                    </MudButton>
                                                </ActivatorContent>
                                            </MudFileUpload>
                                        </div>
                                    }
                                </div>
                            </div>

                            @* FOOTER CON RESTAURAR *@
                            <div class="appearance-footer">
                                <button class="reset-link" @onclick="ResetAppearanceToDefault">
                                    <MudIcon Icon="@Icons.Material.Filled.RestartAlt" Size="Size.Small" />
                                    <span>Restaurar</span>
                                </button>
                            </div>
                        </div>
                    </MudCollapse>
                </section>


                @* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                   LEVEL 1: IDENTIDAD - Unified with Profile Photo (Collapsible)
                   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ *@
                <section class="section-card section-level-1 identity-unified">
                    <div class="section-header identity-header-with-avatar section-header-collapsible" @onclick="() => _identitySectionExpanded = !_identitySectionExpanded">
                        @* Left: Icon + Title *@
                        <div class="section-header-left">
                            <div class="section-icon icon-identity">
                                <MudIcon Icon="@Icons.Material.Filled.Badge" Size="Size.Medium" />
                            </div>
                            <div class="section-header-text">
                                <h2 class="section-title">Identidad</h2>
                                <p class="section-description">CÃ³mo te verÃ¡n en tu tarjeta pÃºblica</p>
                            </div>
                        </div>
                        
                        @* Right: Avatar with Change Photo Button *@
                        <div class="identity-avatar-section" @onclick:stopPropagation="true">
                            <div class="identity-avatar-container">
                                <div class="identity-avatar-glow">
                                    @if (!string.IsNullOrEmpty(_card.ProfileImageUrl))
                                    {
                                        <div class="identity-avatar identity-avatar-image">
                                            <img src="@_card.ProfileImageUrl" alt="@_card.FullName" />
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="identity-avatar identity-avatar-initials">
                                            <span>@GetInitials(_card.FullName)</span>
                                        </div>
                                    }
                                </div>
                                @* Camera Icon Overlay *@
                                <MudFileUpload T="IBrowserFile" 
                                               FilesChanged="UploadFiles" 
                                               Accept="image/png,image/jpeg,image/webp"
                                               Class="avatar-camera-overlay">
                                    <ActivatorContent>
                                        <button class="camera-btn" title="Cambiar foto">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                                                <circle cx="12" cy="13" r="4"/>
                                            </svg>
                                        </button>
                                    </ActivatorContent>
                                </MudFileUpload>
                            </div>
                            
                            @* Change/Upload Photo Button *@
                            <MudFileUpload T="IBrowserFile" 
                                           FilesChanged="UploadFiles" 
                                           Accept="image/png,image/jpeg,image/webp"
                                           Class="change-photo-upload">
                                <ActivatorContent>
                                    <MudButton Variant="Variant.Filled" 
                                               Color="Color.Primary" 
                                               StartIcon="@Icons.Material.Filled.CameraAlt"
                                               Disabled="@_isUploading"
                                               Class="change-photo-btn"
                                               Size="Size.Small">
                                        @if (_isUploading)
                                        {
                                            <MudProgressCircular Size="Size.Small" Indeterminate="true" Color="Color.Inherit" Class="mr-1" />
                                            <span>Subiendo...</span>
                                        }
                                        else
                                        {
                                            <span>@(string.IsNullOrEmpty(_card.ProfileImageUrl) ? "Subir foto" : "Cambiar foto")</span>
                                        }
                                    </MudButton>
                                </ActivatorContent>
                            </MudFileUpload>
                        </div>
                        
                        @* Collapse icon *@
                        <MudIcon Icon="@(_identitySectionExpanded ? Icons.Material.Filled.ExpandLess : Icons.Material.Filled.ExpandMore)" 
                                 Class="section-collapse-icon" />
                    </div>
                    
                    <MudCollapse Expanded="_identitySectionExpanded">
                        <div class="section-content">
                        <div class="form-grid identity-form-grid">
                            <div class="form-row">
                                <MudTextField @bind-Value="_card.FullName" 
                                              Label="Nombre completo" 
                                              Variant="Variant.Outlined" 
                                              Required="true" 
                                              Immediate="true"
                                              @oninput="MarkUnsaved" />
                            </div>
                            <div class="form-row">
                                <MudTextField @bind-Value="_card.Title" 
                                              Label="Puesto o cargo" 
                                              Variant="Variant.Outlined" 
                                              Immediate="true"
                                              Placeholder="Ej: Director Comercial"
                                              @oninput="MarkUnsaved" />
                            </div>
                            <div class="form-row form-row-full">
                                <MudTextField @bind-Value="_card.CompanyName" 
                                              Label="Empresa" 
                                              Variant="Variant.Outlined" 
                                              Immediate="true"
                                              HelperText="Deja vacÃ­o para usar el nombre de tu organizaciÃ³n"
                                              @oninput="MarkUnsaved" />
                            </div>
                            <div class="form-row form-row-full">
                                <MudTextField @bind-Value="_card.Bio" 
                                              Label="BiografÃ­a" 
                                              Variant="Variant.Outlined" 
                                              Lines="3"
                                              Immediate="true"
                                              Counter="300" 
                                              MaxLength="300"
                                              HelperText="@GetBioFeedback()"
                                              @oninput="MarkUnsaved" />
                                <p class="bio-warning">
                                    <MudIcon Icon="@Icons.Material.Filled.Visibility" Size="Size.Small" />
                                    Este texto serÃ¡ visible pÃºblicamente
                                </p>
                            </div>
                        </div>
                        </div>
                    </MudCollapse>
                </section>

                @* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                   LEVEL 2: CONTACT INFORMATION (Collapsible)
                   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ *@
                <section class="section-card section-level-2">
                    <div class="section-header section-header-collapsible" @onclick="() => _contactSectionExpanded = !_contactSectionExpanded">
                        <div class="section-icon icon-contact">
                            <MudIcon Icon="@Icons.Material.Filled.ContactPhone" Size="Size.Medium" />
                        </div>
                        <div class="section-header-text">
                            <h2 class="section-title">InformaciÃ³n de contacto</h2>
                            <p class="section-description">CÃ³mo te pueden contactar</p>
                        </div>
                        <MudIcon Icon="@(_contactSectionExpanded ? Icons.Material.Filled.ExpandLess : Icons.Material.Filled.ExpandMore)" 
                                 Class="section-collapse-icon" />
                    </div>
                    <MudCollapse Expanded="_contactSectionExpanded">
                        <div class="section-content">
                            <div class="form-grid">
                                <div class="form-row form-row-full">
                                    <MudTextField @bind-Value="_card.Email" 
                                                  Label="Email" 
                                                  Variant="Variant.Outlined" 
                                                  InputType="InputType.Email"
                                                  @oninput="MarkUnsaved" />
                                </div>
                                
                                @* Phone with Country Selector *@
                                <div class="form-row phone-row">
                                    <MudSelect T="string" 
                                               @bind-Value="_card.PhoneCountryCode" 
                                               Label="PaÃ­s" 
                                               Variant="Variant.Outlined" 
                                               Class="country-select"
                                               AnchorOrigin="Origin.BottomCenter">
                                        @foreach (var country in _countries)
                                        {
                                            <MudSelectItem Value="@country.Code">
                                                <div class="country-option">
                                                    <span class="country-flag">@country.Flag</span>
                                                    <span class="country-code">@country.Code</span>
                                                </div>
                                            </MudSelectItem>
                                        }
                                    </MudSelect>
                                    <MudTextField @bind-Value="_card.Phone" 
                                                  Label="TelÃ©fono (llamadas)" 
                                                  Variant="Variant.Outlined"
                                                  MaxLength="@GetPhoneMaxLength()"
                                                  Immediate="true"
                                                  Class="phone-input"
                                                  @oninput="MarkUnsaved" />
                                </div>

                                @* WhatsApp with Country Selector *@
                                <div class="form-row phone-row">
                                    <MudSelect T="string" 
                                               @bind-Value="_card.WhatsAppCountryCode" 
                                               Label="PaÃ­s" 
                                               Variant="Variant.Outlined" 
                                               Class="country-select"
                                               AnchorOrigin="Origin.BottomCenter">
                                        @foreach (var country in _countries)
                                        {
                                            <MudSelectItem Value="@country.Code">
                                                <div class="country-option">
                                                    <span class="country-flag">@country.Flag</span>
                                                    <span class="country-code">@country.Code</span>
                                                </div>
                                            </MudSelectItem>
                                        }
                                    </MudSelect>
                                    <MudTextField @bind-Value="_card.WhatsAppNumber" 
                                                  Label="WhatsApp (mensajes)" 
                                                  Variant="Variant.Outlined"
                                                  MaxLength="@GetWhatsAppMaxLength()"
                                                  Immediate="true"
                                                  Class="phone-input"
                                                  @oninput="MarkUnsaved" />
                                </div>
                            </div>
                        </div>
                    </MudCollapse>
                </section>

                @* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                   LEVEL 2 (COLLAPSIBLE): ACTION BUTTONS
                   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ *@
                <section class="section-card section-level-2">
                    <div class="section-header section-header-collapsible" @onclick="ToggleActionButtonsSection">
                        <div class="section-icon icon-cta">
                            <MudIcon Icon="@Icons.Material.Filled.TouchApp" Size="Size.Medium" />
                        </div>
                        <div class="section-header-text">
                            <h2 class="section-title">Botones de acciÃ³n</h2>
                            <p class="section-description">
                                @{
                                    var activeButtons = CountActiveButtons();
                                    <span>@activeButtons botones activos</span>
                                }
                            </p>
                        </div>
                        <MudIcon Icon="@(_actionButtonsSectionExpanded ? Icons.Material.Filled.ExpandLess : Icons.Material.Filled.ExpandMore)" 
                                 Size="Size.Medium" 
                                 Class="section-collapse-icon" />
                    </div>
                    <MudCollapse Expanded="_actionButtonsSectionExpanded">
                        <div class="section-content">
                            <div class="toggle-grid">
                                <label class="toggle-item">
                                    <MudSwitch T="bool" @bind-Value="_card.ShowSaveContact" 
                                               Color="Color.Primary" />
                                    <div class="toggle-label">
                                        <MudIcon Icon="@Icons.Material.Filled.PersonAdd" Size="Size.Small" />
                                        <span>Guardar Contacto</span>
                                    </div>
                                </label>
                                <label class="toggle-item">
                                    <MudSwitch T="bool" @bind-Value="_card.ShowWhatsApp" 
                                               Color="Color.Success" />
                                    <div class="toggle-label">
                                        <MudIcon Icon="@Icons.Custom.Brands.WhatsApp" Size="Size.Small" />
                                        <span>WhatsApp</span>
                                    </div>
                                </label>
                                <label class="toggle-item">
                                    <MudSwitch T="bool" @bind-Value="_card.ShowCall" 
                                               Color="Color.Info" />
                                    <div class="toggle-label">
                                        <MudIcon Icon="@Icons.Material.Filled.Phone" Size="Size.Small" />
                                        <span>Llamar</span>
                                    </div>
                                </label>
                                <label class="toggle-item">
                                    <MudSwitch T="bool" @bind-Value="_card.ShowEmail" 
                                               Color="Color.Warning" />
                                    <div class="toggle-label">
                                        <MudIcon Icon="@Icons.Material.Filled.Email" Size="Size.Small" />
                                        <span>Email</span>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </MudCollapse>
                </section>

                @* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                   LEVEL 3 (COLLAPSIBLE): SOCIAL PROFILES
                   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ *@
                <section class="section-card section-level-3">
                    <div class="section-header section-header-collapsible" @onclick="ToggleSocialSection">
                        <div class="section-icon icon-social">
                            <MudIcon Icon="@Icons.Material.Filled.Share" Size="Size.Medium" />
                        </div>
                        <div class="section-header-text">
                            <h2 class="section-title">Perfiles sociales</h2>
                            <p class="section-description">
                                @if (HasAnySocialLink())
                                {
                                    <span>@CountSocialLinks() perfiles configurados</span>
                                }
                                else
                                {
                                    <span class="text-muted">Sin configurar</span>
                                }
                            </p>
                        </div>
                        <div class="section-collapse-icon">
                            <MudIcon Icon="@(_socialSectionExpanded ? Icons.Material.Filled.ExpandLess : Icons.Material.Filled.ExpandMore)" />
                        </div>
                    </div>
                    <MudCollapse Expanded="_socialSectionExpanded">
                        <div class="section-content">
                            <div class="form-grid">
                                <div class="form-row">
                                    <MudTextField @bind-Value="_socialLinks.LinkedIn" 
                                                  Label="LinkedIn" 
                                                  Variant="Variant.Outlined" 
                                                  Adornment="Adornment.Start" 
                                                  AdornmentIcon="@Icons.Custom.Brands.LinkedIn"
                                                  Placeholder="linkedin.com/in/tu-perfil"
                                                  @oninput="MarkUnsaved" />
                                </div>
                                <div class="form-row">
                                    <MudTextField @bind-Value="_socialLinks.Instagram" 
                                                  Label="Instagram" 
                                                  Variant="Variant.Outlined"
                                                  Adornment="Adornment.Start" 
                                                  AdornmentIcon="@Icons.Custom.Brands.Instagram"
                                                  Placeholder="instagram.com/tu-usuario"
                                                  @oninput="MarkUnsaved" />
                                </div>
                                <div class="form-row">
                                    <MudTextField @bind-Value="_socialLinks.Facebook" 
                                                  Label="Facebook" 
                                                  Variant="Variant.Outlined"
                                                  Adornment="Adornment.Start" 
                                                  AdornmentIcon="@Icons.Custom.Brands.Facebook"
                                                  Placeholder="facebook.com/tu-pagina"
                                                  @oninput="MarkUnsaved" />
                                </div>
                                <div class="form-row">
                                    <MudTextField @bind-Value="_socialLinks.YouTube" 
                                                  Label="YouTube" 
                                                  Variant="Variant.Outlined"
                                                  Adornment="Adornment.Start" 
                                                  AdornmentIcon="@Icons.Custom.Brands.YouTube"
                                                  Placeholder="youtube.com/tu-canal"
                                                  @oninput="MarkUnsaved" />
                                </div>
                                <div class="form-row">
                                    <MudTextField @bind-Value="_socialLinks.Twitter" 
                                                  Label="Twitter / X" 
                                                  Variant="Variant.Outlined"
                                                  Adornment="Adornment.Start" 
                                                  AdornmentIcon="@Icons.Custom.Brands.Twitter"
                                                  Placeholder="x.com/tu-usuario"
                                                  @oninput="MarkUnsaved" />
                                </div>
                                <div class="form-row">
                                    <MudTextField @bind-Value="_socialLinks.Website" 
                                                  Label="PÃ¡gina Web" 
                                                  Variant="Variant.Outlined"
                                                  Adornment="Adornment.Start" 
                                                  AdornmentIcon="@Icons.Material.Filled.Language"
                                                  Placeholder="www.tusitio.com"
                                                  @oninput="MarkUnsaved" />
                                </div>
                            </div>
                        </div>
                    </MudCollapse>
                </section>

                @* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                   PORTFOLIO GALLERY (CONDITIONAL - Only for Portfolio Template)
                   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ *@
                @if (_isPortfolioTemplate)
                {
                    <section class="section-card section-level-1 section-portfolio">
                        <div class="section-header">
                            <div class="section-icon icon-gallery">
                                <MudIcon Icon="@Icons.Material.Filled.PhotoLibrary" Size="Size.Medium" />
                            </div>
                            <div class="section-header-text">
                                <h2 class="section-title">GalerÃ­a de Proyectos</h2>
                                <p class="section-description">Muestra tu trabajo creativo (mÃ¡ximo 10 imÃ¡genes)</p>
                            </div>
                        </div>
                        <div class="section-content">
                            @* Upload Area *@
                            <div class="gallery-upload-area">
                                <MudFileUpload T="IBrowserFile" 
                                               FilesChanged="UploadGalleryImage" 
                                               Accept="image/png,image/jpeg,image/webp"
                                               Disabled="@(_galleryImages.Count >= 10 || _isUploadingGallery)">
                                    <ActivatorContent>
                                        <div class="gallery-dropzone @(_galleryImages.Count >= 10 ? "disabled" : "")">
                                            @if (_isUploadingGallery)
                                            {
                                                <MudProgressCircular Size="Size.Medium" Indeterminate="true" Color="Color.Primary" />
                                                <span>Subiendo...</span>
                                            }
                                            else
                                            {
                                                <MudIcon Icon="@Icons.Material.Filled.AddPhotoAlternate" Size="Size.Large" />
                                                <span>@(_galleryImages.Count >= 10 ? "LÃ­mite alcanzado" : "Agregar imagen")</span>
                                            }
                                        </div>
                                    </ActivatorContent>
                                </MudFileUpload>
                            </div>

                            @* Gallery Grid *@
                            @if (_galleryImages.Any())
                            {
                                <div class="gallery-editor-grid">
                                    @foreach (var (image, index) in _galleryImages.OrderBy(i => i.Order).Select((img, idx) => (img, idx)))
                                    {
                                        <div class="gallery-editor-item">
                                            <img src="@image.Url" alt="@(image.Title ?? $"Imagen {index + 1}")" />
                                            <div class="gallery-item-overlay">
                                                <button class="gallery-item-btn" @onclick="() => MoveGalleryImage(image, -1)" 
                                                        disabled="@(index == 0)" title="Mover arriba">
                                                    <MudIcon Icon="@Icons.Material.Filled.ArrowBack" Size="Size.Small" />
                                                </button>
                                                <button class="gallery-item-btn gallery-item-delete" @onclick="() => RemoveGalleryImage(image)" title="Eliminar">
                                                    <MudIcon Icon="@Icons.Material.Filled.Delete" Size="Size.Small" />
                                                </button>
                                                <button class="gallery-item-btn" @onclick="() => MoveGalleryImage(image, 1)" 
                                                        disabled="@(index == _galleryImages.Count - 1)" title="Mover abajo">
                                                    <MudIcon Icon="@Icons.Material.Filled.ArrowForward" Size="Size.Small" />
                                                </button>
                                            </div>
                                            <div class="gallery-item-title">
                                                <MudTextField @bind-Value="image.Title" 
                                                              Placeholder="TÃ­tulo (opcional)" 
                                                              Variant="Variant.Text"
                                                              Margin="Margin.Dense"
                                                              @oninput="MarkUnsaved" />
                                            </div>
                                        </div>
                                    }
                                </div>
                            }
                            else
                            {
                                <div class="gallery-empty-state">
                                    <MudIcon Icon="@Icons.Material.Filled.Collections" Size="Size.Large" />
                                    <p>AÃºn no tienes imÃ¡genes en tu galerÃ­a</p>
                                    <span>Sube hasta 10 imÃ¡genes para mostrar tu trabajo</span>
                                </div>
                            }
                        </div>
                    </section>
                }

                @* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                   SERVICES (CONDITIONAL - Only for Services Template)
                   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ *@
                @if (_isServicesTemplate)
                {
                    @* SERVICES EDITOR - With integrated CTA indicator *@
                    <section class="section-card section-level-1 section-services">
                        <div class="section-header section-header-collapsible" @onclick="() => _servicesSectionExpanded = !_servicesSectionExpanded">
                            <div class="section-icon icon-services">
                                <MudIcon Icon="@Icons.Material.Filled.Handyman" Size="Size.Medium" />
                            </div>
                            <div class="section-header-text">
                                <h2 class="section-title">Mis Servicios</h2>
                                <p class="section-description">Configura los servicios que ofreces (mÃ¡ximo 10)</p>
                            </div>
                            <MudIcon Icon="@(_servicesSectionExpanded ? Icons.Material.Filled.ExpandLess : Icons.Material.Filled.ExpandMore)" 
                                     Size="Size.Medium" 
                                     Class="section-collapse-icon" />
                        </div>
                        
                        @* Compact CTA Status Indicator - Always visible when services exist *@
                        @if (_services.Any())
                        {
                            <div class="cta-status-bar">
                                <div class="cta-status-left">
                                    <span class="cta-label">CTA principal:</span>
                                    @if (IsGoalSelectorVisible)
                                    {
                                        @* Mixed types: Show compact selector *@
                                        <div class="cta-selector-compact">
                                            <button class="cta-chip @(GetEffectivePrimaryGoal() == "booking" ? "cta-chip-active" : "")"
                                                    @onclick:stopPropagation="true"
                                                    @onclick="@(() => SetPrimaryGoal("booking"))">
                                                ğŸ“… Reservar
                                            </button>
                                            <button class="cta-chip @(GetEffectivePrimaryGoal() == "quote" ? "cta-chip-active" : "")"
                                                    @onclick:stopPropagation="true"
                                                    @onclick="@(() => SetPrimaryGoal("quote"))">
                                                ğŸ“ Cotizar
                                            </button>
                                        </div>
                                    }
                                    else
                                    {
                                        @* Homogeneous types: Show auto badge *@
                                        <span class="cta-auto-badge">
                                            @(GetEffectivePrimaryGoal() == "booking" ? "ğŸ“… Reservar Cita" : "ğŸ“ Solicitar CotizaciÃ³n")
                                            <span class="cta-auto-tag">auto</span>
                                        </span>
                                    }
                                </div>
                            </div>
                        }
                        
                        <MudCollapse Expanded="_servicesSectionExpanded">
                            <div class="section-content">
                                @* Add Service Button *@
                                <div class="services-add-area">
                                    <MudButton Variant="Variant.Outlined" 
                                               Color="Color.Primary" 
                                               StartIcon="@Icons.Material.Filled.Add"
                                               OnClick="AddNewService"
                                               Disabled="@(_services.Count >= 10)"
                                               Size="Size.Small">
                                        Agregar servicio
                                    </MudButton>
                                    <span class="services-count">@_services.Count / 10</span>
                                </div>

                                @* Services List *@
                                @if (_services.Any())
                                {
                                    <div class="services-editor-list">
                                        @foreach (var (service, index) in _services.OrderBy(s => s.DisplayOrder).Select((s, i) => (s, i)))
                                        {
                                            <div class="service-editor-card @(service.IsActive ? "" : "service-inactive")">
                                                @* Service Header *@
                                                <div class="service-card-header">
                                                    <div class="service-header-left">
                                                        <span class="service-drag-handle" title="Arrastra para reordenar">â‰¡</span>
                                                        <span class="service-number">#@(index + 1)</span>
                                                        <span class="service-name-preview">@(string.IsNullOrEmpty(service.Name) ? "Nuevo servicio" : service.Name)</span>
                                                    </div>
                                                    <div class="service-header-right">
                                                        <MudSwitch @bind-Value="service.IsActive" 
                                                                   Color="Color.Success" 
                                                                   Size="Size.Small"
                                                                   title="@(service.IsActive ? "Activo" : "Inactivo")" />
                                                        <MudMenu Icon="@Icons.Material.Filled.MoreVert" Size="Size.Small" Dense="true">
                                                            <MudMenuItem Icon="@Icons.Material.Filled.ContentCopy" OnClick="() => DuplicateService(service)">Duplicar</MudMenuItem>
                                                            <MudMenuItem Icon="@Icons.Material.Filled.Delete" OnClick="() => RemoveService(service)" Class="mud-error-text">Eliminar</MudMenuItem>
                                                        </MudMenu>
                                                    </div>
                                                </div>

                                                @* Conversion Type Selector *@
                                                <div class="service-conversion-type">
                                                    <label class="conversion-label">Este servicio se ofrece como:</label>
                                                    <div class="conversion-options">
                                                        <div class="conversion-option @(service.ConversionType == "booking" ? "conversion-active" : "")"
                                                             @onclick="@(() => SetServiceConversionType(service, "booking"))">
                                                            <span class="conversion-icon">ğŸ“…</span>
                                                            <span class="conversion-text">Cita</span>
                                                        </div>
                                                        <div class="conversion-option @(service.ConversionType == "quote" ? "conversion-active" : "")"
                                                             @onclick="@(() => SetServiceConversionType(service, "quote"))">
                                                            <span class="conversion-icon">ğŸ“</span>
                                                            <span class="conversion-text">CotizaciÃ³n</span>
                                                        </div>
                                                        <div class="conversion-option @(service.ConversionType == "both" ? "conversion-active" : "")"
                                                             @onclick="@(() => SetServiceConversionType(service, "both"))">
                                                            <span class="conversion-icon">âœ…</span>
                                                            <span class="conversion-text">Ambos</span>
                                                        </div>
                                                    </div>
                                                </div>

                                                @* Basic Fields *@
                                                <div class="service-basic-fields">
                                                    <MudTextField @bind-Value="service.Name" 
                                                                  Label="Nombre del servicio" 
                                                                  Variant="Variant.Outlined"
                                                                  Required="true"
                                                                  Margin="Margin.Dense"
                                                                  @oninput="MarkUnsaved" />
                                                    <div class="service-row">
                                                        <MudNumericField @bind-Value="service.DurationMinutes" 
                                                                         Label="DuraciÃ³n (min)" 
                                                                         Variant="Variant.Outlined"
                                                                         Min="15" Max="480"
                                                                         Margin="Margin.Dense"
                                                                         @oninput="MarkUnsaved" />
                                                        <MudNumericField @bind-Value="service.PriceFrom" 
                                                                         Label="Precio desde $" 
                                                                         Variant="Variant.Outlined"
                                                                         Min="0"
                                                                         Margin="Margin.Dense"
                                                                         @oninput="MarkUnsaved" />
                                                    </div>
                                                    <MudTextField @bind-Value="service.Description" 
                                                                  Label="DescripciÃ³n (opcional)" 
                                                                  Variant="Variant.Outlined"
                                                                  Lines="2"
                                                                  Margin="Margin.Dense"
                                                                  @oninput="MarkUnsaved" />
                                                </div>

                                                @* Booking Config (Collapsible) - Only if booking or both *@
                                                @if (service.ConversionType == "booking" || service.ConversionType == "both")
                                                {
                                                    <div class="service-config-panel">
                                                        <div class="config-panel-header" @onclick="() => ToggleServiceBookingConfig(service.Id)">
                                                            <span class="config-panel-icon">âš™ï¸</span>
                                                            <span class="config-panel-title">ConfiguraciÃ³n de Agenda</span>
                                                            <MudIcon Icon="@(IsServiceBookingConfigExpanded(service.Id) ? Icons.Material.Filled.ExpandLess : Icons.Material.Filled.ExpandMore)" Size="Size.Small" />
                                                        </div>
                                                        <MudCollapse Expanded="IsServiceBookingConfigExpanded(service.Id)">
                                                            <div class="config-panel-content">
                                                                <div class="config-row">
                                                                    <MudSelect @bind-Value="service.Modality" 
                                                                               Label="Modalidad" 
                                                                               Variant="Variant.Outlined"
                                                                               Margin="Margin.Dense"
                                                                               @oninput="MarkUnsaved">
                                                                        <MudSelectItem Value="@("presencial")">ğŸ¢ Presencial</MudSelectItem>
                                                                        <MudSelectItem Value="@("online")">ğŸ’» Online</MudSelectItem>
                                                                        <MudSelectItem Value="@("domicilio")">ğŸ  A domicilio</MudSelectItem>
                                                                    </MudSelect>
                                                                    <MudSelect @bind-Value="service.MinNoticeMinutes" 
                                                                               Label="AnticipaciÃ³n mÃ­nima" 
                                                                               Variant="Variant.Outlined"
                                                                               Margin="Margin.Dense"
                                                                               @oninput="MarkUnsaved">
                                                                        <MudSelectItem Value="@((int?)60)">1 hora</MudSelectItem>
                                                                        <MudSelectItem Value="@((int?)180)">3 horas</MudSelectItem>
                                                                        <MudSelectItem Value="@((int?)1440)">24 horas</MudSelectItem>
                                                                        <MudSelectItem Value="@((int?)2880)">48 horas</MudSelectItem>
                                                                    </MudSelect>
                                                                </div>
                                                                <div class="config-row">
                                                                    <MudSelect @bind-Value="service.BufferBeforeMinutes" 
                                                                               Label="Buffer antes" 
                                                                               Variant="Variant.Outlined"
                                                                               Margin="Margin.Dense"
                                                                               @oninput="MarkUnsaved">
                                                                        <MudSelectItem Value="@((int?)0)">0 min</MudSelectItem>
                                                                        <MudSelectItem Value="@((int?)5)">5 min</MudSelectItem>
                                                                        <MudSelectItem Value="@((int?)10)">10 min</MudSelectItem>
                                                                        <MudSelectItem Value="@((int?)15)">15 min</MudSelectItem>
                                                                    </MudSelect>
                                                                    <MudSelect @bind-Value="service.BufferAfterMinutes" 
                                                                               Label="Buffer despuÃ©s" 
                                                                               Variant="Variant.Outlined"
                                                                               Margin="Margin.Dense"
                                                                               @oninput="MarkUnsaved">
                                                                        <MudSelectItem Value="@((int?)0)">0 min</MudSelectItem>
                                                                        <MudSelectItem Value="@((int?)5)">5 min</MudSelectItem>
                                                                        <MudSelectItem Value="@((int?)10)">10 min</MudSelectItem>
                                                                        <MudSelectItem Value="@((int?)15)">15 min</MudSelectItem>
                                                                    </MudSelect>
                                                                </div>
                                                                <MudSelect @bind-Value="service.MaxBookingsPerDay" 
                                                                           Label="LÃ­mite de citas por dÃ­a" 
                                                                           Variant="Variant.Outlined"
                                                                           Margin="Margin.Dense"
                                                                           FullWidth="true"
                                                                           @oninput="MarkUnsaved">
                                                                    <MudSelectItem Value="@((int?)0)">Ilimitado</MudSelectItem>
                                                                    <MudSelectItem Value="@((int?)3)">3 citas</MudSelectItem>
                                                                    <MudSelectItem Value="@((int?)5)">5 citas</MudSelectItem>
                                                                    <MudSelectItem Value="@((int?)10)">10 citas</MudSelectItem>
                                                                </MudSelect>
                                                            </div>
                                                        </MudCollapse>
                                                    </div>
                                                }

                                            </div>
                                        }
                                    </div>
                                }
                                else
                                {
                                    <div class="services-empty-state">
                                        <MudIcon Icon="@Icons.Material.Filled.Build" Size="Size.Large" />
                                        <p>AÃºn no tienes servicios configurados</p>
                                        <span>Agrega servicios para que tus clientes puedan reservar o solicitar cotizaciÃ³n</span>
                                    </div>
                                }
                            </div>
                        </MudCollapse>
                    </section>
                }

                @* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                   SAVE BUTTON - PREMIUM CTA
                   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ *@
                <div class="save-section">
                    <MudButton Variant="Variant.Filled" 
                               Color="Color.Primary" 
                               OnClick="SaveCard" 
                               Size="Size.Large"
                               StartIcon="@(_isSaving ? null : Icons.Material.Filled.Save)"
                               Disabled="_isSaving"
                               Class="save-btn-main">
                        @if (_isSaving)
                        {
                            <MudProgressCircular Size="Size.Small" Indeterminate="true" Color="Color.Inherit" Class="mr-2" />
                            <span>Guardando...</span>
                        }
                        else
                        {
                            <span>Guardar cambios</span>
                        }
                    </MudButton>
                </div>
            </main>

            @* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
               RIGHT COLUMN: PREMIUM IPHONE-STYLE LIVE PREVIEW (STICKY)
               â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• *@
            <aside class="preview-sidebar">
                <div class="preview-sticky">
                    @* Premium Preview Card Container with Glow *@
                    <div class="preview-panel">
                        @* Panel Header *@
                        <div class="preview-panel-header">
                            <div class="preview-panel-icon">
                                <MudIcon Icon="@Icons.Material.Filled.Visibility" Size="Size.Small" />
                            </div>
                            <div class="preview-panel-text">
                                <h2 class="preview-panel-title">Vista previa</h2>
                                <p class="preview-panel-subtitle">Live Preview â€” @(string.IsNullOrEmpty(_card.FullName) ? "Sin nombre" : _card.FullName)</p>
                            </div>
                        </div>

                        @* iPhone Device Frame *@
                        <div class="iphone-frame">
                            @* Dynamic Island *@
                            <div class="dynamic-island"></div>
                            
                            @* Phone Screen with Internal Scroll *@
                            <div class="iphone-screen">
                                @* Card Header Gradient *@
                                <div class="phone-card-header">
                                    @* Status bar icons *@
                                    <div class="status-bar">
                                        <span class="status-time">9:41</span>
                                        <div class="status-icons">
                                            <MudIcon Icon="@Icons.Material.Filled.SignalCellularAlt" Size="Size.Small" />
                                            <MudIcon Icon="@Icons.Material.Filled.Wifi" Size="Size.Small" />
                                            <MudIcon Icon="@Icons.Material.Filled.BatteryFull" Size="Size.Small" />
                                        </div>
                                    </div>
                                </div>

                                @* Scrollable Content Area *@
                                <div class="phone-card-content @GetBackgroundContrastClass()" style="@GetPreviewBackgroundStyle()">
                                    @* Avatar Section *@
                                    <div class="phone-avatar-section">
                                        @if (!string.IsNullOrEmpty(_card.ProfileImageUrl))
                                        {
                                            <div class="phone-avatar phone-avatar-image avatar-size-@_cardStyle.AvatarSize.ToLower() @(_cardStyle.AvatarGlow ? "avatar-glow" : "")">
                                                <img src="@_card.ProfileImageUrl" alt="@_card.FullName" />
                                            </div>
                                        }
                                        else
                                        {
                                            <div class="phone-avatar phone-avatar-initials avatar-size-@_cardStyle.AvatarSize.ToLower() @(_cardStyle.AvatarGlow ? "avatar-glow" : "")"
                                                 style="background: @_themeTokens.AccentPrimary; color: @_themeTokens.TextOnAccent;">
                                                <span>@GetInitials(_card.FullName)</span>
                                            </div>
                                        }
                                    </div>

                                    @* Identity Info *@
                                    <h3 class="phone-name">@(string.IsNullOrEmpty(_card.FullName) ? "Tu Nombre" : _card.FullName)</h3>
                                    <p class="phone-title" style="color: @_themeTokens.AccentPrimary;">@(string.IsNullOrEmpty(_card.Title) ? "â€”" : _card.Title)</p>
                                    <p class="phone-company">@GetDisplayCompanyName()</p>

                                    @* Bio *@
                                    @if (!string.IsNullOrEmpty(_card.Bio))
                                    {
                                        <p class="phone-bio">@_card.Bio</p>
                                    }
                                    else
                                    {
                                        <p class="phone-bio phone-bio-placeholder">Tu biografÃ­a aparecerÃ¡ aquÃ­...</p>
                                    }

                                    @* Portfolio Gallery Preview (conditional) *@
                                    @if (_isPortfolioTemplate && _galleryImages.Any())
                                    {
                                        <div class="phone-gallery-section">
                                            <h4 class="phone-gallery-title">Mi Trabajo</h4>
                                            <div class="phone-gallery-grid">
                                                @foreach (var image in _galleryImages.OrderBy(i => i.Order).Take(4))
                                                {
                                                    <div class="phone-gallery-item">
                                                        <img src="@image.Url" alt="@(image.Title ?? "Portfolio")" />
                                                    </div>
                                                }
                                            </div>
                                            @if (_galleryImages.Count > 4)
                                            {
                                                <p class="phone-gallery-more">+@(_galleryImages.Count - 4) mÃ¡s</p>
                                            }
                                        </div>
                                    }

                                    @* Social Icons (if any) - ABOVE Status Chips *@
                                    @if (HasAnySocialLink())
                                    {
                                        <div class="phone-social-row">
                                            @if (!string.IsNullOrEmpty(_socialLinks.LinkedIn))
                                            {
                                                <span class="phone-social-icon-rect">
                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                                        <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                                                    </svg>
                                                </span>
                                            }
                                            @if (!string.IsNullOrEmpty(_socialLinks.Instagram))
                                            {
                                                <span class="phone-social-icon-rect">
                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                                        <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                                                    </svg>
                                                </span>
                                            }
                                            @if (!string.IsNullOrEmpty(_socialLinks.YouTube))
                                            {
                                                <span class="phone-social-icon-rect">
                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                                        <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                                                    </svg>
                                                </span>
                                            }
                                            @if (!string.IsNullOrEmpty(_socialLinks.Twitter))
                                            {
                                                <span class="phone-social-icon-rect">
                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                                        <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                                                    </svg>
                                                </span>
                                            }
                                            @if (!string.IsNullOrEmpty(_socialLinks.Facebook))
                                            {
                                                <span class="phone-social-icon-rect">
                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                                        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                                                    </svg>
                                                </span>
                                            }
                                            @if (!string.IsNullOrEmpty(_socialLinks.Website))
                                            {
                                                <span class="phone-social-icon-rect">
                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <circle cx="12" cy="12" r="10"/>
                                                        <line x1="2" y1="12" x2="22" y2="12"/>
                                                        <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                                                    </svg>
                                                </span>
                                            }
                                        </div>
                                    }

                                    @* Status Chips and CTA Buttons - Show on ALL templates *@
                                    @if (true)
                                    {
                                        @* Status Chips *@
                                        <div class="phone-status-chips">
                                            <span class="phone-chip">
                                                <span class="chip-dot"></span> Disponible
                                            </span>
                                            <span class="phone-chip">
                                                <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                                                Responde &lt; 1h
                                            </span>
                                            <span class="phone-chip">
                                                <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
                                                El Salvador
                                            </span>
                                        </div>

                                        @* CTA Buttons - Matching Public Card *@
                                        <div class="phone-cta-container btn-shape-@_cardStyle.ButtonShape btn-style-@_cardStyle.ButtonStyle">
                                            @* Primary CTA: Guardar Contacto (Full Width) *@
                                            @if (_card.ShowSaveContact)
                                            {
                                                <button class="phone-cta-primary"
                                                        style="background: @_themeTokens.ButtonPrimaryBg; color: @_themeTokens.ButtonPrimaryText; box-shadow: 0 4px 16px @(_themeTokens.AccentSoft); border-radius: @GetButtonRadius();">
                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                                        <circle cx="8.5" cy="7" r="4"/>
                                                        <line x1="20" y1="8" x2="20" y2="14"/>
                                                        <line x1="23" y1="11" x2="17" y2="11"/>
                                                    </svg>
                                                    <span>Guardar Contacto</span>
                                                </button>
                                            }

                                            @* Secondary Row: WhatsApp, Llamar, Email - Outline Style *@
                                            <div class="phone-cta-secondary-row">
                                                @if (_card.ShowWhatsApp && !string.IsNullOrEmpty(_card.WhatsAppNumber))
                                                {
                                                    <button class="phone-cta-outline cta-whatsapp-outline"
                                                            style="border-radius: @GetButtonRadius();">
                                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                                                            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
                                                        </svg>
                                                        WhatsApp
                                                    </button>
                                                }
                                                @if (_card.ShowCall && !string.IsNullOrEmpty(_card.Phone))
                                                {
                                                    <button class="phone-cta-outline cta-llamar-outline"
                                                            style="border-radius: @GetButtonRadius();">
                                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
                                                    </svg>
                                                    Llamar
                                                </button>
                                                }
                                                @if (_card.ShowEmail && !string.IsNullOrEmpty(_card.Email))
                                                {
                                                    <button class="phone-cta-outline cta-email-outline"
                                                            style="border-radius: @GetButtonRadius();">
                                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                                                            <polyline points="22,6 12,13 2,6"/>
                                                        </svg>
                                                        Email
                                                    </button>
                                                }
                                            </div>
                                        </div>
                                    }
                                    @* TEMPLATE-SPECIFIC CONTENT *@
                                    @if (_isServicesTemplate)
                                    {
                                        @* Services Template Preview Section *@
                                        <div class="phone-services-section">
                                            <h4 class="phone-services-title">MIS SERVICIOS</h4>
                                            <div class="phone-services-list">
                                                @if (_services.Any())
                                                {
                                                    @foreach (var service in _services.Take(3))
                                                    {
                                                        <div class="phone-service-card" style="border-color: @_themeTokens.AccentSoft;">
                                                            <div class="phone-service-icon" style="background: @_themeTokens.AccentSoft;">
                                                                <span>@GetServiceEmoji(service.Name)</span>
                                                            </div>
                                                            <div class="phone-service-info">
                                                                <span class="phone-service-name">@service.Name</span>
                                                                <span class="phone-service-meta" style="color: @_themeTokens.AccentPrimary;">
                                                                    @service.DurationMinutes min Â· Desde $@service.PriceFrom
                                                                </span>
                                                            </div>
                                                        </div>
                                                    }
                                                }
                                                else
                                                {
                                                    <div class="phone-service-card" style="border-color: @_themeTokens.AccentSoft;">
                                                        <div class="phone-service-icon" style="background: @_themeTokens.AccentSoft;">ğŸ’¼</div>
                                                        <div class="phone-service-info">
                                                            <span class="phone-service-name">ConsultorÃ­a Empresarial</span>
                                                            <span class="phone-service-meta" style="color: @_themeTokens.AccentPrimary;">60 min Â· Desde $50</span>
                                                        </div>
                                                    </div>
                                                }
                                            </div>
                                            
                                            @* Booking CTAs - Smart display based on GetEffectivePrimaryGoal *@
                                            <div class="phone-booking-ctas">
                                                @{
                                                    var effectiveGoal = GetEffectivePrimaryGoal();
                                                    var hasBooking = HasBookingServices();
                                                    var hasQuote = HasQuoteServices();
                                                }
                                                @if (effectiveGoal == "booking" && hasBooking)
                                                {
                                                    <button class="phone-cta-booking" style="background: @_themeTokens.AccentPrimary; border-radius: @GetButtonRadius();">
                                                        ğŸ“… Reservar Cita
                                                    </button>
                                                    @if (hasQuote)
                                                    {
                                                        <span class="phone-cta-secondary">o solicitar cotizaciÃ³n</span>
                                                    }
                                                }
                                                else if (effectiveGoal == "quote" && hasQuote)
                                                {
                                                    <button class="phone-cta-booking" style="background: @_themeTokens.AccentPrimary; border-radius: @GetButtonRadius();">
                                                        ğŸ“ Solicitar CotizaciÃ³n
                                                    </button>
                                                    @if (hasBooking)
                                                    {
                                                        <span class="phone-cta-secondary">o reservar cita</span>
                                                    }
                                                }
                                                else if (hasBooking)
                                                {
                                                    <button class="phone-cta-booking" style="background: @_themeTokens.AccentPrimary; border-radius: @GetButtonRadius();">
                                                        ğŸ“… Reservar Cita
                                                    </button>
                                                }
                                                else if (hasQuote)
                                                {
                                                    <button class="phone-cta-booking" style="background: @_themeTokens.AccentPrimary; border-radius: @GetButtonRadius();">
                                                        ğŸ“ Solicitar CotizaciÃ³n
                                                    </button>
                                                }
                                            </div>
                                        </div>
                                    }
                                    else
                                    {
                                        @* Lead Form Preview Section (Default/Professional template) *@
                                        <div class="phone-lead-form-section">
                                            <div class="phone-lead-header">
                                                <h4 class="phone-lead-title">Â¿Quieres que te contacte?</h4>
                                                <p class="phone-lead-subtitle">DÃ©jame tus datos y te respondo pronto</p>
                                            </div>
                                            
                                            <div class="phone-lead-form">
                                                @* Nombre *@
                                                <div class="phone-form-field">
                                                    <label class="phone-field-label">
                                                        <MudIcon Icon="@Icons.Material.Filled.Person" Size="Size.Small" />
                                                        Nombre completo <span class="required-mark">*</span>
                                                    </label>
                                                    <div class="phone-input-mock"
                                                         style="background: @_themeTokens.SurfaceInput; border-color: @_themeTokens.SurfaceInputFocus; border-radius: @GetInputRadius();">Juan PÃ©rez</div>
                                                </div>
                                                
                                                @* Email *@
                                                <div class="phone-form-field">
                                                    <label class="phone-field-label">
                                                        <MudIcon Icon="@Icons.Material.Filled.Email" Size="Size.Small" />
                                                        Correo electrÃ³nico <span class="required-mark">*</span>
                                                    </label>
                                                    <div class="phone-input-mock"
                                                         style="background: @_themeTokens.SurfaceInput; border-color: @_themeTokens.SurfaceInputFocus; border-radius: @GetInputRadius();">tu@email.com</div>
                                                </div>
                                                
                                                @* TelÃ©fono *@
                                                <div class="phone-form-field">
                                                    <label class="phone-field-label">
                                                        <MudIcon Icon="@Icons.Material.Filled.Phone" Size="Size.Small" />
                                                        TelÃ©fono <span class="required-mark">*</span>
                                                    </label>
                                                    <div class="phone-input-row">
                                                        <div class="phone-country-mock"
                                                             style="background: @_themeTokens.SurfaceInput; border-color: @_themeTokens.SurfaceInputFocus; border-radius: @GetInputRadius();">ğŸ‡¸ğŸ‡» +503</div>
                                                        <div class="phone-input-mock phone-input-number"
                                                             style="background: @_themeTokens.SurfaceInput; border-color: @_themeTokens.SurfaceInputFocus; border-radius: @GetInputRadius();">7000 0000</div>
                                                    </div>
                                                </div>
                                                
                                                @* Mensaje *@
                                                <div class="phone-form-field">
                                                    <label class="phone-field-label">
                                                        <MudIcon Icon="@Icons.Material.Filled.Message" Size="Size.Small" />
                                                        Mensaje <span class="optional-mark">(opcional)</span>
                                                    </label>
                                                    <div class="phone-textarea-mock"
                                                         style="background: @_themeTokens.SurfaceInput; border-color: @_themeTokens.SurfaceInputFocus; border-radius: @GetInputRadius();">Â¿En quÃ© puedo ayudarte?</div>
                                                </div>
                                                
                                                @* Submit Button *@
                                                <button class="phone-submit-btn"
                                                        style="background: @_themeTokens.ButtonPrimaryBg; box-shadow: 0 3px 12px @(_themeTokens.AccentSoft); border-radius: @GetButtonRadius();">
                                                    <MudIcon Icon="@Icons.Material.Filled.Send" Size="Size.Small" />
                                                    <span>Enviar mensaje</span>
                                                </button>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    @* URL Section OUTSIDE Phone - Interactive *@
                    <div class="preview-url-section">
                        <div class="preview-url-input" @onclick="CopyPublicUrl" title="Copiar URL">
                            <span class="preview-url-text">@_publicUrl</span>
                            <MudIcon Icon="@Icons.Material.Filled.ContentCopy" Size="Size.Small" Class="copy-icon" />
                        </div>
                        <a href="@_publicUrl" target="_blank" class="preview-url-cta">
                            <span>â†’</span> VER TARJETA PÃšBLICA
                        </a>
                    </div>
                </div>
            </aside>
        </div>
    </div>
}

<style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MYCARD - PREMIUM ENTERPRISE REDESIGN
       Dark Mate + Tech Premium Visual Identity
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    .mycard-container {
        max-width: 1432px;
        width: 100%;
        margin: 0 auto;
        padding: 17px 24px 40px;
        box-sizing: border-box;
        background: transparent;
        overflow-x: hidden;
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       PAGE HEADER
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 24px;
        background: var(--dt-surface-1, #111827);
        border-radius: var(--dt-radius-xl, 16px);
        border: 1px solid var(--dt-border-default, #233044);
        margin-bottom: 24px;
    }

    .header-content {
        display: flex;
        align-items: center;
        gap: 16px;
    }

    .header-icon {
        width: 56px;
        height: 56px;
        border-radius: 14px;
        background: linear-gradient(135deg, var(--dt-primary-500, #6366F1), var(--dt-primary-600, #4F46E5));
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
    }

    .header-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--dt-text-primary, #E5E7EB);
        margin: 0 0 4px 0;
    }

    .header-subtitle {
        font-size: 0.875rem;
        color: var(--dt-text-secondary, #9CA3AF);
        margin: 0;
    }

    /* Save Status */
    .save-status {
        display: flex;
        align-items: center;
    }

    .status-indicator {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        border-radius: var(--dt-radius-full, 9999px);
        font-size: 0.8125rem;
        font-weight: 500;
    }

    .status-saving {
        background: var(--dt-info-bg, rgba(37, 99, 235, 0.1));
        color: var(--dt-info, #2563EB);
        border: 1px solid var(--dt-info-border, rgba(37, 99, 235, 0.3));
    }

    .status-unsaved {
        background: var(--dt-warning-bg, rgba(217, 119, 6, 0.1));
        color: var(--dt-warning, #D97706);
        border: 1px solid var(--dt-warning-border, rgba(217, 119, 6, 0.3));
    }

    .status-saved {
        background: var(--dt-success-bg, rgba(22, 163, 74, 0.1));
        color: var(--dt-success, #16A34A);
        border: 1px solid var(--dt-success-border, rgba(22, 163, 74, 0.3));
    }

    .last-updated {
        color: var(--dt-text-muted, #6B7280);
        font-weight: 400;
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       EDITOR LAYOUT (Two Columns)
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .editor-layout {
        display: grid;
        grid-template-columns: 1fr minmax(380px, 460px);
        gap: 24px;
        align-items: start;
        width: 100%;
        box-sizing: border-box;
    }

    @@media (max-width: 1024px) {
        .editor-layout {
            grid-template-columns: 1fr;
        }
        .preview-sidebar {
            order: -1;
        }
    }

    .editor-main {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       SECTION CARDS
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .section-card {
        background: var(--dt-surface-1, #111827);
        border-radius: var(--dt-radius-xl, 16px);
        border: 1px solid var(--dt-border-default, #233044);
        overflow: hidden;
        transition: border-color var(--dt-transition-normal, 250ms ease);
    }

    .section-card:hover {
        border-color: var(--dt-border-strong, #2E3E57);
    }

    /* Level 1 - Dominant */
    .section-level-1 {
        padding: 24px;
    }

    .section-level-1 .section-icon {
        width: 48px;
        height: 48px;
    }

    /* Level 2 - Secondary */
    .section-level-2 {
        padding: 20px;
    }

    .section-level-2 .section-icon {
        width: 40px;
        height: 40px;
    }

    /* Level 3 - Minimal */
    .section-level-3 {
        padding: 16px 20px;
    }

    .section-level-3 .section-icon {
        width: 36px;
        height: 36px;
    }

    .section-header {
        display: flex;
        align-items: center;
        gap: 16px;
        margin-bottom: 20px;
    }
    
    /* Unified Identity Header with Avatar on Right */
    .identity-header-with-avatar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        flex-wrap: nowrap;
    }
    
    .section-header-left {
        display: flex;
        align-items: center;
        gap: 16px;
        flex: 1;
        min-width: 0;
    }
    
    .identity-avatar-section {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        flex-shrink: 0;
        margin-right: 12px;
    }
    
    .identity-avatar-container {
        position: relative;
    }
    
    .identity-avatar-glow {
        border-radius: 50%;
        padding: 3px;
        background: linear-gradient(135deg, var(--dt-primary-500, #8B5CF6), var(--dt-primary-400, #A78BFA));
        box-shadow: 0 0 20px rgba(139, 92, 246, 0.35);
    }
    
    .identity-avatar {
        width: 72px;
        height: 72px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
    }
    
    .identity-avatar-image {
        background: #1F2937;
    }
    
    .identity-avatar-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    .identity-avatar-initials {
        background: linear-gradient(135deg, var(--dt-primary-500, #8B5CF6), var(--dt-primary-600, #7C3AED));
        color: white;
        font-size: 1.5rem;
        font-weight: 700;
    }
    
    .avatar-camera-overlay {
        position: absolute;
        bottom: -4px;
        right: -4px;
    }
    
    .camera-btn {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        background: rgba(30, 41, 59, 0.95);
        border: 2px solid var(--dt-primary-500, #8B5CF6);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 150ms ease;
    }
    
    .camera-btn:hover {
        background: var(--dt-primary-600, #7C3AED);
        transform: scale(1.1);
    }
    
    .change-photo-upload {
        display: block;
    }
    
    .change-photo-btn {
        font-size: 0.75rem !important;
        padding: 6px 12px !important;
        border-radius: 16px !important;
    }

    .section-header-collapsible {
        cursor: pointer;
        margin-bottom: 0;
        padding: 4px 0;
        border-radius: var(--dt-radius-md, 8px);
        transition: background var(--dt-transition-fast, 150ms ease);
    }

    .section-header-collapsible:hover {
        background: var(--dt-hover-surface, #17243A);
    }

    .section-icon {
        border-radius: var(--dt-radius-lg, 12px);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        flex-shrink: 0;
    }

    .icon-identity { background: linear-gradient(135deg, var(--dt-primary-500), var(--dt-primary-600)); }
    .icon-photo { background: linear-gradient(135deg, #F59E0B, #D97706); }
    .icon-contact { background: linear-gradient(135deg, #14B8A6, #0D9488); }
    .icon-cta { background: linear-gradient(135deg, #F87171, #DC2626); }
    .icon-social { background: linear-gradient(135deg, #A78BFA, #7C3AED); }
    .icon-preview { background: linear-gradient(135deg, #60A5FA, #2563EB); }

    .section-header-text {
        flex: 1;
    }

    .section-title {
        font-size: 1rem;
        font-weight: 600;
        color: var(--dt-text-primary, #E5E7EB);
        margin: 0 0 2px 0;
    }

    .section-description {
        font-size: 0.8125rem;
        color: var(--dt-text-secondary, #9CA3AF);
        margin: 0;
    }

    .section-collapse-icon {
        color: var(--dt-text-muted, #6B7280);
        transition: transform var(--dt-transition-fast, 150ms ease);
    }

    .section-content {
        padding-top: 4px;
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       FORM GRID
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .form-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
    }

    @@media (max-width: 768px) {
        .form-grid {
            grid-template-columns: 1fr;
        }
    }

    .form-row-full {
        grid-column: 1 / -1;
    }

    .bio-warning {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 0.75rem;
        color: var(--dt-text-muted, #6B7280);
        margin-top: 8px;
    }

    /* Phone Row */
    .phone-row {
        display: flex;
        gap: 12px;
        grid-column: 1 / -1;
    }

    .country-select {
        width: 120px;
        flex-shrink: 0;
    }

    .phone-input {
        flex: 1;
    }

    .country-option {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .country-flag {
        font-size: 1.125rem;
    }

    .country-code {
        font-size: 0.875rem;
        color: var(--dt-text-secondary);
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       PROFILE PHOTO CARD - PREMIUM REDESIGN (Matches Mockup)
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .profile-photo-card {
        background: linear-gradient(135deg, 
            rgba(17, 24, 39, 0.95) 0%, 
            rgba(30, 41, 59, 0.85) 50%, 
            rgba(17, 24, 39, 0.95) 100%);
        border: 1px solid rgba(99, 102, 241, 0.15);
        border-radius: 20px;
        padding: 32px 40px;
        box-shadow: 
            0 4px 30px rgba(0, 0, 0, 0.3),
            0 0 60px rgba(99, 102, 241, 0.05);
        backdrop-filter: blur(10px);
        position: relative;
        overflow: hidden;
    }

    .profile-photo-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, 
            rgba(99, 102, 241, 0.03) 0%, 
            transparent 50%, 
            rgba(139, 92, 246, 0.02) 100%);
        pointer-events: none;
    }

    .profile-photo-layout {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 48px;
        position: relative;
        z-index: 1;
    }

    @@media (max-width: 640px) {
        .profile-photo-card {
            padding: 24px;
        }
        .profile-photo-layout {
            flex-direction: column;
            gap: 32px;
            text-align: center;
        }
    }

    /* Left Column: Text + Button */
    .profile-photo-info {
        flex: 1;
        min-width: 0;
    }

    .profile-photo-title {
        font-size: 1.375rem;
        font-weight: 600;
        color: #F3F4F6;
        margin: 0 0 8px 0;
        letter-spacing: -0.01em;
    }

    .profile-photo-subtitle {
        font-size: 0.9375rem;
        color: #9CA3AF;
        margin: 0 0 24px 0;
        line-height: 1.5;
    }

    .profile-upload-wrapper {
        display: inline-block;
    }

    .profile-upload-btn {
        padding: 12px 28px !important;
        border-radius: 12px !important;
        font-size: 0.9375rem !important;
        font-weight: 600 !important;
        text-transform: none !important;
        letter-spacing: 0 !important;
        box-shadow: 0 4px 14px rgba(99, 102, 241, 0.35) !important;
        transition: all 0.2s ease !important;
    }

    .profile-upload-btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(99, 102, 241, 0.45) !important;
    }

    .profile-upload-btn:disabled {
        opacity: 0.7;
    }

    /* Right Column: Avatar with Glow */
    .profile-photo-avatar-container {
        flex-shrink: 0;
    }

    @@media (max-width: 640px) {
        .profile-photo-avatar-container {
            order: -1;
        }
    }

    .profile-avatar-glow {
        position: relative;
        display: inline-block;
    }

    .profile-avatar-glow::before {
        content: '';
        position: absolute;
        inset: -8px;
        border-radius: 50%;
        background: linear-gradient(135deg, 
            rgba(99, 102, 241, 0.4) 0%, 
            rgba(139, 92, 246, 0.3) 50%, 
            rgba(99, 102, 241, 0.2) 100%);
        filter: blur(16px);
        opacity: 0.6;
        z-index: -1;
    }

    .profile-avatar-glow::after {
        content: '';
        position: absolute;
        inset: -3px;
        border-radius: 50%;
        background: linear-gradient(135deg, 
            rgba(99, 102, 241, 0.5) 0%, 
            rgba(139, 92, 246, 0.4) 100%);
        opacity: 0.8;
        z-index: 0;
    }

    .profile-avatar {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        z-index: 1;
        border: 3px solid rgba(30, 41, 59, 0.8);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    .profile-avatar-image {
        overflow: hidden;
    }

    .profile-avatar-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .profile-avatar-initials {
        background: linear-gradient(135deg, #6366F1 0%, #7C3AED 100%);
    }

    .profile-avatar-initials span {
        font-size: 2.5rem;
        font-weight: 700;
        color: white;
        text-transform: uppercase;
        letter-spacing: 0.02em;
    }

    /* Delete Photo Button */
    .profile-photo-avatar-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 12px;
    }

    .delete-photo-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        padding: 8px 16px;
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.3);
        border-radius: 8px;
        color: #F87171;
        font-size: 0.75rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .delete-photo-btn:hover {
        background: rgba(239, 68, 68, 0.2);
        border-color: rgba(239, 68, 68, 0.5);
        color: #EF4444;
        transform: translateY(-1px);
    }

    .delete-photo-btn svg {
        flex-shrink: 0;
    }

    /* Metadata Footer */
    .profile-photo-meta {
        font-size: 0.8125rem;
        color: #6B7280;
        margin: 24px 0 0 0;
        position: relative;
        z-index: 1;
    }

    @@media (max-width: 640px) {
        .profile-photo-meta {
            text-align: center;
        }
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       TOGGLE GRID (Action Buttons)
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .toggle-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
    }

    @@media (max-width: 600px) {
        .toggle-grid {
            grid-template-columns: 1fr;
        }
    }

    .toggle-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 12px 16px;
        background: var(--dt-surface-2, #162234);
        border-radius: var(--dt-radius-lg, 12px);
        cursor: pointer;
        transition: background var(--dt-transition-fast, 150ms ease);
    }

    .toggle-item:hover {
        background: var(--dt-hover-surface, #17243A);
    }

    .toggle-label {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.875rem;
        color: var(--dt-text-primary, #E5E7EB);
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       APPEARANCE SECTION STYLES
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .icon-appearance {
        background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
    }

    .appearance-chips-summary {
        display: flex;
        gap: 8px;
        margin-left: auto;
        margin-right: 12px;
    }

    .summary-chip {
        background: rgba(99, 102, 241, 0.15);
        border: 1px solid rgba(99, 102, 241, 0.3);
        color: #A5B4FC;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 0.7rem;
        font-weight: 500;
        white-space: nowrap;
    }

    @@media (max-width: 768px) {
        .appearance-chips-summary {
            display: none;
        }
    }

    .appearance-content {
        display: flex;
        flex-direction: column;
        gap: 24px;
    }

    .appearance-block {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .appearance-block-title {
        font-size: 0.8125rem;
        font-weight: 600;
        color: var(--dt-text-secondary, #9CA3AF);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin: 0;
    }

    /* Presets Grid */
    .appearance-presets-grid {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: 12px;
    }

    @@media (max-width: 900px) {
        .appearance-presets-grid {
            grid-template-columns: repeat(3, 1fr);
        }
    }

    @@media (max-width: 500px) {
        .appearance-presets-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    .appearance-preset-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        padding: 12px;
        background: var(--dt-surface-2, #162234);
        border: 2px solid transparent;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
        position: relative;
    }

    .appearance-preset-card:hover {
        background: var(--dt-hover-surface, #17243A);
        border-color: rgba(99, 102, 241, 0.3);
    }

    .appearance-preset-card.selected {
        border-color: #6366F1;
        background: rgba(99, 102, 241, 0.1);
    }

    .preset-preview {
        width: 100%;
        height: 50px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .preset-name {
        font-size: 0.75rem;
        color: var(--dt-text-secondary, #9CA3AF);
        text-align: center;
    }

    .preset-check {
        position: absolute;
        top: 6px;
        right: 6px;
        width: 20px;
        height: 20px;
        background: #6366F1;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
    }
    
    .preset-check.light {
        background: #475569;
    }
    
    /* Preset Categories */
    .appearance-presets-block {
        gap: 20px;
    }
    
    .preset-category {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }
    
    .preset-category-label {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 0.75rem;
        font-weight: 500;
        color: var(--dt-text-muted, #6B7280);
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    
    .preset-category-label .mud-icon-root {
        font-size: 1rem;
    }
    
    /* Accent Dot on Preview */
    .preset-preview {
        position: relative;
    }
    
    .preset-accent-dot {
        position: absolute;
        bottom: 6px;
        right: 6px;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        border: 2px solid rgba(0, 0, 0, 0.3);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    
    /* Light Theme Preset Cards */
    .appearance-preset-card.light {
        background: var(--dt-surface-light, #F1F5F9);
        border-color: rgba(0, 0, 0, 0.1);
    }
    
    .appearance-preset-card.light:hover {
        background: var(--dt-surface-light-hover, #E2E8F0);
        border-color: rgba(71, 85, 105, 0.3);
    }
    
    .appearance-preset-card.light.selected {
        border-color: #475569;
        background: rgba(71, 85, 105, 0.1);
    }
    
    .appearance-preset-card.light .preset-name {
        color: #374151;
    }

    /* Options Row */
    .appearance-options-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 24px;
    }
    
    /* Simplified Options (Single centered block) */
    .appearance-options-simple {
        display: flex;
        justify-content: center;
        width: 100%;
    }
    
    .appearance-block-full {
        width: 100%;
        max-width: 320px;
    }
    
    .segment-selector-centered {
        justify-content: center;
    }
    
    .segment-selector-centered .segment-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
    }
    
    .image-upload-section {
        margin-top: 12px;
        display: flex;
        justify-content: center;
    }

    @@media (max-width: 640px) {
        .appearance-options-row {
            grid-template-columns: 1fr;
        }
        
        .appearance-block-full {
            max-width: 100%;
        }
    }

    /* Segment Selector */
    .segment-selector {
        display: flex;
        background: var(--dt-surface-2, #162234);
        border-radius: 10px;
        padding: 4px;
        gap: 4px;
    }

    .segment-btn {
        flex: 1;
        padding: 10px 16px;
        border: none;
        background: transparent;
        color: var(--dt-text-secondary, #9CA3AF);
        font-size: 0.8125rem;
        font-weight: 500;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .segment-btn:hover {
        color: var(--dt-text-primary, #E5E7EB);
    }

    .segment-btn.active {
        background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%);
        color: white;
        box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
    }

    /* Intensity Slider */
    .intensity-slider {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-top: 8px;
    }

    .slider-label {
        font-size: 0.75rem;
        color: var(--dt-text-muted, #6B7280);
        min-width: 70px;
    }

    /* Footer */
    .appearance-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-top: 8px;
        border-top: 1px solid rgba(99, 102, 241, 0.1);
    }

    .advanced-toggle-link,
    .reset-link {
        display: flex;
        align-items: center;
        gap: 6px;
        background: none;
        border: none;
        color: var(--dt-text-muted, #6B7280);
        font-size: 0.8125rem;
        cursor: pointer;
        padding: 8px 12px;
        border-radius: 8px;
        transition: all 0.2s ease;
    }

    .advanced-toggle-link:hover {
        color: #A5B4FC;
        background: rgba(99, 102, 241, 0.1);
    }

    .reset-link:hover {
        color: #F87171;
        background: rgba(239, 68, 68, 0.1);
    }

    /* Advanced Options */
    .advanced-options {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        padding-top: 16px;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }
    
    .advanced-options > .advanced-block {
        flex: 1 1 200px;
        min-width: 180px;
        max-width: 280px;
    }

    @@media (max-width: 1100px) {
        .advanced-options > .advanced-block {
            flex: 1 1 220px;
            max-width: none;
        }
    }

    @@media (max-width: 700px) {
        .advanced-options {
            flex-direction: column;
        }
        .advanced-options > .advanced-block {
            flex: 1 1 100%;
            max-width: 100%;
        }
    }

    .advanced-block {
        display: flex;
        flex-direction: column;
        gap: 12px;
        padding: 16px;
        background: var(--dt-surface-2, #162234);
        border-radius: 12px;
    }

    .advanced-block-title {
        font-size: 0.75rem;
        font-weight: 600;
        color: var(--dt-text-muted, #6B7280);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin: 0;
    }

    .advanced-controls {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .control-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
    }

    .control-row > span {
        font-size: 0.8125rem;
        color: var(--dt-text-secondary, #9CA3AF);
    }

    .radio-group {
        display: flex;
        gap: 4px;
    }

    .radio-btn {
        padding: 6px 12px;
        border: 1px solid rgba(99, 102, 241, 0.2);
        background: transparent;
        color: var(--dt-text-muted, #6B7280);
        font-size: 0.75rem;
        font-weight: 500;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .radio-btn:hover {
        border-color: rgba(99, 102, 241, 0.4);
        color: var(--dt-text-secondary, #9CA3AF);
    }

    .radio-btn.active {
        background: #6366F1;
        border-color: #6366F1;
        color: white;
    }
    
    /* Toggle de Independencia */
    .control-row-toggle {
        flex-direction: column;
        align-items: flex-start !important;
        gap: 8px;
        padding-bottom: 12px;
        border-bottom: 1px solid rgba(99, 102, 241, 0.1);
        margin-bottom: 8px;
    }
    
    .control-row-toggle > .toggle-info {
        display: flex;
        flex-direction: column;
        gap: 2px;
    }
    
    .control-row-toggle .toggle-hint {
        font-size: 0.7rem;
        color: var(--dt-text-muted, #6B7280);
        font-weight: 400;
    }
    
    .control-row-inherited {
        justify-content: center;
        padding: 8px 0;
    }
    
    .inherited-label {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 0.75rem;
        color: var(--dt-text-muted, #6B7280);
        font-style: italic;
    }
    
    /* Color Picker Swatches */
    .color-picker-row {
        display: flex;
        gap: 6px;
    }
    
    .color-swatch {
        width: 28px;
        height: 28px;
        border-radius: 6px;
        border: 2px solid transparent;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .color-swatch:hover {
        transform: scale(1.1);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }
    
    .color-swatch.selected {
        border-color: #6366F1;
        box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.3);
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       SAVE SECTION
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .save-section {
        display: flex;
        justify-content: flex-end;
        padding: 8px 0;
    }

    .save-btn-main {
        padding: 14px 40px !important;
        font-size: 0.9375rem !important;
        font-weight: 600 !important;
        box-shadow: 0 4px 14px rgba(99, 102, 241, 0.4) !important;
        transition: all var(--dt-transition-normal, 250ms ease) !important;
    }

    .save-btn-main:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(99, 102, 241, 0.5) !important;
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       PREMIUM IPHONE-STYLE PREVIEW SIDEBAR
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    
    /* CSS Variables for Phone Dimensions - Target: 409x717 (Pro Max ratio ~1.75) */
    .preview-sidebar {
        --phone-width: clamp(280px, 90%, 380px);
        --phone-height: clamp(560px, 85vh, 720px);
        --phone-radius: 48px;
        --screen-radius: 40px;
        --panel-min-height: clamp(640px, 70vh, 780px);
        position: relative;
        max-width: 100%;
        overflow: hidden;
    }

    .preview-sticky {
        position: sticky;
        top: 80px;
    }

    /* Premium Panel Container with Glow */
    .preview-panel {
        background: linear-gradient(145deg, #0D1321 0%, #1A1F2E 50%, #151B28 100%);
        border-radius: 24px;
        padding: 24px;
        border: 1px solid rgba(99, 102, 241, 0.15);
        box-shadow: 
            0 0 40px rgba(99, 102, 241, 0.08),
            0 0 80px rgba(139, 92, 246, 0.05),
            0 20px 60px rgba(0, 0, 0, 0.4);
        position: relative;
        overflow: hidden;
        min-height: var(--panel-min-height);
        display: flex;
        flex-direction: column;
        box-sizing: border-box;
    }

    .preview-panel::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle at 30% 20%, rgba(99, 102, 241, 0.06) 0%, transparent 50%);
        pointer-events: none;
    }

    /* Panel Header */
    .preview-panel-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 20px;
        position: relative;
        z-index: 1;
        flex-shrink: 0;
    }

    .preview-panel-icon {
        width: 36px;
        height: 36px;
        border-radius: 10px;
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.2));
        border: 1px solid rgba(99, 102, 241, 0.3);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #A78BFA;
    }

    .preview-panel-text {
        flex: 1;
        min-width: 0;
    }

    .preview-panel-title {
        font-size: 1.125rem;
        font-weight: 600;
        color: #F3F4F6;
        margin: 0;
        letter-spacing: -0.01em;
    }

    .preview-panel-subtitle {
        font-size: 0.75rem;
        color: #6B7280;
        margin: 2px 0 0 0;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    /* iPhone Device Frame - PRO MAX Size */
    .iphone-frame {
        position: relative;
        width: var(--phone-width);
        max-width: 100%;
        height: var(--phone-height);
        margin: 0 auto;
        background: linear-gradient(145deg, #1C1C1E 0%, #2C2C2E 50%, #1C1C1E 100%);
        border-radius: var(--phone-radius);
        padding: 14px;
        box-sizing: border-box;
        box-shadow: 
            inset 0 0 0 1px rgba(255, 255, 255, 0.1),
            0 0 0 1px rgba(0, 0, 0, 0.5),
            0 30px 60px rgba(0, 0, 0, 0.5),
            0 15px 30px rgba(0, 0, 0, 0.3);
        flex-shrink: 0;
    }

    .iphone-frame::before {
        content: '';
        position: absolute;
        top: 0;
        left: 20%;
        right: 20%;
        height: 3px;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.15), transparent);
        border-radius: 0 0 10px 10px;
    }

    /* Dynamic Island */
    .dynamic-island {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        width: 100px;
        height: 32px;
        background: #000000;
        border-radius: 20px;
        z-index: 10;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    /* iPhone Screen */
    .iphone-screen {
        background: linear-gradient(180deg, #0F172A 0%, #1E293B 100%);
        border-radius: var(--screen-radius);
        overflow: hidden;
        position: relative;
        height: 100%;
        display: flex;
        flex-direction: column;
    }

    /* Status Bar */
    .status-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 22px 18px 16px;
        color: rgba(255, 255, 255, 0.8);
        font-size: 0.75rem;
        font-weight: 600;
        flex-shrink: 0;
    }

    .status-time {
        font-weight: 600;
    }

    .status-icons {
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .status-icons .mud-icon-root {
        font-size: 14px !important;
    }

    /* Card Header Gradient */
    .phone-card-header {
        background: linear-gradient(135deg, 
            rgba(132, 250, 176, 0.8) 0%, 
            rgba(143, 211, 244, 0.8) 25%,
            rgba(167, 139, 250, 0.6) 50%,
            rgba(251, 194, 235, 0.8) 75%,
            rgba(143, 211, 244, 0.6) 100%);
        position: relative;
        flex-shrink: 0;
    }

    .phone-card-header::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 60px;
        background: linear-gradient(to bottom, transparent, #0F172A);
    }

    /* Scrollable Phone Content - FLEXIBLE HEIGHT */
    .phone-card-content {
        flex: 1;
        overflow-y: auto;
        overflow-x: hidden;
        padding: 14px 8px 28px;
        text-align: center;
        scrollbar-width: none;
        -ms-overflow-style: none;
        overscroll-behavior: contain;
    }

    .phone-card-content::-webkit-scrollbar {
        display: none;
    }

    /* Phone Avatar - ENLARGED for visual anchor */
    .phone-avatar-section {
        margin-top: 0px;
        margin-bottom: 20px;
        position: relative;
        z-index: 5;
    }

    .phone-avatar {
        width: 130px;
        height: 130px;
        border-radius: 50%;
        margin: 0 auto;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 5px solid #1E293B;
        box-shadow: 
            0 0 0 3px rgba(99, 102, 241, 0.35),
            0 0 30px rgba(99, 102, 241, 0.15),
            0 12px 32px rgba(0, 0, 0, 0.5);
        overflow: hidden;
    }

    .phone-avatar-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .phone-avatar-initials {
        background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%);
    }

    .phone-avatar-initials span {
        font-size: 2.75rem;
        font-weight: 700;
        color: white;
        text-transform: uppercase;
    }
    
    /* Avatar Dynamic Sizes */
    .phone-avatar.avatar-size-s {
        width: 90px;
        height: 90px;
    }
    .phone-avatar.avatar-size-s span {
        font-size: 2rem;
    }
    
    .phone-avatar.avatar-size-m {
        width: 130px;
        height: 130px;
    }
    .phone-avatar.avatar-size-m span {
        font-size: 2.75rem;
    }
    
    .phone-avatar.avatar-size-l {
        width: 160px;
        height: 160px;
    }
    .phone-avatar.avatar-size-l span {
        font-size: 3.5rem;
    }
    
    /* Avatar Glow Effect */
    .phone-avatar.avatar-glow {
        box-shadow: 
            0 0 0 3px rgba(99, 102, 241, 0.35),
            0 0 30px rgba(99, 102, 241, 0.25),
            0 0 60px rgba(139, 92, 246, 0.15),
            0 12px 32px rgba(0, 0, 0, 0.5);
    }
    
    .phone-avatar:not(.avatar-glow) {
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
    }

    /* Phone Identity - Uses ThemeTokens CSS variables for light/dark theme support */
    .phone-name {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--dt-text-primary, #FFFFFF);
        margin: 0 0 4px 0;
        letter-spacing: -0.02em;
    }

    .phone-title {
        font-size: 0.9375rem;
        font-weight: 500;
        color: var(--dt-accent-primary, #A78BFA);
        margin: 0 0 4px 0;
    }

    .phone-company {
        font-size: 0.8125rem;
        color: var(--dt-text-secondary, #9CA3AF);
        margin: 0 0 16px 0;
    }

    /* Phone Bio */
    .phone-bio {
        font-size: 0.8125rem;
        color: var(--dt-text-muted, #D1D5DB);
        line-height: 1.6;
        margin: 0 0 20px 0;
        text-align: left;
    }

    .phone-bio-placeholder {
        color: var(--dt-text-muted, #6B7280);
        font-style: italic;
        opacity: 0.7;
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       Phone CTA Buttons - REDESIGNED LAYOUT
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .phone-cta-container {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-bottom: 20px;
        width: 100%;
    }

    /* Primary CTA: Guardar Contacto (Full Width) */
    .phone-cta-primary {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        width: 100%;
        padding: 14px 20px;
        border-radius: 14px;
        font-size: 0.9375rem;
        font-weight: 600;
        color: white;
        background: linear-gradient(135deg, #6366F1 0%, #4F46E5 100%);
        border: none;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: 0 4px 16px rgba(99, 102, 241, 0.35);
    }

    .phone-cta-primary .mud-icon-root {
        font-size: 20px !important;
    }

    .phone-cta-primary:hover {
        background: linear-gradient(135deg, #818CF8 0%, #6366F1 100%);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(99, 102, 241, 0.45);
    }

    /* Secondary Row: WhatsApp, Llamar, Email */
    .phone-cta-secondary-row {
        display: flex;
        justify-content: center;
        gap: 8px;
        width: 100%;
    }

    .phone-cta-secondary-row:empty {
        display: none;
    }

    .phone-cta-secondary {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        flex: 1;
        min-width: 0;
        max-width: 120px;
        padding: 10px 12px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
        color: white;
        border: none;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        white-space: nowrap;
    }

    .phone-cta-secondary .mud-icon-root {
        font-size: 16px !important;
        flex-shrink: 0;
    }

    .phone-cta-secondary span {
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .phone-cta-secondary:hover {
        transform: translateY(-2px);
    }

    /* WhatsApp - Green Brand */
    .cta-whatsapp {
        background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
    }

    .cta-whatsapp:hover {
        background: linear-gradient(135deg, #4AE384 0%, #25D366 100%);
        box-shadow: 0 4px 14px rgba(37, 211, 102, 0.35);
    }

    /* Llamar - Violet/Indigo */
    .cta-llamar {
        background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
    }

    .cta-llamar:hover {
        background: linear-gradient(135deg, #A78BFA 0%, #8B5CF6 100%);
        box-shadow: 0 4px 14px rgba(139, 92, 246, 0.35);
    }

    /* Email - Orange */
    .cta-email {
        background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
    }

    .cta-email:hover {
        background: linear-gradient(135deg, #FBBF24 0%, #F59E0B 100%);
        box-shadow: 0 4px 14px rgba(245, 158, 11, 0.35);
    }
    
    /* Button Shape Dynamic - Applied via .btn-shape-* */
    .btn-shape-pill .phone-cta-primary,
    .btn-shape-pill .phone-cta-outline {
        border-radius: 50px;
    }
    
    .btn-shape-rounded .phone-cta-primary,
    .btn-shape-rounded .phone-cta-outline {
        border-radius: 14px;
    }
    
    .btn-shape-square .phone-cta-primary,
    .btn-shape-square .phone-cta-outline {
        border-radius: 6px;
    }
    
    /* Button Style Dynamic - Applied via .btn-style-* */
    .btn-style-outline .phone-cta-primary {
        background: transparent;
        border: 2px solid #6366F1;
        color: #A5B4FC;
        box-shadow: none;
    }
    
    .btn-style-outline .phone-cta-primary:hover {
        background: rgba(99, 102, 241, 0.1);
        border-color: #818CF8;
        transform: translateY(-2px);
    }

    /* Status Chips */
    .phone-status-chips {
        display: flex;
        justify-content: center;
        gap: 6px;
        flex-wrap: wrap;
        margin-bottom: 16px;
    }

    .phone-chip {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 4px 10px;
        background: rgba(255, 255, 255, 0.06);
        border-radius: 16px;
        font-size: 0.65rem;
        color: rgba(255, 255, 255, 0.7);
        border: 1px solid rgba(255, 255, 255, 0.08);
        white-space: nowrap;
    }

    .chip-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: #22C55E;
        box-shadow: 0 0 6px rgba(34, 197, 94, 0.5);
    }

    /* CTA Outline Buttons - Matching Public Card */
    .phone-cta-outline {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        flex: 1;
        padding: 10px 12px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        background: transparent;
        border: 2px solid;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .cta-whatsapp-outline {
        border-color: #25D366;
        color: #25D366;
    }

    .cta-whatsapp-outline:hover {
        background: rgba(37, 211, 102, 0.1);
    }

    .cta-llamar-outline {
        border-color: #8B5CF6;
        color: #A78BFA;
    }

    .cta-llamar-outline:hover {
        background: rgba(139, 92, 246, 0.1);
    }

    .cta-email-outline {
        border-color: #F59E0B;
        color: #FBBF24;
    }

    .cta-email-outline:hover {
        background: rgba(245, 158, 11, 0.1);
    }

    /* Phone Social Icons */
    .phone-social-row {
        display: flex;
        justify-content: center;
        gap: 12px;
        margin-bottom: 20px;
    }

    .phone-social-icon {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #9CA3AF;
        transition: all 0.2s ease;
    }

    .phone-social-icon:hover {
        background: rgba(99, 102, 241, 0.2);
        color: #A78BFA;
        border-color: rgba(99, 102, 241, 0.3);
    }

    /* Rectangular social icons like public card */
    .phone-social-icon-rect {
        width: 40px;
        height: 36px;
        border-radius: 10px;
        background: rgba(30, 20, 50, 0.8);
        border: 1px solid rgba(139, 92, 246, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #E5E7EB;
        transition: all 0.2s ease;
    }

    .phone-social-icon-rect:hover {
        background: rgba(139, 92, 246, 0.3);
        color: white;
        border-color: rgba(139, 92, 246, 0.4);
        transform: translateY(-2px);
    }

    /* Phone URL Section */
    .phone-url-section {
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid rgba(255, 255, 255, 0.08);
    }

    .phone-url-input {
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 10px 14px;
        margin-bottom: 12px;
    }

    .phone-url-text {
        font-size: 0.75rem;
        color: #9CA3AF;
        display: block;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .phone-url-cta {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        font-size: 0.8125rem;
        font-weight: 600;
        color: #A78BFA;
        text-decoration: none;
        padding: 8px;
        transition: all 0.2s ease;
    }

    .phone-url-cta:hover {
        color: #C4B5FD;
    }

    .phone-url-cta span {
        font-size: 1rem;
    }

    /* Preview URL Section - OUTSIDE Phone */
    .preview-url-section {
        margin-top: 20px;
        padding: 0 8px;
    }

    .preview-url-input {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: rgba(17, 24, 39, 0.8);
        border: 1px solid rgba(99, 102, 241, 0.2);
        border-radius: 12px;
        padding: 12px 16px;
        margin-bottom: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .preview-url-input:hover {
        border-color: rgba(99, 102, 241, 0.4);
        background: rgba(17, 24, 39, 0.95);
    }

    .preview-url-text {
        font-size: 0.8rem;
        color: #9CA3AF;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        flex: 1;
    }

    .preview-url-input .copy-icon {
        color: #6366F1;
        opacity: 0.7;
        transition: opacity 0.2s ease;
    }

    .preview-url-input:hover .copy-icon {
        opacity: 1;
    }

    .preview-url-cta {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        font-size: 0.875rem;
        font-weight: 600;
        color: #A78BFA;
        text-decoration: none;
        padding: 12px 16px;
        background: rgba(139, 92, 246, 0.1);
        border: 1px solid rgba(139, 92, 246, 0.2);
        border-radius: 12px;
        transition: all 0.2s ease;
    }

    .preview-url-cta:hover {
        color: #C4B5FD;
        background: rgba(139, 92, 246, 0.2);
        border-color: rgba(139, 92, 246, 0.4);
        transform: translateY(-1px);
    }

    .preview-url-cta span {
        font-size: 1.1rem;
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       Phone Gallery Preview (Portfolio Template)
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .phone-gallery-section {
        margin-top: 16px;
        padding: 16px 0;
        border-top: 1px solid rgba(139, 92, 246, 0.2);
    }
    
    .phone-gallery-title {
        font-size: 0.7rem;
        font-weight: 600;
        color: #94A3B8;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin: 0 0 12px;
    }
    
    .phone-gallery-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
    }
    
    .phone-gallery-item {
        aspect-ratio: 1;
        border-radius: 8px;
        overflow: hidden;
        background: #1E293B;
    }
    
    .phone-gallery-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    .phone-gallery-more {
        font-size: 0.7rem;
        color: #8B5CF6;
        text-align: center;
        margin: 8px 0 0;
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       Phone Lead Form Section - Preview
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .phone-lead-form-section {
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid rgba(139, 92, 246, 0.2);
    }
    
    .phone-lead-header {
        text-align: center;
        margin-bottom: 16px;
    }
    
    .phone-lead-title {
        font-size: 0.9rem;
        font-weight: 600;
        color: rgba(255, 255, 255, 0.95);
        margin: 0 0 4px 0;
    }
    
    .phone-lead-subtitle {
        font-size: 0.7rem;
        color: rgba(255, 255, 255, 0.5);
        margin: 0;
    }
    
    .phone-lead-form {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }
    
    .phone-form-field {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }
    
    .phone-field-label {
        display: flex;
        align-items: center;
        gap: 4px;
        font-size: 0.65rem;
        font-weight: 500;
        color: rgba(255, 255, 255, 0.6);
    }
    
    .phone-field-label .mud-icon-root {
        font-size: 12px !important;
        color: rgba(255, 255, 255, 0.4);
    }
    
    .required-mark {
        color: #F87171;
    }
    
    .optional-mark {
        color: rgba(255, 255, 255, 0.35);
        font-weight: 400;
    }
    
    .phone-input-mock {
        background: rgba(25, 18, 45, 0.85);
        border: 1px solid rgba(139, 92, 246, 0.3);
        border-radius: 8px;
        padding: 8px 10px;
        font-size: 0.75rem;
        color: #FFFFFF;
        font-weight: 500;
        text-align: left;
    }
    
    .phone-input-row {
        display: flex;
        gap: 6px;
    }
    
    .phone-country-mock {
        background: rgba(25, 18, 45, 0.85);
        border: 1px solid rgba(139, 92, 246, 0.3);
        border-radius: 8px;
        padding: 8px 10px;
        font-size: 0.7rem;
        color: #FFFFFF;
        font-weight: 500;
        flex-shrink: 0;
        white-space: nowrap;
    }
    
    .phone-input-number {
        flex: 1;
    }
    
    .phone-textarea-mock {
        background: rgba(25, 18, 45, 0.85);
        border: 1px solid rgba(139, 92, 246, 0.3);
        border-radius: 8px;
        padding: 8px 10px;
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.4);
        font-weight: 400;
        min-height: 40px;
        text-align: left;
    }
    
    .phone-submit-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        width: 100%;
        padding: 10px;
        margin-top: 4px;
        background: linear-gradient(135deg, #14B8A6 0%, #0D9488 100%);
        color: #fff;
        font-size: 0.75rem;
        font-weight: 600;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        box-shadow: 0 3px 12px rgba(20, 184, 166, 0.35);
    }
    
    .phone-submit-btn .mud-icon-root {
        font-size: 14px !important;
    }
    
    .phone-submit-btn:hover {
        background: linear-gradient(135deg, #2DD4BF 0%, #14B8A6 100%);
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       UTILITY CLASSES
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .text-muted {
        color: var(--dt-text-muted, #6B7280);
        font-style: italic;
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       PORTFOLIO GALLERY EDITOR
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .section-portfolio {
        border-color: var(--dt-primary-500, #8B5CF6);
        border-width: 2px;
    }
    
    .icon-gallery {
        background: linear-gradient(135deg, #8B5CF6, #EC4899) !important;
    }
    
    .gallery-upload-area {
        margin-bottom: 20px;
    }
    
    .gallery-dropzone {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 12px;
        padding: 32px;
        background: rgba(139, 92, 246, 0.08);
        border: 2px dashed rgba(139, 92, 246, 0.3);
        border-radius: 16px;
        cursor: pointer;
        transition: all 200ms ease;
        color: var(--dt-text-secondary, #9CA3AF);
    }
    
    .gallery-dropzone:hover:not(.disabled) {
        background: rgba(139, 92, 246, 0.15);
        border-color: var(--dt-primary-500, #8B5CF6);
        color: var(--dt-primary-400, #A78BFA);
    }
    
    .gallery-dropzone.disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    
    .gallery-editor-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 16px;
    }
    
    .gallery-editor-item {
        position: relative;
        border-radius: 12px;
        overflow: hidden;
        background: var(--dt-surface-2, #1F2937);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    
    .gallery-editor-item img {
        width: 100%;
        aspect-ratio: 1;
        object-fit: cover;
        display: block;
    }
    
    .gallery-item-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        display: flex;
        justify-content: center;
        gap: 8px;
        padding: 8px;
        background: linear-gradient(to bottom, rgba(0,0,0,0.7), transparent);
        opacity: 0;
        transition: opacity 200ms ease;
    }
    
    .gallery-editor-item:hover .gallery-item-overlay {
        opacity: 1;
    }
    
    .gallery-item-btn {
        width: 32px;
        height: 32px;
        border: none;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.15);
        color: white;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 150ms ease;
    }
    
    .gallery-item-btn:hover:not(:disabled) {
        background: rgba(255, 255, 255, 0.3);
        transform: scale(1.1);
    }
    
    .gallery-item-btn:disabled {
        opacity: 0.3;
        cursor: not-allowed;
    }
    
    .gallery-item-delete:hover:not(:disabled) {
        background: rgba(239, 68, 68, 0.8);
    }
    
    .gallery-item-title {
        padding: 8px;
        background: var(--dt-surface-2, #1F2937);
    }
    
    .gallery-item-title .mud-input-root {
        font-size: 0.75rem !important;
    }
    
    .gallery-empty-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 40px;
        color: var(--dt-text-muted, #6B7280);
        text-align: center;
    }
    
    .gallery-empty-state p {
        margin: 12px 0 4px;
        font-size: 0.95rem;
        color: var(--dt-text-secondary, #9CA3AF);
    }
    
    .gallery-empty-state span {
        font-size: 0.8rem;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       AUTO-CONTRAST SYSTEM
       Dynamic text colors based on surface luminance
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    /* === MODO OSCURO (texto claro sobre fondo oscuro) === */
    .contrast-dark {
        --surface-text-primary: #FFFFFF;
        --surface-text-secondary: rgba(255, 255, 255, 0.75);
        --surface-text-muted: rgba(255, 255, 255, 0.5);
        --surface-input-bg: rgba(255, 255, 255, 0.08);
        --surface-input-border: rgba(255, 255, 255, 0.2);
        --surface-input-text: #FFFFFF;
        --surface-input-placeholder: rgba(255, 255, 255, 0.5);
        --surface-icon: rgba(255, 255, 255, 0.85);
        --surface-chip-bg: rgba(255, 255, 255, 0.1);
        --surface-chip-text: rgba(255, 255, 255, 0.8);
        --surface-chip-border: rgba(255, 255, 255, 0.15);
        --surface-label-text: rgba(255, 255, 255, 0.85);
    }
    
    /* === MODO CLARO (texto oscuro sobre fondo claro) === */
    .contrast-light {
        --surface-text-primary: #1A1A2E;
        --surface-text-secondary: rgba(26, 26, 46, 0.75);
        --surface-text-muted: rgba(26, 26, 46, 0.5);
        --surface-input-bg: rgba(0, 0, 0, 0.06);
        --surface-input-border: rgba(0, 0, 0, 0.2);
        --surface-input-text: #1A1A2E;
        --surface-input-placeholder: rgba(0, 0, 0, 0.45);
        --surface-icon: rgba(26, 26, 46, 0.85);
        --surface-chip-bg: rgba(0, 0, 0, 0.08);
        --surface-chip-text: rgba(26, 26, 46, 0.8);
        --surface-chip-border: rgba(0, 0, 0, 0.15);
        --surface-label-text: rgba(26, 26, 46, 0.85);
    }
    
    /* Apply contrast variables to phone preview elements */
    .phone-card-content.contrast-dark .phone-name,
    .phone-card-content.contrast-light .phone-name {
        color: var(--surface-text-primary) !important;
    }
    
    .phone-card-content.contrast-dark .phone-title,
    .phone-card-content.contrast-dark .phone-company,
    .phone-card-content.contrast-light .phone-title,
    .phone-card-content.contrast-light .phone-company {
        color: var(--surface-text-secondary) !important;
    }
    
    .phone-card-content.contrast-dark .phone-bio,
    .phone-card-content.contrast-light .phone-bio {
        color: var(--surface-text-secondary) !important;
    }
    
    /* Status chips */
    .phone-card-content.contrast-dark .phone-chip,
    .phone-card-content.contrast-light .phone-chip {
        background: var(--surface-chip-bg) !important;
        color: var(--surface-chip-text) !important;
        border-color: var(--surface-chip-border) !important;
    }
    
    /* Form section in preview */
    .phone-card-content.contrast-dark .phone-form-title,
    .phone-card-content.contrast-light .phone-form-title {
        color: var(--surface-text-primary) !important;
    }
    
    .phone-card-content.contrast-dark .phone-form-subtitle,
    .phone-card-content.contrast-light .phone-form-subtitle {
        color: var(--surface-text-muted) !important;
    }
    
    /* Inputs in preview */
    .phone-card-content.contrast-dark .phone-input,
    .phone-card-content.contrast-light .phone-input {
        background: var(--surface-input-bg) !important;
        border-color: var(--surface-input-border) !important;
        color: var(--surface-input-text) !important;
    }
    
    .phone-card-content.contrast-dark .phone-input::placeholder,
    .phone-card-content.contrast-light .phone-input::placeholder {
        color: var(--surface-input-placeholder) !important;
    }
    
    /* Icons */
    .phone-card-content.contrast-dark .mud-icon-root,
    .phone-card-content.contrast-light .mud-icon-root {
        color: var(--surface-icon) !important;
    }
    
    /* Gallery title */
    .phone-card-content.contrast-dark .phone-gallery-title,
    .phone-card-content.contrast-light .phone-gallery-title {
        color: var(--surface-text-primary) !important;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       LEAD FORM SECTION - Contrast-aware styling for light/dark themes
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    /* Form titles */
    .phone-card-content.contrast-dark .phone-lead-title,
    .phone-card-content.contrast-light .phone-lead-title {
        color: var(--surface-text-primary) !important;
    }
    
    .phone-card-content.contrast-dark .phone-lead-subtitle,
    .phone-card-content.contrast-light .phone-lead-subtitle {
        color: var(--surface-text-muted) !important;
    }
    
    /* Form field labels */
    .phone-card-content.contrast-dark .phone-field-label,
    .phone-card-content.contrast-light .phone-field-label {
        color: var(--surface-label-text) !important;
    }
    
    .phone-card-content.contrast-dark .phone-field-label .mud-icon-root,
    .phone-card-content.contrast-light .phone-field-label .mud-icon-root {
        color: var(--surface-text-muted) !important;
    }
    
    /* Optional mark in form */
    .phone-card-content.contrast-dark .optional-mark,
    .phone-card-content.contrast-light .optional-mark {
        color: var(--surface-text-muted) !important;
    }
    
    /* Form inputs - mock elements */
    .phone-card-content.contrast-dark .phone-input-mock,
    .phone-card-content.contrast-light .phone-input-mock {
        background: var(--surface-input-bg) !important;
        border-color: var(--surface-input-border) !important;
        color: var(--surface-input-text) !important;
    }
    
    .phone-card-content.contrast-dark .phone-country-mock,
    .phone-card-content.contrast-light .phone-country-mock {
        background: var(--surface-input-bg) !important;
        border-color: var(--surface-input-border) !important;
        color: var(--surface-input-text) !important;
    }
    
    .phone-card-content.contrast-dark .phone-textarea-mock,
    .phone-card-content.contrast-light .phone-textarea-mock {
        background: var(--surface-input-bg) !important;
        border-color: var(--surface-input-border) !important;
        color: var(--surface-input-text) !important;
    }
    
    /* Submit button text */
    .phone-card-content.contrast-light .phone-submit-btn span {
        color: var(--surface-text-primary) !important;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SERVICES TEMPLATE PREVIEW - Services List and Booking CTAs
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    .phone-services-section {
        margin-top: 16px;
        padding: 0 12px;
    }
    
    .phone-services-title {
        font-size: 0.65rem;
        font-weight: 700;
        letter-spacing: 1.5px;
        color: rgba(255, 255, 255, 0.5);
        margin-bottom: 10px;
        text-transform: uppercase;
    }
    
    .phone-services-list {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    
    .phone-service-card {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 12px;
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(99, 102, 241, 0.2);
        border-radius: 10px;
        transition: all 150ms ease;
    }
    
    .phone-service-card:hover {
        background: rgba(255, 255, 255, 0.06);
        border-color: rgba(99, 102, 241, 0.35);
    }
    
    .phone-service-icon {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.9rem;
        flex-shrink: 0;
    }
    
    .phone-service-info {
        display: flex;
        flex-direction: column;
        gap: 2px;
        flex: 1;
        min-width: 0;
    }
    
    .phone-service-name {
        font-size: 0.8rem;
        font-weight: 600;
        color: rgba(255, 255, 255, 0.9);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .phone-service-meta {
        font-size: 0.7rem;
        font-weight: 500;
    }
    
    .phone-booking-ctas {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-top: 16px;
    }
    
    .phone-cta-booking {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        padding: 12px 16px;
        border: none;
        font-size: 0.8rem;
        font-weight: 600;
        color: white;
        cursor: pointer;
        transition: all 150ms ease;
    }
    
    .phone-cta-booking:hover {
        filter: brightness(1.1);
        transform: translateY(-1px);
    }
    
    .phone-cta-quote {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        padding: 10px 16px;
        background: transparent;
        border: 1px solid;
        font-size: 0.75rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 150ms ease;
    }
    
    .phone-cta-quote:hover {
        background: rgba(99, 102, 241, 0.1);
    }
    
    /* Contrast-aware Services styles */
    .phone-card-content.contrast-light .phone-services-title {
        color: rgba(26, 26, 46, 0.6);
    }
    
    .phone-card-content.contrast-light .phone-service-card {
        background: rgba(0, 0, 0, 0.03);
        border-color: rgba(99, 102, 241, 0.3);
    }
    
    .phone-card-content.contrast-light .phone-service-name {
        color: rgba(26, 26, 46, 0.9);
    }
    
    .phone-card-content.contrast-light .phone-cta-booking {
        color: white;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SERVICES MODULE PREMIUM STYLES
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    /* Goal Selector */
    .section-goal .icon-goal { background: linear-gradient(135deg, #F59E0B, #D97706); }
    
    .goal-selector {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
    }
    
    .goal-option {
        flex: 1;
        min-width: 200px;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 1rem;
        background: var(--mud-palette-surface);
        border: 2px solid var(--mud-palette-lines-default);
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
        position: relative;
    }
    
    .goal-option:hover {
        border-color: var(--mud-palette-primary);
        background: var(--mud-palette-background-gray);
    }
    
    .goal-option.goal-active {
        border-color: var(--mud-palette-primary);
        background: rgba(var(--mud-palette-primary-rgb), 0.1);
    }
    
    .goal-icon {
        font-size: 1.75rem;
        flex-shrink: 0;
    }
    
    .goal-text {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }
    
    .goal-title {
        font-weight: 600;
        font-size: 0.95rem;
        color: var(--mud-palette-text-primary);
    }
    
    .goal-desc {
        font-size: 0.8rem;
        color: var(--mud-palette-text-secondary);
    }
    
    .goal-check {
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
    }
    
    .goal-hint {
        margin-top: 0.75rem;
        font-size: 0.8rem;
        color: var(--mud-palette-text-secondary);
        text-align: center;
    }
    
    /* Auto-config Banner */
    .auto-config-banner {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1rem;
        background: rgba(var(--mud-palette-primary-rgb), 0.1);
        border-radius: 8px;
        margin-bottom: 1rem;
    }
    
    .auto-config-icon {
        font-size: 1rem;
    }
    
    .auto-config-text {
        font-size: 0.85rem;
        color: var(--mud-palette-text-primary);
    }
    
    .auto-config-hint {
        color: var(--mud-palette-text-secondary);
        font-size: 0.8rem;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       COMPACT CTA STATUS BAR
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    .cta-status-bar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.75rem 1rem;
        background: rgba(var(--mud-palette-primary-rgb), 0.08);
        border-bottom: 1px solid rgba(var(--mud-palette-primary-rgb), 0.15);
    }
    
    .cta-status-left {
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }
    
    .cta-label {
        font-size: 0.8rem;
        color: var(--mud-palette-text-secondary);
        font-weight: 500;
    }
    
    .cta-selector-compact {
        display: flex;
        gap: 0.5rem;
    }
    
    .cta-chip {
        display: flex;
        align-items: center;
        gap: 0.35rem;
        padding: 0.4rem 0.75rem;
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 20px;
        color: var(--mud-palette-text-secondary);
        font-size: 0.8rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .cta-chip:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: var(--mud-palette-primary);
    }
    
    .cta-chip.cta-chip-active {
        background: var(--mud-palette-primary);
        border-color: var(--mud-palette-primary);
        color: white;
    }
    
    .cta-auto-badge {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.4rem 0.75rem;
        background: rgba(var(--mud-palette-primary-rgb), 0.15);
        border-radius: 20px;
        color: var(--mud-palette-text-primary);
        font-size: 0.85rem;
        font-weight: 500;
    }
    
    .cta-auto-tag {
        padding: 0.15rem 0.4rem;
        background: rgba(255, 255, 255, 0.12);
        border-radius: 4px;
        font-size: 0.65rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: var(--mud-palette-text-secondary);
    }
    
    /* Phone CTA Secondary Link */
    .phone-cta-secondary {
        font-size: 0.75rem;
        color: var(--mud-palette-text-secondary);
        text-align: center;
        margin-top: 0.5rem;
        text-decoration: underline;
        cursor: pointer;
    }
    
    /* Services Count */
    .services-add-area {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1rem;
    }
    
    .services-count {
        font-size: 0.85rem;
        color: var(--mud-palette-text-secondary);
    }
    
    /* Service Card Premium */
    .service-editor-card {
        background: var(--mud-palette-surface);
        border: 1px solid var(--mud-palette-lines-default);
        border-radius: 12px;
        padding: 1rem;
        margin-bottom: 1rem;
        transition: all 0.2s ease;
    }
    
    .service-editor-card.service-inactive {
        opacity: 0.6;
        background: var(--mud-palette-background-gray);
    }
    
    .service-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.75rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid var(--mud-palette-lines-default);
    }
    
    .service-header-left {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .service-drag-handle {
        cursor: grab;
        color: var(--mud-palette-text-secondary);
        font-size: 1.25rem;
        padding: 0.25rem;
    }
    
    .service-number {
        font-weight: 600;
        color: var(--mud-palette-primary);
        font-size: 0.9rem;
    }
    
    .service-name-preview {
        color: var(--mud-palette-text-primary);
        font-weight: 500;
        font-size: 0.9rem;
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    
    .service-header-right {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    /* Conversion Type Selector */
    .service-conversion-type {
        margin-bottom: 1rem;
    }
    
    .conversion-label {
        display: block;
        font-size: 0.85rem;
        color: var(--mud-palette-text-secondary);
        margin-bottom: 0.5rem;
    }
    
    .conversion-options {
        display: flex;
        gap: 0.5rem;
    }
    
    .conversion-option {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.4rem;
        padding: 0.6rem 0.5rem;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
        color: var(--mud-palette-text-secondary);
    }
    
    .conversion-option:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: var(--mud-palette-primary);
        color: var(--mud-palette-text-primary);
    }
    
    .conversion-option.conversion-active {
        background: var(--mud-palette-primary);
        border-color: var(--mud-palette-primary);
        color: white;
    }
    
    .conversion-icon {
        font-size: 0.9rem;
    }
    
    .conversion-text {
        font-size: 0.8rem;
        font-weight: 500;
    }
    
    /* Service Basic Fields */
    .service-basic-fields {
        margin-bottom: 0.5rem;
    }
    
    .service-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.75rem;
        margin: 0.5rem 0;
    }
    
    /* Config Panels */
    .service-config-panel {
        background: rgba(0, 0, 0, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        margin-top: 0.75rem;
        overflow: hidden;
    }
    
    .config-panel-header {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1rem;
        cursor: pointer;
        transition: background 0.2s ease;
        background: rgba(255, 255, 255, 0.03);
    }
    
    .config-panel-header:hover {
        background: rgba(255, 255, 255, 0.06);
    }
    
    .config-panel-icon {
        font-size: 1rem;
    }
    
    .config-panel-title {
        flex: 1;
        font-size: 0.85rem;
        font-weight: 500;
        color: var(--mud-palette-text-primary);
    }
    
    .config-panel-content {
        padding: 1rem;
        background: rgba(0, 0, 0, 0.15);
    }
    
    .config-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.75rem;
        margin-bottom: 0.75rem;
    }
    
    .config-sublabel {
        display: block;
        font-size: 0.8rem;
        color: var(--mud-palette-text-secondary);
        margin-bottom: 0.5rem;
    }
    
    /* Quote Fields List */
    .quote-fields-list {
        margin-bottom: 1rem;
    }
    
    .quote-fields-list .mud-checkbox {
        margin: 0.25rem 0;
    }
    
    /* Services Empty State */
    .services-empty-state {
        text-align: center;
        padding: 2rem;
        color: var(--mud-palette-text-secondary);
    }
    
    .services-empty-state p {
        margin: 0.75rem 0 0.25rem;
        font-weight: 500;
    }
    
    .services-empty-state span {
        font-size: 0.85rem;
    }
</style>

@code {
    private Card? _card;
    private bool _isLoading = true;
    private bool _isSaving = false;
    private bool _hasUnsavedChanges = false;
    private string _publicUrl = "";
    private bool _identitySectionExpanded = true;  // Only this open by default
    private bool _contactSectionExpanded = false;
    private bool _socialSectionExpanded = false;
    private bool _actionButtonsSectionExpanded = false;  // Closed by default
    private bool _isUploading = false;
    
    // Appearance Section
    private bool _appearanceSectionExpanded = false;
    private bool _advancedModeExpanded = false;
    private CardStyleModel _cardStyle = new() { ButtonShape = PresetRegistry.Default.Tokens.ButtonShape };
    private ThemeTokens _themeTokens = PresetRegistry.Default.Tokens;
    private string _selectedPreset = "premium-dark";
    
    // Portfolio Gallery
    private bool _isPortfolioTemplate = false;
    private List<GalleryImageModel> _galleryImages = new();
    private bool _isUploadingGallery = false;
    
    // Services Template
    private bool _isServicesTemplate = false;
    private List<DataTouch.Domain.Entities.Service> _services = new();
    private bool _servicesSectionExpanded = false;  // Collapsed by default
    
    // ViewModels for JSON fields
    private SocialLinksModel _socialLinks = new();
    // Note: _websiteLinks kept for data preservation but not shown in UI
    private List<WebsiteLinkModel> _websiteLinks = new();

    protected override async Task OnInitializedAsync()
    {
        var email = AuthService.GetCurrentEmail();
        if (!string.IsNullOrEmpty(email))
        {
            _card = await DbContext.Cards
                .Include(c => c.Organization)
                .FirstOrDefaultAsync(c => c.Email == email);

            if (_card != null)
            {
                var baseUrl = Navigation.BaseUri.TrimEnd('/');
                _publicUrl = $"{baseUrl}/p/{_card.Organization?.Slug}/{_card.Slug}";
                
                // Set default country codes if empty
                if (string.IsNullOrEmpty(_card.PhoneCountryCode)) _card.PhoneCountryCode = "+52";
                if (string.IsNullOrEmpty(_card.WhatsAppCountryCode)) _card.WhatsAppCountryCode = "+52";

                // Deserialize JSON fields
                DeserializeJsonFields();
                
                // Expand social section if has any links
                _socialSectionExpanded = HasAnySocialLink();
                
                // Load services if services template
                await LoadServicesAsync();
            }
        }
        _isLoading = false;
    }

    private void DeserializeJsonFields()
    {
        // Social Links
        if (!string.IsNullOrEmpty(_card?.SocialLinksJson))
        {
            try
            {
                _socialLinks = JsonSerializer.Deserialize<SocialLinksModel>(_card.SocialLinksJson) ?? new();
            }
            catch { _socialLinks = new(); }
        }

        // Website Links (preserved for data integrity, not shown in UI)
        if (!string.IsNullOrEmpty(_card?.WebsiteLinksJson))
        {
            try
            {
                _websiteLinks = JsonSerializer.Deserialize<List<WebsiteLinkModel>>(_card.WebsiteLinksJson) ?? new();
            }
            catch { _websiteLinks = new(); }
        }
        
        // Gallery Images (for portfolio template)
        if (!string.IsNullOrEmpty(_card?.GalleryImagesJson))
        {
            try
            {
                _galleryImages = JsonSerializer.Deserialize<List<GalleryImageModel>>(_card.GalleryImagesJson) ?? new();
            }
            catch { _galleryImages = new(); }
        }
        
        // Appearance Style
        if (!string.IsNullOrEmpty(_card?.AppearanceStyleJson))
        {
            try
            {
                _cardStyle = JsonSerializer.Deserialize<CardStyleModel>(_card.AppearanceStyleJson) ?? new();
                // Sync selected preset from stored PresetId
                if (!string.IsNullOrEmpty(_cardStyle.PresetId))
                {
                    _selectedPreset = _cardStyle.PresetId;
                }
            }
            catch { _cardStyle = new(); }
        }
        
        // Check template type: query param takes priority, else read from saved card
        var uri = new Uri(Navigation.Uri);
        var query = System.Web.HttpUtility.ParseQueryString(uri.Query);
        var templateParam = query["template"];
        
        // Determine effective template: query param > card.TemplateType > "default"
        string effectiveTemplate;
        if (!string.IsNullOrEmpty(templateParam))
        {
            // Query param takes priority - use it immediately AND persist
            effectiveTemplate = templateParam;
            if (_card != null && _card.TemplateType != templateParam)
            {
                _card.TemplateType = templateParam;
                _card.UpdatedAt = DateTime.UtcNow;
                _ = DbContext.SaveChangesAsync(); // Persist for next load
            }
        }
        else
        {
            // No query param - read from saved card
            effectiveTemplate = !string.IsNullOrEmpty(_card?.TemplateType) ? _card.TemplateType : "default";
        }
        
        // Set template flags based on effective template
        _isPortfolioTemplate = effectiveTemplate == "portfolio-creative";
        _isServicesTemplate = effectiveTemplate == "services-quotes";
        
        // Apply Emerald Night theme for Services template
        if (_isServicesTemplate)
        {
            var emeraldPreset = PresetRegistry.GetById("emerald-night");
            if (emeraldPreset != null)
            {
                _themeTokens = emeraldPreset.Tokens;
                _selectedPreset = "emerald-night";
            }
        }
        
        // Clear gallery images when switching away from portfolio template
        if (!_isPortfolioTemplate && _galleryImages.Any())
        {
            _galleryImages.Clear();
            if (_card != null)
            {
                _card.GalleryImagesJson = null;
                _card.UpdatedAt = DateTime.UtcNow;
                _ = DbContext.SaveChangesAsync();
            }
        }
    }

    private async Task SaveCard()
    {
        if (_card == null) return;
        
        _isSaving = true;
        StateHasChanged();

        try
        {
            // Serialize ViewModels to JSON
            if (_socialLinks.HasAnyLink())
            {
                _card.SocialLinksJson = JsonSerializer.Serialize(_socialLinks);
            }
            else
            {
                _card.SocialLinksJson = null;
            }

            // Preserve website links data (not removed from backend)
            var validLinks = _websiteLinks.Where(l => !string.IsNullOrEmpty(l.Title) && !string.IsNullOrEmpty(l.Url)).ToList();
            if (validLinks.Any())
            {
                _card.WebsiteLinksJson = JsonSerializer.Serialize(validLinks);
            }
            else
            {
                _card.WebsiteLinksJson = null;
            }
            
            // Serialize Gallery Images
            if (_galleryImages.Any())
            {
                _card.GalleryImagesJson = JsonSerializer.Serialize(_galleryImages.OrderBy(i => i.Order).ToList());
            }
            else
            {
                _card.GalleryImagesJson = null;
            }
            
            // Serialize Appearance Style
            _card.AppearanceStyleJson = JsonSerializer.Serialize(_cardStyle);
            
            // Save TemplateType based on current state
            if (_isServicesTemplate)
                _card.TemplateType = "services-quotes";
            else if (_isPortfolioTemplate)
                _card.TemplateType = "portfolio-creative";
            // Otherwise keep current value (could be default or other)

            _card.UpdatedAt = DateTime.UtcNow;
            await DbContext.SaveChangesAsync();
            
            _hasUnsavedChanges = false;
            Snackbar.Add("Cambios guardados correctamente", Severity.Success);
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Error al guardar: {ex.Message}", Severity.Error);
        }
        finally
        {
            _isSaving = false;
            StateHasChanged();
        }
    }

    private void MarkUnsaved()
    {
        _hasUnsavedChanges = true;
        StateHasChanged(); // Always trigger re-render for preview updates
    }

    private async Task CopyUrl()
    {
        Snackbar.Add("URL copiada al portapapeles", Severity.Info);
    }

    private void ToggleSocialSection()
    {
        _socialSectionExpanded = !_socialSectionExpanded;
    }

    private string GetDisplayCompanyName()
    {
        if (!string.IsNullOrEmpty(_card?.CompanyName))
            return _card.CompanyName;
        return _card?.Organization?.Name ?? "Mi Empresa";
    }

    private bool HasAnySocialLink()
    {
        return !string.IsNullOrEmpty(_socialLinks.LinkedIn) ||
               !string.IsNullOrEmpty(_socialLinks.Instagram) ||
               !string.IsNullOrEmpty(_socialLinks.YouTube) ||
               !string.IsNullOrEmpty(_socialLinks.Twitter);
    }

    private int CountSocialLinks()
    {
        int count = 0;
        if (!string.IsNullOrEmpty(_socialLinks.LinkedIn)) count++;
        if (!string.IsNullOrEmpty(_socialLinks.Instagram)) count++;
        if (!string.IsNullOrEmpty(_socialLinks.Facebook)) count++;
        if (!string.IsNullOrEmpty(_socialLinks.YouTube)) count++;
        if (!string.IsNullOrEmpty(_socialLinks.Twitter)) count++;
        if (!string.IsNullOrEmpty(_socialLinks.Website)) count++;
        return count;
    }

    private void ToggleActionButtonsSection()
    {
        _actionButtonsSectionExpanded = !_actionButtonsSectionExpanded;
    }

    private int CountActiveButtons()
    {
        if (_card == null) return 0;
        int count = 0;
        if (_card.ShowSaveContact) count++;
        if (_card.ShowWhatsApp) count++;
        if (_card.ShowCall) count++;
        if (_card.ShowEmail) count++;
        return count;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // APPEARANCE SECTION METHODS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    private void ToggleAppearanceSection() => _appearanceSectionExpanded = !_appearanceSectionExpanded;
    private void ToggleAdvancedMode() => _advancedModeExpanded = !_advancedModeExpanded;

    private void ApplyPreset(string presetId)
    {
        var preset = _presets.FirstOrDefault(p => p.Id == presetId);
        if (preset == null) return;
        
        _selectedPreset = presetId;
        _cardStyle.PresetId = presetId;
        _cardStyle.BackgroundType = preset.BackgroundType;
        _cardStyle.BackgroundValue = preset.BackgroundValue;
        _cardStyle.CardContainerStyle = preset.CardStyle;
        _cardStyle.ButtonShape = preset.ButtonShape;
        _cardStyle.ButtonStyle = preset.ButtonStyle;
        _cardStyle.BackgroundIsDark = preset.BackgroundIsDark;
        _cardStyle.CardIsDark = preset.CardIsDark;
        _cardStyle.AccentColor = preset.AccentColor;
        
        // Load ThemeTokens from PresetRegistry for consistent styling
        var registryPreset = PresetRegistry.GetById(presetId);
        if (registryPreset != null)
        {
            _themeTokens = registryPreset.Tokens;
            // Sync ButtonShape from ThemeTokens to ensure GetButtonRadius() uses correct value
            _cardStyle.ButtonShape = _themeTokens.ButtonShape;
        }
        
        MarkUnsaved();
    }

    private void ResetAppearanceToDefault()
    {
        _cardStyle = new CardStyleModel();
        _selectedPreset = "premium-dark";
        MarkUnsaved();
    }

    private string GetBackgroundSummary() => _cardStyle.BackgroundType switch
    {
        "gradient" => "Gradiente",
        "solid" => "SÃ³lido",
        "image" => "Imagen",
        _ => "Gradiente"
    };

    private string GetCardSummary() => _cardStyle.CardContainerStyle switch
    {
        "glass" => "Glass",
        "solid" => "Solid",
        "elevated" => "Elevated",
        _ => "Glass"
    };

    private string GetButtonsSummary() => _cardStyle.ButtonShape switch
    {
        "pill" => "Pill",
        "rounded" => "Rounded",
        "square" => "Square",
        _ => "Rounded"
    };

    private string GetPreviewBackgroundStyle()
    {
        // Include all theme CSS variables for consistent styling on light/dark themes
        var cssVariables = ThemeHelper.GenerateCssVariables(_themeTokens);
        return $"background: {_themeTokens.BgValue}; {cssVariables}";
    }
    
    // Border-radius helpers for button shape consistency
    private string GetButtonRadius() => _cardStyle.ButtonShape switch
    {
        "pill" => "50px",
        "square" => "6px",
        _ => "14px" // rounded (default)
    };
    
    private string GetInputRadius() => _cardStyle.ButtonShape switch
    {
        "pill" => "20px",
        "square" => "4px",
        _ => "8px" // rounded
    };
    
    // Get card/container background style when independent
    private string GetCardBackgroundStyle()
    {
        if (_cardStyle.CardLinkedToBackground)
        {
            // Linked mode - return empty, CSS handles it
            return "";
        }
        // Independent mode - apply custom background
        return $"background: {_cardStyle.CardBackgroundColor} !important;";
    }

    // Specific methods for appearance onclick handlers
    // Background Type
    private void SetBackgroundGradient() { _cardStyle.BackgroundType = "gradient"; MarkUnsaved(); }
    private void SetBackgroundSolid() { _cardStyle.BackgroundType = "solid"; MarkUnsaved(); }
    private void SetBackgroundImage() { _cardStyle.BackgroundType = "image"; MarkUnsaved(); }
    
    // Colores = restores the preset's default background type (gradient or solid)
    private void SetBackgroundColores() 
    { 
        // Get the current preset and restore its background type
        var preset = PresetRegistry.GetById(_selectedPreset);
        if (preset != null)
        {
            _cardStyle.BackgroundType = preset.Tokens.BgType;
            _cardStyle.BackgroundValue = preset.Tokens.BgValue;
        }
        else
        {
            // Fallback to gradient if no preset found
            _cardStyle.BackgroundType = "gradient";
        }
        MarkUnsaved(); 
    }
    
    // Card Style
    private void SetCardStyleGlass() { _cardStyle.CardContainerStyle = "glass"; MarkUnsaved(); }
    private void SetCardStyleSolid() { _cardStyle.CardContainerStyle = "solid"; MarkUnsaved(); }
    private void SetCardStyleElevated() { _cardStyle.CardContainerStyle = "elevated"; MarkUnsaved(); }
    
    private void OnGlassIntensityChanged(int value) { _cardStyle.GlassIntensity = value; MarkUnsaved(); }
    
    // Border Radius
    private void SetBorderRadiusSmall() { _cardStyle.BorderRadius = "small"; MarkUnsaved(); }
    private void SetBorderRadiusMedium() { _cardStyle.BorderRadius = "medium"; MarkUnsaved(); }
    private void SetBorderRadiusLarge() { _cardStyle.BorderRadius = "large"; MarkUnsaved(); }
    
    // Shadow Style
    private void SetShadowSoft() { _cardStyle.ShadowStyle = "soft"; MarkUnsaved(); }
    private void SetShadowMedium() { _cardStyle.ShadowStyle = "medium"; MarkUnsaved(); }
    private void SetShadowStrong() { _cardStyle.ShadowStyle = "strong"; MarkUnsaved(); }
    
    // Avatar Size
    private void SetAvatarSizeS() { _cardStyle.AvatarSize = "S"; MarkUnsaved(); }
    private void SetAvatarSizeM() { _cardStyle.AvatarSize = "M"; MarkUnsaved(); }
    private void SetAvatarSizeL() { _cardStyle.AvatarSize = "L"; MarkUnsaved(); }
    
    // Button Shape
    private void SetButtonShapePill() { _cardStyle.ButtonShape = "pill"; MarkUnsaved(); }
    private void SetButtonShapeRounded() { _cardStyle.ButtonShape = "rounded"; MarkUnsaved(); }
    private void SetButtonShapeSquare() { _cardStyle.ButtonShape = "square"; MarkUnsaved(); }
    
    // Button Style
    private void SetButtonStyleFilled() { _cardStyle.ButtonStyle = "filled"; MarkUnsaved(); }
    private void SetButtonStyleOutline() { _cardStyle.ButtonStyle = "outline"; MarkUnsaved(); }
    
    // Contrast Mode
    private void SetContrastAuto() { _cardStyle.ContrastMode = "auto"; MarkUnsaved(); }
    private void SetContrastLight() { _cardStyle.ContrastMode = "force-light"; MarkUnsaved(); }
    private void SetContrastDark() { _cardStyle.ContrastMode = "force-dark"; MarkUnsaved(); }
    
    // Card Independence Toggle
    private void ToggleCardLinked() 
    { 
        _cardStyle.CardLinkedToBackground = !_cardStyle.CardLinkedToBackground; 
        MarkUnsaved(); 
    }
    
    private void SetCardBackgroundColor(string color) 
    { 
        _cardStyle.CardBackgroundColor = color;
        // Determine if color is dark for contrast
        _cardStyle.CardIsDarkOverride = IsHexColorDark(color);
        MarkUnsaved(); 
    }
    
    // Simple luminance check for hex colors
    private bool IsHexColorDark(string hex)
    {
        if (string.IsNullOrEmpty(hex)) return true;
        hex = hex.TrimStart('#');
        if (hex.Length < 6) return true;
        try
        {
            int r = Convert.ToInt32(hex.Substring(0, 2), 16);
            int g = Convert.ToInt32(hex.Substring(2, 2), 16);
            int b = Convert.ToInt32(hex.Substring(4, 2), 16);
            // Relative luminance formula
            double luminance = (0.299 * r + 0.587 * g + 0.114 * b);
            return luminance < 140; // Below threshold = dark
        }
        catch { return true; }
    }
    
    // Get contrast class for background surface
    private string GetBackgroundContrastClass()
    {
        if (_cardStyle.ContrastMode == "force-light") return "contrast-light";
        if (_cardStyle.ContrastMode == "force-dark") return "contrast-dark";
        // Auto mode - use preset's luminance value
        return _cardStyle.BackgroundIsDark ? "contrast-dark" : "contrast-light";
    }
    
    // Get contrast class for card surface
    private string GetCardContrastClass()
    {
        if (_cardStyle.ContrastMode == "force-light") return "contrast-light";
        if (_cardStyle.ContrastMode == "force-dark") return "contrast-dark";
        
        // If card is independent, use its own luminance
        if (!_cardStyle.CardLinkedToBackground)
        {
            return _cardStyle.CardIsDarkOverride ? "contrast-dark" : "contrast-light";
        }
        
        // Linked mode - follow background or use preset's card luminance
        return _cardStyle.CardIsDark ? "contrast-dark" : "contrast-light";
    }
    
    // Get contrast class for form (follows card contrast)
    private string GetFormContrastClass() => GetCardContrastClass();

    private async Task UploadBackgroundImage(IBrowserFile file)
    {
        if (file == null) return;

        try 
        {
            var uploadsPath = Path.Combine(Directory.GetCurrentDirectory(), "wwwroot", "uploads", "backgrounds");
            Directory.CreateDirectory(uploadsPath);
            
            var fileName = $"{Guid.NewGuid()}{Path.GetExtension(file.Name)}";
            var filePath = Path.Combine(uploadsPath, fileName);
            
            using var stream = file.OpenReadStream(maxAllowedSize: 5 * 1024 * 1024);
            using var fileStream = new FileStream(filePath, FileMode.Create);
            await stream.CopyToAsync(fileStream);
            
            _cardStyle.BackgroundImageUrl = $"/uploads/backgrounds/{fileName}";
            MarkUnsaved();
            Snackbar.Add("Imagen de fondo actualizada", Severity.Success);
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Error al subir: {ex.Message}", Severity.Error);
        }
    }

    private string GetInitials(string? name)
    {
        if (string.IsNullOrEmpty(name)) return "?";
        var parts = name.Trim().Split(' ', StringSplitOptions.RemoveEmptyEntries);
        if (parts.Length >= 2)
            return $"{parts[0][0]}{parts[1][0]}".ToUpper();
        return name.Length >= 2 ? name.Substring(0, 2).ToUpper() : name.ToUpper();
    }

    private string FormatLastUpdated(DateTime updatedAt)
    {
        var local = updatedAt.ToLocalTime();
        var diff = DateTime.Now - local;
        
        if (diff.TotalMinutes < 1) return "hace un momento";
        if (diff.TotalMinutes < 60) return $"hace {(int)diff.TotalMinutes} min";
        if (diff.TotalHours < 24) return $"hace {(int)diff.TotalHours} h";
        if (diff.TotalDays < 7) return $"hace {(int)diff.TotalDays} dÃ­as";
        return local.ToString("dd/MM/yyyy HH:mm");
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // VIEW MODELS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    private class SocialLinksModel
    {
        public string? LinkedIn { get; set; }
        public string? Instagram { get; set; }
        public string? Facebook { get; set; }
        public string? YouTube { get; set; }
        public string? Twitter { get; set; }
        public string? Website { get; set; }

        public bool HasAnyLink()
        {
            return !string.IsNullOrEmpty(LinkedIn) ||
                   !string.IsNullOrEmpty(Instagram) ||
                   !string.IsNullOrEmpty(Facebook) ||
                   !string.IsNullOrEmpty(YouTube) ||
                   !string.IsNullOrEmpty(Twitter) ||
                   !string.IsNullOrEmpty(Website);
        }
    }

    private class WebsiteLinkModel
    {
        public string Title { get; set; } = "";
        public string Url { get; set; } = "";
    }

    private class CardStyleModel
    {
        // Fondo Global
        public string BackgroundType { get; set; } = "gradient"; // gradient, solid, image
        public string BackgroundValue { get; set; } = "linear-gradient(135deg, #0F0A1E 0%, #1E1B4B 50%, #0F0A1E 100%)";
        public string? BackgroundImageUrl { get; set; }
        
        // Tarjeta - VinculaciÃ³n e Independencia
        public bool CardLinkedToBackground { get; set; } = true; // Toggle: vinculada/independiente
        public string CardContainerStyle { get; set; } = "glass"; // glass, solid, elevated
        public string CardBackgroundColor { get; set; } = "#1A1035"; // Color para solid independiente
        public int GlassIntensity { get; set; } = 50; // 0-100
        
        // Avanzado - Fondo
        public double OverlayOpacity { get; set; } = 0.5;
        public bool ShowGrain { get; set; } = false;
        
        // Avanzado - Contenedor
        public string BorderRadius { get; set; } = "medium"; // small, medium, large
        public string ShadowStyle { get; set; } = "soft"; // soft, medium, strong
        
        // Avanzado - Avatar
        public string AvatarSize { get; set; } = "M"; // S, M, L
        public bool AvatarGlow { get; set; } = true;
        
        // Avanzado - Botones
        public string ButtonShape { get; set; } = "pill"; // pill, rounded, square
        public string ButtonStyle { get; set; } = "filled"; // filled, outline
        
        // Contraste automÃ¡tico
        public string ContrastMode { get; set; } = "auto"; // auto, force-light, force-dark
        public bool BackgroundIsDark { get; set; } = true;
        public bool CardIsDark { get; set; } = true;
        public bool CardIsDarkOverride { get; set; } = true; // Para tarjeta independiente
        
        // Preset tracking
        public string? PresetId { get; set; } = "premium-dark";
        public string? AccentColor { get; set; } = "#7C3AED";
    }

    private record AppearancePreset(
        string Id, 
        string Name, 
        string Category, // "dark" or "light"
        string Personality, // Target audience description
        string BackgroundType, 
        string BackgroundValue, 
        string CardStyle, 
        string ButtonShape, 
        string ButtonStyle, 
        bool BackgroundIsDark, 
        bool CardIsDark,
        string AccentColor // Primary accent for this preset
    );
    
    private static readonly List<AppearancePreset> _presets = new()
    {
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // DARK PRESETS (8)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        new("premium-dark", "Premium Dark", "dark", "Ejecutivos, consultores",
            "gradient", "linear-gradient(135deg, #0F0A1E 0%, #1E1B4B 50%, #0F0A1E 100%)", 
            "glass", "pill", "filled", true, true, "#7C3AED"),
        
        new("midnight-blue", "Midnight Blue", "dark", "Tech, startups",
            "gradient", "linear-gradient(135deg, #0c1445 0%, #1a237e 50%, #0d1b3e 100%)", 
            "glass", "pill", "filled", true, true, "#00B4D8"),
        
        new("charcoal-gold", "Charcoal Gold", "dark", "Lujo, finanzas",
            "solid", "#1C1C1C", 
            "solid", "pill", "filled", true, true, "#D4AF37"),
        
        new("emerald-night", "Emerald Night", "dark", "Eco, wellness",
            "gradient", "linear-gradient(135deg, #0D1F17 0%, #134E3A 50%, #0D1F17 100%)", 
            "glass", "pill", "filled", true, true, "#10B981"),
        
        new("rose-noir", "Rose Noir", "dark", "Creative, beauty",
            "gradient", "linear-gradient(135deg, #1A0A14 0%, #3D1A2A 50%, #1A0A14 100%)", 
            "glass", "pill", "filled", true, true, "#F472B6"),
        
        new("high-contrast", "High Contrast", "dark", "Accesibilidad",
            "solid", "#000000", 
            "solid", "pill", "filled", true, true, "#FFFFFF"),
        
        new("obsidian", "Obsidian", "dark", "Minimal, tech",
            "solid", "#0A0A0A", 
            "glass", "pill", "outline", true, true, "#64748B"),
        
        new("aurora", "Aurora", "dark", "Creative, events",
            "gradient", "linear-gradient(135deg, #0F172A 0%, #1E3A5F 25%, #3B1E5F 50%, #5F1E3A 75%, #0F172A 100%)", 
            "glass", "pill", "filled", true, true, "#EC4899"),
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // LIGHT PRESETS (8)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        new("minimal-white", "Minimal White", "light", "Clean, corporate",
            "solid", "#F8FAFC", 
            "elevated", "pill", "outline", false, false, "#475569"),
        
        new("soft-cream", "Soft Cream", "light", "Warmth, hospitality",
            "solid", "#FFFBEB", 
            "elevated", "pill", "filled", false, false, "#D97706"),
        
        new("sky-light", "Sky Light", "light", "Fresh, modern",
            "gradient", "linear-gradient(135deg, #E0F2FE 0%, #BAE6FD 50%, #E0F2FE 100%)", 
            "elevated", "pill", "filled", false, false, "#0284C7"),
        
        new("mint-breeze", "Mint Breeze", "light", "Health, wellness",
            "solid", "#ECFDF5", 
            "elevated", "pill", "filled", false, false, "#059669"),
        
        new("pearl-gray", "Pearl Gray", "light", "Elegant, professional",
            "solid", "#F1F5F9", 
            "elevated", "pill", "filled", false, false, "#64748B"),
        
        new("rose-blush", "Rose Blush", "light", "Gentle, welcoming",
            "solid", "#FFF1F2", 
            "elevated", "pill", "filled", false, false, "#E11D48"),
        
        new("ocean-mist", "Ocean Mist", "light", "Calm, trustworthy",
            "gradient", "linear-gradient(135deg, #F0FDFA 0%, #CCFBF1 50%, #F0FDFA 100%)", 
            "elevated", "pill", "filled", false, false, "#14B8A6"),
        
        new("lavender-cloud", "Lavender Cloud", "light", "Creative, serene",
            "solid", "#FAF5FF", 
            "elevated", "pill", "filled", false, false, "#9333EA")
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // PHOTO UPLOAD LOGIC (Single Flow with Loading State)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    private async Task UploadFiles(IBrowserFile file)
    {
        if (_card == null || _isUploading) return;

        _isUploading = true;
        StateHasChanged();

        try 
        {
            // Validation: Max size 5MB
            if (file.Size > 5 * 1024 * 1024)
            {
                Snackbar.Add("Imagen muy pesada. MÃ¡ximo 5 MB permitido.", Severity.Error);
                return;
            }

            var allowedExtensions = new[] { ".jpg", ".jpeg", ".png", ".webp" };
            var extension = Path.GetExtension(file.Name).ToLowerInvariant();
            if (!allowedExtensions.Contains(extension))
            {
                Snackbar.Add("Formato no soportado. Usa JPG, PNG o WebP.", Severity.Error);
                return;
            }

            var uploadsFolder = Path.Combine(Environment.WebRootPath, "uploads");
            if (!Directory.Exists(uploadsFolder)) Directory.CreateDirectory(uploadsFolder);

            var fileName = $"{Guid.NewGuid()}{extension}";
            var filePath = Path.Combine(uploadsFolder, fileName);

            using (var stream = file.OpenReadStream(5 * 1024 * 1024))
            using (var fs = new FileStream(filePath, FileMode.Create))
            {
                await stream.CopyToAsync(fs);
            }

            _card.ProfileImageUrl = $"/uploads/{fileName}";
            MarkUnsaved();
            Snackbar.Add("Foto actualizada", Severity.Success);
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Error al subir: {ex.Message}", Severity.Error);
        }
        finally
        {
            _isUploading = false;
            StateHasChanged();
        }
    }

    private void RemovePhoto()
    {
        if (_card != null) 
        {
            _card.ProfileImageUrl = null;
            MarkUnsaved();
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // COUNTRIES DATA
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    private record CountryCode(string Name, string Code, string Flag, int DigitLength);
    private List<CountryCode> _countries = new()
    {
        new("El Salvador", "+503", "ğŸ‡¸ğŸ‡»", 8),
        new("MÃ©xico", "+52", "ğŸ‡²ğŸ‡½", 10),
        new("Estados Unidos", "+1", "ğŸ‡ºğŸ‡¸", 10),
        new("Argentina", "+54", "ğŸ‡¦ğŸ‡·", 10),
        new("Colombia", "+57", "ğŸ‡¨ğŸ‡´", 10),
        new("EspaÃ±a", "+34", "ğŸ‡ªğŸ‡¸", 9),
        new("PerÃº", "+51", "ğŸ‡µğŸ‡ª", 9),
        new("Chile", "+56", "ğŸ‡¨ğŸ‡±", 9),
        new("Guatemala", "+502", "ğŸ‡¬ğŸ‡¹", 8),
        new("Costa Rica", "+506", "ğŸ‡¨ğŸ‡·", 8)
    };

    private int GetPhoneMaxLength() => _countries.FirstOrDefault(c => c.Code == _card?.PhoneCountryCode)?.DigitLength ?? 15;
    private int GetWhatsAppMaxLength() => _countries.FirstOrDefault(c => c.Code == _card?.WhatsAppCountryCode)?.DigitLength ?? 15;
    
    private string GetBioFeedback()
    {
        var length = _card?.Bio?.Length ?? 0;
        if (length == 0) return "Describe brevemente tu rol o especialidad";
        if (length <= 150) return $"Longitud ideal ({length}/300)";
        if (length <= 250) return $"Considera acortar ({length}/300)";
        return $"Muy largo ({length}/300)";
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // GALLERY IMAGE MODEL
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    private class GalleryImageModel
    {
        public string Url { get; set; } = "";
        public string? Title { get; set; }
        public string? Description { get; set; }
        public int Order { get; set; }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // GALLERY UPLOAD & MANAGEMENT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    private async Task UploadGalleryImage(IBrowserFile file)
    {
        if (_card == null || _isUploadingGallery || _galleryImages.Count >= 10) return;

        _isUploadingGallery = true;
        StateHasChanged();

        try
        {
            // Validation: Max size 5MB
            if (file.Size > 5 * 1024 * 1024)
            {
                Snackbar.Add("Imagen muy pesada. MÃ¡ximo 5 MB permitido.", Severity.Error);
                return;
            }

            var allowedExtensions = new[] { ".jpg", ".jpeg", ".png", ".webp" };
            var extension = Path.GetExtension(file.Name).ToLowerInvariant();
            if (!allowedExtensions.Contains(extension))
            {
                Snackbar.Add("Formato no soportado. Usa JPG, PNG o WebP.", Severity.Error);
                return;
            }

            var uploadsFolder = Path.Combine(Environment.WebRootPath, "uploads", "gallery");
            if (!Directory.Exists(uploadsFolder)) Directory.CreateDirectory(uploadsFolder);

            var fileName = $"{Guid.NewGuid()}{extension}";
            var filePath = Path.Combine(uploadsFolder, fileName);

            using (var stream = file.OpenReadStream(5 * 1024 * 1024))
            using (var fs = new FileStream(filePath, FileMode.Create))
            {
                await stream.CopyToAsync(fs);
            }

            var newImage = new GalleryImageModel
            {
                Url = $"/uploads/gallery/{fileName}",
                Order = _galleryImages.Count
            };
            _galleryImages.Add(newImage);
            
            MarkUnsaved();
            Snackbar.Add("Imagen agregada a la galerÃ­a", Severity.Success);
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Error al subir: {ex.Message}", Severity.Error);
        }
        finally
        {
            _isUploadingGallery = false;
            StateHasChanged();
        }
    }

    private void RemoveGalleryImage(GalleryImageModel image)
    {
        _galleryImages.Remove(image);
        // Reorder remaining images
        var ordered = _galleryImages.OrderBy(i => i.Order).ToList();
        for (int i = 0; i < ordered.Count; i++)
        {
            ordered[i].Order = i;
        }
        MarkUnsaved();
        StateHasChanged();
    }

    private void MoveGalleryImage(GalleryImageModel image, int direction)
    {
        var ordered = _galleryImages.OrderBy(i => i.Order).ToList();
        var currentIndex = ordered.IndexOf(image);
        var newIndex = currentIndex + direction;
        
        if (newIndex < 0 || newIndex >= ordered.Count) return;
        
        // Swap orders
        var other = ordered[newIndex];
        var tempOrder = image.Order;
        image.Order = other.Order;
        other.Order = tempOrder;
        
        MarkUnsaved();
        StateHasChanged();
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SERVICES MANAGEMENT (for services template)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    private async Task LoadServicesAsync()
    {
        if (_card == null) return;
        _services = await DbContext.Services
            .Where(s => s.CardId == _card.Id)
            .OrderBy(s => s.DisplayOrder)
            .ToListAsync();
    }

    private void AddNewService()
    {
        if (_card == null || _services.Count >= 10) return;
        
        var newService = new DataTouch.Domain.Entities.Service
        {
            Id = Guid.NewGuid(),
            CardId = _card.Id,
            OrganizationId = _card.OrganizationId,
            Name = "Nuevo servicio",
            DurationMinutes = 60,
            DisplayOrder = _services.Count,
            IsActive = true,
            CreatedAt = DateTime.UtcNow
        };
        
        _services.Add(newService);
        DbContext.Services.Add(newService);
        MarkUnsaved();
        StateHasChanged();
    }

    private void RemoveService(DataTouch.Domain.Entities.Service service)
    {
        _services.Remove(service);
        DbContext.Services.Remove(service);
        
        // Reorder remaining services
        var ordered = _services.OrderBy(s => s.DisplayOrder).ToList();
        for (int i = 0; i < ordered.Count; i++)
        {
            ordered[i].DisplayOrder = i;
        }
        
        MarkUnsaved();
        StateHasChanged();
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SERVICES MODULE HELPER METHODS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    private void SetPrimaryGoal(string goal)
    {
        if (_card != null)
        {
            _card.PrimaryCardGoal = goal;
            MarkUnsaved();
            StateHasChanged();
        }
    }
    
    /// <summary>
    /// Determines if Goal selector should be visible.
    /// Only shows when there's a real mix of conversion types.
    /// </summary>
    private bool IsGoalSelectorVisible => HasMixedTypes();
    
    /// <summary>
    /// Checks if services have mixed conversion types (booking + quote).
    /// Returns true if selector should be shown.
    /// </summary>
    private bool HasMixedTypes()
    {
        var activeServices = _services.Where(s => s.IsActive).ToList();
        if (!activeServices.Any()) return false;
        
        var types = activeServices.Select(s => s.ConversionType ?? "booking").Distinct().ToList();
        
        // If any service is "both", we have mixed types
        if (types.Contains("both")) return true;
        
        // If we have both "booking" and "quote", it's mixed
        return types.Contains("booking") && types.Contains("quote");
    }
    
    /// <summary>
    /// Gets the effective primary goal, auto-detecting when all services are same type.
    /// Falls back to user-defined PrimaryCardGoal when mixed.
    /// </summary>
    private string GetEffectivePrimaryGoal()
    {
        var activeServices = _services.Where(s => s.IsActive).ToList();
        
        // No services = default to booking
        if (!activeServices.Any()) return "booking";
        
        var types = activeServices.Select(s => s.ConversionType ?? "booking").Distinct().ToList();
        
        // All same type = auto-detect
        if (types.Count == 1 && types[0] != "both")
        {
            return types[0]; // "booking" or "quote"
        }
        
        // Mixed types = use user preference, default to booking
        return _card?.PrimaryCardGoal ?? "booking";
    }
    
    /// <summary>
    /// Checks if any active service supports booking (Cita).
    /// </summary>
    private bool HasBookingServices()
    {
        return _services.Any(s => s.IsActive && (s.ConversionType == "booking" || s.ConversionType == "both"));
    }
    
    /// <summary>
    /// Checks if any active service supports quotes (CotizaciÃ³n).
    /// </summary>
    private bool HasQuoteServices()
    {
        return _services.Any(s => s.IsActive && (s.ConversionType == "quote" || s.ConversionType == "both"));
    }
    
    private void DuplicateService(DataTouch.Domain.Entities.Service originalService)
    {
        if (_services.Count >= 10) return;
        
        var newService = new DataTouch.Domain.Entities.Service
        {
            Id = Guid.NewGuid(),
            CardId = _card!.Id,
            OrganizationId = _card.OrganizationId,
            Name = $"{originalService.Name} (copia)",
            Description = originalService.Description,
            DurationMinutes = originalService.DurationMinutes,
            PriceFrom = originalService.PriceFrom,
            ConversionType = originalService.ConversionType,
            Modality = originalService.Modality,
            BufferBeforeMinutes = originalService.BufferBeforeMinutes,
            BufferAfterMinutes = originalService.BufferAfterMinutes,
            MinNoticeMinutes = originalService.MinNoticeMinutes,
            MaxBookingsPerDay = originalService.MaxBookingsPerDay,
            QuoteFormConfigJson = originalService.QuoteFormConfigJson,
            DisplayOrder = _services.Count,
            IsActive = true,
            CreatedAt = DateTime.UtcNow
        };
        
        _services.Add(newService);
        DbContext.Services.Add(newService);
        MarkUnsaved();
        Snackbar.Add("Servicio duplicado", Severity.Success);
        StateHasChanged();
    }
    
    private void SetServiceConversionType(DataTouch.Domain.Entities.Service service, string conversionType)
    {
        service.ConversionType = conversionType;
        MarkUnsaved();
        StateHasChanged();
    }
    
    // Service config panel expansion state
    private HashSet<Guid> _expandedBookingConfigs = new();
    private HashSet<Guid> _expandedQuoteConfigs = new();
    
    private void ToggleServiceBookingConfig(Guid serviceId)
    {
        if (_expandedBookingConfigs.Contains(serviceId))
            _expandedBookingConfigs.Remove(serviceId);
        else
            _expandedBookingConfigs.Add(serviceId);
    }
    
    private bool IsServiceBookingConfigExpanded(Guid serviceId) => _expandedBookingConfigs.Contains(serviceId);
    
    private void ToggleServiceQuoteConfig(Guid serviceId)
    {
        if (_expandedQuoteConfigs.Contains(serviceId))
            _expandedQuoteConfigs.Remove(serviceId);
        else
            _expandedQuoteConfigs.Add(serviceId);
    }
    
    private bool IsServiceQuoteConfigExpanded(Guid serviceId) => _expandedQuoteConfigs.Contains(serviceId);
    
    // QuoteFormConfig helpers
    private Dictionary<Guid, QuoteFormConfig> _quoteConfigCache = new();
    
    private QuoteFormConfig GetQuoteConfig(DataTouch.Domain.Entities.Service service)
    {
        if (_quoteConfigCache.TryGetValue(service.Id, out var cached))
            return cached;
        
        QuoteFormConfig config;
        if (!string.IsNullOrEmpty(service.QuoteFormConfigJson))
        {
            try
            {
                config = System.Text.Json.JsonSerializer.Deserialize<QuoteFormConfig>(service.QuoteFormConfigJson) ?? new();
            }
            catch { config = new(); }
        }
        else
        {
            config = new();
        }
        
        _quoteConfigCache[service.Id] = config;
        return config;
    }
    
    private void UpdateQuoteConfig(DataTouch.Domain.Entities.Service service, QuoteFormConfig config)
    {
        _quoteConfigCache[service.Id] = config;
        service.QuoteFormConfigJson = System.Text.Json.JsonSerializer.Serialize(config);
        MarkUnsaved();
    }


    private async Task CopyPublicUrl()
    {
        try
        {
            await JSRuntime.InvokeVoidAsync("navigator.clipboard.writeText", _publicUrl);
            Snackbar.Add("URL copiada al portapapeles", Severity.Success);
        }
        catch
        {
            Snackbar.Add("No se pudo copiar la URL", Severity.Error);
        }
    }

    // Helper to get emoji for service preview
    private string GetServiceEmoji(string serviceName)
    {
        var name = serviceName?.ToLower() ?? "";
        return name switch
        {
            var n when n.Contains("consult") => "ğŸ’¼",
            var n when n.Contains("anÃ¡lisis") || n.Contains("analisis") => "ğŸ“Š",
            var n when n.Contains("planific") || n.Contains("estrateg") => "ğŸ¯",
            var n when n.Contains("diseÃ±o") || n.Contains("design") => "ğŸ¨",
            var n when n.Contains("desarrollo") || n.Contains("dev") => "ğŸ’»",
            var n when n.Contains("market") => "ğŸ“ˆ",
            var n when n.Contains("foto") || n.Contains("photo") => "ğŸ“·",
            var n when n.Contains("video") => "ğŸ¬",
            var n when n.Contains("web") => "ğŸŒ",
            var n when n.Contains("social") => "ğŸ“±",
            var n when n.Contains("capacit") || n.Contains("train") => "ğŸ“š",
            var n when n.Contains("audit") => "ğŸ”",
            var n when n.Contains("legal") => "âš–ï¸",
            var n when n.Contains("contab") || n.Contains("financ") => "ğŸ’°",
            _ => "âœ¨"
        };
    }
}
