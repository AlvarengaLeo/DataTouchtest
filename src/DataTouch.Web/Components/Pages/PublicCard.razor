@page "/p/{OrgSlug}/{CardSlug}"
@layout EmptyLayout
@inject DataTouchDbContext DbContext
@inject ISnackbar Snackbar
@inject NavigationManager Navigation
@inject IJSRuntime JSRuntime
@inject IDialogService DialogService
@using DataTouch.Web.Models
@using DataTouch.Web.Components.Shared

<MudThemeProvider Theme="_theme" IsDarkMode="true" />
<MudSnackbarProvider />

<PageTitle>@(_card?.FullName ?? "Tarjeta") - DataTouch</PageTitle>

@if (_isLoading)
{
    <div class="loading-container">
        <MudProgressCircular Color="Color.Primary" Indeterminate="true" Size="Size.Large" />
    </div>
}
else if (_card == null || _organization == null)
{
    <div class="error-container">
        <MudIcon Icon="@Icons.Material.Filled.Error" Size="Size.Large" Color="Color.Error" />
        <MudText Typo="Typo.h5" Class="mt-4 text-white">Tarjeta no encontrada</MudText>
        <MudText Typo="Typo.body1" Class="text-white-70">La tarjeta que buscas no existe o estÃ¡ desactivada.</MudText>
    </div>
}
else
{
    @* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       LANDING PÃšBLICA - ESTRUCTURA EN 3 BLOQUES
       Fondo continuo en gradient, sin cortes blancos
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• *@
    <div class="landing-wrapper @GetBackgroundContrastClass()" style="@GetDynamicBackgroundStyle(); @GetThemeCssVariables()">
        
        @* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           BLOQUE 1: HERO / PERFIL
           Card principal con foto, nombre, puesto, bio y links
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ *@
        <div class="profile-card @GetCardContrastClass()" style="@GetCardBackgroundStyle()">
            <div class="card-header-gradient"></div>
            <div class="card-content">
                @* Avatar *@
                <div class="avatar-container">
                    @if (!string.IsNullOrEmpty(_card.ProfileImageUrl))
                    {
                        <MudAvatar Class="profile-avatar">
                            <MudImage Src="@_card.ProfileImageUrl" Alt="@_card.FullName" />
                        </MudAvatar>
                    }
                    else
                    {
                        @* Custom avatar div - bypasses MudBlazor internal styles *@
                        <div class="profile-avatar profile-avatar-initials" 
                             style="background: @_themeTokens.AccentPrimary; color: @_themeTokens.TextOnAccent; display: flex; align-items: center; justify-content: center; border-radius: 50%;">
                            @_card.FullName?.FirstOrDefault()
                        </div>
                    }
                </div>

                @* Info principal *@
                <MudText Typo="Typo.h5" Class="profile-name">@_card.FullName</MudText>
                <MudText Typo="Typo.subtitle1" Class="profile-title">@_card.Title</MudText>
                <div class="profile-location">
                    <MudIcon Icon="@Icons.Material.Filled.Business" Size="Size.Small" />
                    <span>@GetDisplayCompanyName()</span>
                </div>

                @if (!string.IsNullOrEmpty(_card.Bio) && !_isServicesTemplate)
                {
                    <MudText Typo="Typo.body2" Class="profile-bio">@_card.Bio</MudText>
                }

                @* Links y Redes Sociales - Hide for services template *@
                @if (_socialLinks != null && _socialLinks.HasAnyLink() && !_isServicesTemplate)
                {
                    <div class="social-row">
                        @if (!string.IsNullOrEmpty(_socialLinks.LinkedIn))
                        {
                            <MudIconButton Icon="@Icons.Custom.Brands.LinkedIn" Size="Size.Medium" 
                                           Class="social-icon" OnClick="@(() => OpenSocialLink(_socialLinks.LinkedIn))" />
                        }
                        @if (!string.IsNullOrEmpty(_socialLinks.Instagram))
                        {
                            <MudIconButton Icon="@Icons.Custom.Brands.Instagram" Size="Size.Medium" 
                                           Class="social-icon" OnClick="@(() => OpenSocialLink(_socialLinks.Instagram))" />
                        }
                        @if (!string.IsNullOrEmpty(_socialLinks.Twitter))
                        {
                            <MudIconButton Icon="@Icons.Custom.Brands.Twitter" Size="Size.Medium" 
                                           Class="social-icon" OnClick="@(() => OpenSocialLink(_socialLinks.Twitter))" />
                        }
                        @if (!string.IsNullOrEmpty(_socialLinks.YouTube))
                        {
                            <MudIconButton Icon="@Icons.Custom.Brands.YouTube" Size="Size.Medium" 
                                           Class="social-icon" OnClick="@(() => OpenSocialLink(_socialLinks.YouTube))" />
                        }
                    </div>
                }

                @* Status Chips - Hide for services template *@
                @if (!_isServicesTemplate)
                {
                    <div class="status-chips">
                        <span class="status-chip">
                            <span class="chip-dot"></span>
                            Disponible
                        </span>
                        <span class="status-chip">
                            <MudIcon Icon="@Icons.Material.Filled.Schedule" Size="Size.Small" />
                            Responde &lt; 1h
                        </span>
                        <span class="status-chip">
                            <MudIcon Icon="@Icons.Material.Filled.LocationOn" Size="Size.Small" />
                            El Salvador
                        </span>
                    </div>
                }

                @* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                   PORTFOLIO GALLERY (Conditional - Only if has gallery images)
                   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ *@
                @if (_galleryImages.Any())
                {
                    <div class="public-gallery-section">
                        <h3 class="gallery-section-title">Mi Trabajo</h3>
                        <div class="public-gallery-grid">
                            @foreach (var image in _galleryImages.OrderBy(i => i.Order))
                            {
                                <div class="public-gallery-item" @onclick="() => OpenLightbox(image)">
                                    <img src="@image.Url" alt="@(image.Title ?? "Portfolio")" loading="lazy" />
                                    @if (!string.IsNullOrEmpty(image.Title))
                                    {
                                        <div class="gallery-image-overlay">
                                            <span>@image.Title</span>
                                        </div>
                                    }
                                </div>
                            }
                        </div>
                    </div>
                }

                @* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                   SERVICES SECTION (Services Template) - Matches TemplateLibrary Preview
                   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ *@
                @if (_isServicesTemplate && _services.Any())
                {
                    <div class="services-template-section">
                        <h3 class="services-section-title">MIS SERVICIOS</h3>
                        <div class="services-cards-list">
                            @{ var serviceIcons = new[] { "ğŸ’¼", "ğŸ“Š", "ğŸ¯", "ğŸ› ï¸", "ğŸ’¡" }; }
                            @foreach (var (service, index) in _services.Select((s, i) => (s, i)))
                            {
                                <div class="service-card-item">
                                    <div class="service-card-icon" style="background: @GetServiceIconColor(index)">
                                        @serviceIcons[index % serviceIcons.Length]
                                    </div>
                                    <div class="service-card-content">
                                        <span class="service-card-name">@service.Name</span>
                                        <span class="service-card-meta">
                                            @service.DurationMinutes min â€¢ Desde $@(service.PriceFrom?.ToString("N0") ?? "--")
                                        </span>
                                    </div>
                                </div>
                            }
                        </div>
                        
                        @* Booking and Quote CTAs - Smart display based on service types *@
                        <div class="services-cta-section">
                            @{
                                // Determine effective goal (auto-detect or user preference)
                                var types = _services.Where(s => s.IsActive).Select(s => s.ConversionType ?? "booking").Distinct().ToList();
                                var hasBooking = _services.Any(s => s.IsActive && (s.ConversionType == "booking" || s.ConversionType == "both"));
                                var hasQuote = _services.Any(s => s.IsActive && (s.ConversionType == "quote" || s.ConversionType == "both"));
                                
                                // Auto-detect if all same type, otherwise use card preference
                                var effectiveGoal = "booking";
                                if (types.Count == 1 && types[0] != "both")
                                {
                                    effectiveGoal = types[0];
                                }
                                else
                                {
                                    effectiveGoal = _card.PrimaryCardGoal ?? "booking";
                                }
                            }
                            
                            @if (effectiveGoal == "booking" && hasBooking)
                            {
                                <a href="@GetBookingUrl()" class="btn-booking-primary">
                                    ğŸ“… Reservar Cita
                                </a>
                                @if (hasQuote)
                                {
                                    <button class="btn-quote-link" @onclick="OpenQuoteModal">
                                        o solicitar cotizaciÃ³n
                                    </button>
                                }
                            }
                            else if (effectiveGoal == "quote" && hasQuote)
                            {
                                <button class="btn-booking-primary" @onclick="OpenQuoteModal">
                                    ğŸ“ Solicitar CotizaciÃ³n
                                </button>
                                @if (hasBooking)
                                {
                                    <a href="@GetBookingUrl()" class="btn-quote-link">
                                        o reservar cita
                                    </a>
                                }
                            }
                            else if (hasBooking)
                            {
                                <a href="@GetBookingUrl()" class="btn-booking-primary">
                                    ğŸ“… Reservar Cita
                                </a>
                            }
                            else if (hasQuote)
                            {
                                <button class="btn-booking-primary" @onclick="OpenQuoteModal">
                                    ğŸ“ Solicitar CotizaciÃ³n
                                </button>
                            }
                        </div>
                        
                        @* Contact Info Footer *@
                        <div class="services-contact-footer">
                            @if (!string.IsNullOrEmpty(_card.Email))
                            {
                                <a href="mailto:@_card.Email" class="contact-item">
                                    âœ‰ï¸ @_card.Email
                                </a>
                            }
                            @if (!string.IsNullOrEmpty(_card.Phone))
                            {
                                <a href="tel:@GetFullPhoneForLink()" class="contact-item">
                                    ğŸ“ @_card.PhoneCountryCode @_card.Phone
                                </a>
                            }
                        </div>
                    </div>
                }

                @* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                   BLOQUE 2: CTAs / ACCIONES RÃPIDAS - Hide for services template
                   Integrados DENTRO de la card, no como secciÃ³n aparte
                   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ *@
                @if (!_isServicesTemplate)
                {
                    <div class="cta-section">
                        @* BotÃ³n primario: Guardar contacto - respetar flag *@
                        @if (_card.ShowSaveContact)
                        {
                            <MudButton Variant="Variant.Filled" FullWidth="true" 
                                       Class="btn-primary-cta" OnClick="@DownloadVCard"
                                       StartIcon="@Icons.Material.Filled.PersonAdd">
                                Guardar Contacto
                            </MudButton>
                        }

                        @* Fila de botones secundarios - respetar flags *@
                        <div class="cta-row">
                            @if (_card.ShowWhatsApp && !string.IsNullOrEmpty(_card.WhatsAppNumber))
                            {
                                <MudButton Variant="Variant.Filled" Class="btn-whatsapp"
                                           Href="@($"https://wa.me/{GetFullWhatsAppForLink()}")"
                                           Target="_blank" StartIcon="@Icons.Custom.Brands.WhatsApp">
                                    WhatsApp
                                </MudButton>
                            }
                            @if (_card.ShowCall && !string.IsNullOrEmpty(_card.Phone))
                            {
                                <MudButton Variant="Variant.Filled" Class="btn-call"
                                           Href="@($"tel:{GetFullPhoneForLink()}")"
                                           StartIcon="@Icons.Material.Filled.Phone">
                                    Llamar
                                </MudButton>
                            }
                            @if (_card.ShowEmail && !string.IsNullOrEmpty(_card.Email))
                            {
                                <MudButton Variant="Variant.Filled" Class="btn-email"
                                           Href="@($"mailto:{_card.Email}")"
                                           StartIcon="@Icons.Material.Filled.Email">
                                    Email
                                </MudButton>
                            }
                        </div>
                    </div>
                }
            </div>
        </div>

        @* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           BLOQUE 3: FORMULARIO DE LEAD PREMIUM - Hide for services template
           DiseÃ±o enterprise-grade con validaciÃ³n avanzada de telÃ©fono
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ *@
        @if (!_isServicesTemplate)
        {
        <div class="lead-form-card @GetCardContrastClass() @(_showSuccess ? "success-state" : "")" style="@GetCardBackgroundStyle()">
            @if (_showSuccess)
            {
                @* Success Overlay Animation *@
                <div class="success-overlay">
                    <div class="success-icon-container">
                        <MudIcon Icon="@Icons.Material.Filled.CheckCircle" Size="Size.Large" Class="success-icon" />
                    </div>
                    <MudText Typo="Typo.h6" Class="success-title">Â¡Gracias por contactarme!</MudText>
                    <MudText Typo="Typo.body2" Class="success-message">
                        Me pondrÃ© en contacto contigo muy pronto.
                    </MudText>
                    <MudButton Variant="Variant.Text" Class="success-btn" OnClick="@ResetForm">
                        Enviar otro mensaje
                    </MudButton>
                </div>
            }
            else
            {
                <div class="form-header">
                    <div class="form-header-icon">
                        <MudIcon Icon="@Icons.Material.Filled.MailOutline" Size="Size.Medium" />
                    </div>
                    <div>
                        <MudText Typo="Typo.h6" Class="form-title">Â¿Quieres que te contacte?</MudText>
                        <MudText Typo="Typo.caption" Class="form-subtitle">DÃ©jame tus datos y te respondo pronto</MudText>
                    </div>
                </div>
                
                <EditForm Model="_contactForm" OnValidSubmit="SubmitContact" class="premium-form">
                    <DataAnnotationsValidator />
                    
                    @* Nombre Completo *@
                    <div class="compact-field">
                        <label class="compact-label">
                            <MudIcon Icon="@Icons.Material.Filled.Person" Size="Size.Small" Class="label-icon" />
                            Nombre completo <span class="required">*</span>
                        </label>
                        <div class="native-input-wrapper">
                            <input type="text"
                                   class="native-text-input @(IsNameValid ? "is-valid" : "") @(!string.IsNullOrEmpty(_nameError) ? "has-error" : "")"
                                   value="@_contactForm.FullName"
                                   placeholder="Juan PÃ©rez"
                                   @oninput="@(e => _contactForm.FullName = e.Value?.ToString() ?? "")"
                                   autocomplete="name" />
                            @if (IsNameValid)
                            {
                                <div class="input-adornment valid">
                                    <MudIcon Icon="@Icons.Material.Filled.CheckCircle" Size="Size.Small" />
                                </div>
                            }
                        </div>
                        @if (!string.IsNullOrEmpty(_nameError))
                        {
                            <span class="field-error">@_nameError</span>
                        }
                    </div>
                    
                    @* Email *@
                    <div class="compact-field">
                        <label class="compact-label">
                            <MudIcon Icon="@Icons.Material.Filled.Email" Size="Size.Small" Class="label-icon" />
                            Correo electrÃ³nico <span class="required">*</span>
                        </label>
                        <div class="native-input-wrapper">
                            <input type="email"
                                   class="native-text-input @(IsEmailValid ? "is-valid" : "") @(!string.IsNullOrEmpty(_emailError) ? "has-error" : "")"
                                   value="@_contactForm.Email"
                                   placeholder="tu@email.com"
                                   @oninput="@(e => _contactForm.Email = e.Value?.ToString() ?? "")"
                                   autocomplete="email" />
                            @if (IsEmailValid)
                            {
                                <div class="input-adornment valid">
                                    <MudIcon Icon="@Icons.Material.Filled.CheckCircle" Size="Size.Small" />
                                </div>
                            }
                        </div>
                        @if (!string.IsNullOrEmpty(_emailError))
                        {
                            <span class="field-error">@_emailError</span>
                        }
                    </div>
                    
                    @* TelÃ©fono con selector de paÃ­s *@
                    <CountryPhoneInput @bind-Value="_contactForm.Phone"
                                       @bind-CountryCode="_contactForm.PhoneCountryCode"
                                       @bind-E164Value="_contactForm.PhoneE164"
                                       Required="true"
                                       IsValidChanged="@(valid => _isPhoneValid = valid)" />
                    
                    @* Mensaje Opcional *@
                    <div class="compact-field">
                        <label class="compact-label">
                            <MudIcon Icon="@Icons.Material.Filled.Message" Size="Size.Small" Class="label-icon" />
                            Mensaje <span class="optional">(opcional)</span>
                        </label>
                        <div class="native-input-wrapper">
                            <textarea class="native-textarea-input"
                                      placeholder="Â¿En quÃ© puedo ayudarte?"
                                      rows="2"
                                      @oninput="@(e => _contactForm.Message = e.Value?.ToString() ?? "")">@_contactForm.Message</textarea>
                        </div>
                    </div>
                    
                    @* Submit Button with States *@
                    <button type="submit" 
                            class="premium-submit-btn @GetSubmitButtonClass()" 
                            disabled="@(!CanSubmit)">
                        @if (_isSubmitting)
                        {
                            <span class="btn-spinner"></span>
                            <span>Enviando...</span>
                        }
                        else if (_submitError)
                        {
                            <MudIcon Icon="@Icons.Material.Filled.ErrorOutline" Size="Size.Small" />
                            <span>Error, intenta de nuevo</span>
                        }
                        else
                        {
                            <MudIcon Icon="@Icons.Material.Filled.Send" Size="Size.Small" />
                            <span>Enviar mensaje</span>
                        }
                    </button>
                    
                    @if (_submitError)
                    {
                        <div class="submit-error-hint">
                            <MudText Typo="Typo.caption" Color="Color.Error">
                                OcurriÃ³ un problema. Por favor, verifica tus datos e intenta nuevamente.
                            </MudText>
                        </div>
                    }
                </EditForm>
            }
        </div>
        }
        @* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           LIGHTBOX MODAL (Gallery Image)
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ *@
        @if (_lightboxOpen && _selectedImage != null)
        {
            <div class="lightbox-overlay" @onclick="CloseLightbox">
                <button class="lightbox-close" @onclick="CloseLightbox">Ã—</button>
                <div class="lightbox-content" @onclick:stopPropagation="true">
                    <img src="@_selectedImage.Url" alt="@(_selectedImage.Title ?? "Image")" />
                    @if (!string.IsNullOrEmpty(_selectedImage.Title) || !string.IsNullOrEmpty(_selectedImage.Description))
                    {
                        <div class="lightbox-caption">
                            @if (!string.IsNullOrEmpty(_selectedImage.Title))
                            {
                                <h3>@_selectedImage.Title</h3>
                            }
                            @if (!string.IsNullOrEmpty(_selectedImage.Description))
                            {
                                <p>@_selectedImage.Description</p>
                            }
                        </div>
                    }
                    @if (_galleryImages.Count > 1)
                    {
                        <button class="lightbox-nav lightbox-prev" @onclick="PrevImage" @onclick:stopPropagation="true">â€¹</button>
                        <button class="lightbox-nav lightbox-next" @onclick="NextImage" @onclick:stopPropagation="true">â€º</button>
                    }
                </div>
            </div>
        }

        @* Footer mÃ­nimo *@
        <div class="footer-minimal">
            <MudText Typo="Typo.caption">Powered by <strong>DataTouch</strong></MudText>
        </div>
    </div>
}

<style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ESTILOS GLOBALES - GRADIENT CONTINUO SIN CORTES
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    /* FORCE WHITE TEXT IN ALL MUDBLAZOR INPUTS - HIGHEST PRIORITY */
    .landing-wrapper .mud-input-slot,
    .landing-wrapper .mud-input > input,
    .landing-wrapper .mud-input-text > input,
    .landing-wrapper .mud-input textarea,
    .landing-wrapper input.mud-input-slot,
    .landing-wrapper textarea.mud-input-slot,
    .landing-wrapper .mud-input-control input,
    .landing-wrapper .mud-input-control textarea,
    .lead-form-card .mud-input-slot,
    .lead-form-card .mud-input > input,
    .lead-form-card .mud-input textarea,
    .lead-form-card input,
    .lead-form-card textarea,
    .landing-wrapper .mud-input-root input,
    .landing-wrapper .mud-input-root textarea,
    .landing-wrapper .mud-input-root .mud-input-slot,
    .landing-wrapper .mud-input-root-outlined input,
    .landing-wrapper .mud-input-root-outlined textarea,
    .premium-form .mud-input-root input,
    .premium-form .mud-input-root textarea,
    .premium-form .mud-input-slot,
    .compact-input .mud-input-root input,
    .compact-input .mud-input-root textarea {
        color: var(--surface-input-text, #FFFFFF) !important;
        -webkit-text-fill-color: var(--surface-input-text, #FFFFFF) !important;
        caret-color: var(--dt-accent-primary, #A78BFA) !important;
        opacity: 1 !important;
    }
    
    /* OVERRIDE MUDBLAZOR CSS VARIABLES - contrast aware */
    .landing-wrapper,
    .lead-form-card,
    .premium-form {
        --mud-palette-text-primary: var(--surface-input-text, #FFFFFF) !important;
        --mud-palette-text-secondary: var(--surface-text-secondary, #FFFFFF) !important;
        --mud-palette-action-default: var(--surface-icon, #FFFFFF) !important;
    }
    
    /* ULTRA-SPECIFIC MUDBLAZOR INPUT TEXT COLOR OVERRIDE */
    .landing-wrapper .mud-input,
    .landing-wrapper .mud-input-text,
    .landing-wrapper .mud-input-root,
    .landing-wrapper .mud-input-root-text,
    .landing-wrapper .mud-input-root-outlined,
    .landing-wrapper .mud-input-underline,
    .lead-form-card .mud-input,
    .lead-form-card .mud-input-text,
    .lead-form-card .mud-input-root,
    .lead-form-card .mud-input-root-text,
    .lead-form-card .mud-input-root-outlined,
    .premium-form .mud-input,
    .premium-form .mud-input-text,
    .premium-form .mud-input-root {
        color: var(--surface-input-text, #FFFFFF) !important;
        --mud-palette-text-primary: var(--surface-input-text, #FFFFFF) !important;
    }
    
    /* Target the actual input and textarea elements INSIDE MudBlazor components */
    .landing-wrapper .mud-input-control input.mud-input-slot,
    .landing-wrapper .mud-input-control textarea.mud-input-slot,
    .landing-wrapper .mud-input-root input.mud-input-slot,
    .landing-wrapper .mud-input-root textarea.mud-input-slot,
    .landing-wrapper .mud-input-control .mud-input > input,
    .landing-wrapper .mud-input-control .mud-input > textarea,
    .lead-form-card .mud-input-control input.mud-input-slot,
    .lead-form-card .mud-input-control textarea.mud-input-slot,
    .lead-form-card .mud-input-root input.mud-input-slot,
    .lead-form-card .mud-input-root textarea.mud-input-slot,
    .premium-form .mud-input-control input.mud-input-slot,
    .premium-form .mud-input-control textarea.mud-input-slot,
    .compact-input input.mud-input-slot,
    .compact-input textarea.mud-input-slot {
        color: var(--surface-input-text, #FFFFFF) !important;
        -webkit-text-fill-color: var(--surface-input-text, #FFFFFF) !important;
        caret-color: var(--dt-accent-primary, #A78BFA) !important;
        opacity: 1 !important;
    }
    
    /* Specific override for MudTextField and MudSelect */
    .landing-wrapper .mud-input-slot.mud-input-root-text,
    .landing-wrapper input.mud-input-slot.mud-input-root-text,
    .landing-wrapper textarea.mud-input-slot.mud-input-root-text,
    .lead-form-card input.mud-input-slot,
    .lead-form-card textarea.mud-input-slot,
    .premium-form input.mud-input-slot,
    .premium-form textarea.mud-input-slot {
        color: var(--surface-input-text, #FFFFFF) !important;
        -webkit-text-fill-color: var(--surface-input-text, #FFFFFF) !important;
    }
    
    /* Fix for autofill styles that override text color */
    .landing-wrapper input:-webkit-autofill,
    .landing-wrapper input:-webkit-autofill:hover,
    .landing-wrapper input:-webkit-autofill:focus,
    .landing-wrapper input:-webkit-autofill:active,
    .lead-form-card input:-webkit-autofill,
    .lead-form-card input:-webkit-autofill:hover,
    .lead-form-card input:-webkit-autofill:focus,
    .lead-form-card input:-webkit-autofill:active,
    .premium-form input:-webkit-autofill,
    .premium-form input:-webkit-autofill:hover,
    .premium-form input:-webkit-autofill:focus,
    .premium-form input:-webkit-autofill:active {
        -webkit-text-fill-color: var(--surface-input-text, #FFFFFF) !important;
        -webkit-box-shadow: 0 0 0 1000px var(--surface-input-bg, rgba(25, 18, 45, 0.95)) inset !important;
        box-shadow: 0 0 0 1000px var(--surface-input-bg, rgba(25, 18, 45, 0.95)) inset !important;
        transition: background-color 5000s ease-in-out 0s !important;
        caret-color: var(--dt-accent-primary, #A78BFA) !important;
    }
    
    /* Force country selector text to white */
    .landing-wrapper .mud-select .mud-input-slot,
    .landing-wrapper .mud-select-input,
    .lead-form-card .mud-select .mud-input-slot,
    .lead-form-card .mud-select-input,
    .country-selector-wrapper .mud-select-input,
    .country-selector-wrapper .mud-input-slot {
        color: var(--surface-input-text, #FFFFFF) !important;
        -webkit-text-fill-color: var(--surface-input-text, #FFFFFF) !important;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CRITICAL FIX: MudBlazor fieldset overlay covering input text
       The .mud-input-outlined-border fieldset has a dark background that dims the text.
       We need to either make it transparent OR raise the input z-index above it.
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    /* Solution 1: Make fieldset background transparent so it doesn't dim the text */
    .landing-wrapper .mud-input-outlined-border,
    .lead-form-card .mud-input-outlined-border,
    .premium-form .mud-input-outlined-border,
    .compact-input .mud-input-outlined-border {
        background: transparent !important;
        background-color: transparent !important;
    }
    
    /* Solution 2: Raise input z-index above fieldset */
    .landing-wrapper .mud-input-slot,
    .landing-wrapper .mud-input-root,
    .landing-wrapper input.mud-input-slot,
    .landing-wrapper textarea.mud-input-slot,
    .lead-form-card .mud-input-slot,
    .lead-form-card .mud-input-root,
    .lead-form-card input.mud-input-slot,
    .lead-form-card textarea.mud-input-slot,
    .premium-form .mud-input-slot,
    .premium-form input.mud-input-slot,
    .premium-form textarea.mud-input-slot,
    .compact-input .mud-input-slot,
    .compact-input input.mud-input-slot,
    .compact-input textarea.mud-input-slot {
        position: relative !important;
        z-index: 10 !important;
        color: var(--surface-input-text, #FFFFFF) !important;
        -webkit-text-fill-color: var(--surface-input-text, #FFFFFF) !important;
    }
    
    /* Ensure the fieldset stays behind the input */
    .landing-wrapper .mud-input-outlined fieldset,
    .lead-form-card .mud-input-outlined fieldset,
    .premium-form .mud-input-outlined fieldset,
    .compact-input .mud-input-outlined fieldset {
        z-index: 1 !important;
    }
    
    html, body {
        margin: 0;
        padding: 0;
        min-height: 100vh;
    }

    .loading-container, .error-container {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background: linear-gradient(180deg, #0d0a1a 0%, #1a1035 40%, #2d1b4e 70%, #1a1035 100%);
    }

    .text-white { color: #fff !important; }
    .text-white-70 { color: rgba(255,255,255,0.7) !important; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       WRAPPER PRINCIPAL - FONDO GRADIENT OSCURO PREMIUM
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .landing-wrapper {
        min-height: 100vh;
        background: linear-gradient(180deg, #0d0a1a 0%, #1a1035 30%, #2d1b4e 60%, #1a1035 100%);
        padding: 32px 16px 40px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0;
        position: relative;
        overflow: hidden;
    }

    /* Aurora glow effect at bottom */
    .landing-wrapper::before {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 50%;
        background: radial-gradient(ellipse at center bottom, rgba(168, 85, 247, 0.15) 0%, transparent 60%),
                    radial-gradient(ellipse at 30% 90%, rgba(236, 72, 153, 0.1) 0%, transparent 50%);
        pointer-events: none;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BLOQUE 1: PROFILE CARD (HERO) - GLASSMORPHISM
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .profile-card {
        width: 100%;
        max-width: 420px;
        background: var(--dt-surface-card);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-radius: 28px;
        border: 1px solid var(--dt-surface-card-border);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3),
                    inset 0 0 80px var(--dt-accent-soft);
        position: relative;
        z-index: 1;
        overflow: visible;
    }

    .card-header-gradient {
        display: none; /* Remove the old header - mockup has no header gradient */
    }

    .card-content {
        padding: 40px 28px 28px;
        text-align: center;
    }

    /* Avatar with Glow Ring - HERO SIZE */
    .avatar-container {
        margin-top: 0;
        margin-bottom: 24px;
        position: relative;
    }

    .profile-avatar {
        width: 160px !important;
        height: 160px !important;
        font-size: 3.75rem !important;
        background: var(--dt-accent-gradient) !important;
        border: 5px solid rgba(255, 255, 255, 0.25) !important;
        box-shadow: 0 0 0 6px var(--dt-accent-soft),
                    0 0 60px var(--dt-accent-soft),
                    0 12px 32px rgba(0, 0, 0, 0.35) !important;
        color: white !important;
        overflow: hidden !important;
    }

    .profile-avatar .mud-avatar-img,
    .profile-avatar img,
    .profile-avatar .mud-image {
        width: 100% !important;
        height: 100% !important;
        object-fit: cover !important;
        object-position: center center !important;
        border-radius: 50% !important;
    }
    
    /* Avatar initials fill - uses theme tokens instead of MudBlazor Color.Primary */
    /* Double class for specificity over .profile-avatar gradient */
    .profile-avatar.profile-avatar-initials {
        background: var(--dt-accent-primary) !important;
        color: var(--dt-text-on-accent, #FFFFFF) !important;
    }

    /* Info - White text for dark theme */
    .profile-name {
        font-weight: 700 !important;
        font-size: 1.75rem !important;
        color: #FFFFFF !important;
        margin-bottom: 6px !important;
        letter-spacing: -0.02em;
    }

    .profile-title {
        color: rgba(255, 255, 255, 0.7) !important;
        font-size: 1rem !important;
        font-weight: 400 !important;
        margin-bottom: 8px !important;
    }

    .profile-location {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        color: rgba(255, 255, 255, 0.6);
        font-size: 0.875rem;
        margin: 0 0 16px;
    }

    .profile-location .mud-icon-root {
        font-size: 1rem !important;
        opacity: 0.7;
    }

    .profile-bio {
        color: rgba(255, 255, 255, 0.85) !important;
        font-size: 0.9375rem !important;
        line-height: 1.6 !important;
        max-width: 340px;
        margin: 0 auto 20px;
    }

    /* Redes sociales - fila compacta */
    .social-row {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin-bottom: 20px;
    }

    .social-icon {
        background: rgba(255, 255, 255, 0.1) !important;
        color: rgba(255, 255, 255, 0.8) !important;
        transition: all 0.2s ease !important;
        border-radius: 12px !important;
    }

    .social-icon:hover {
        background: var(--dt-accent-soft) !important;
        color: #fff !important;
        transform: scale(1.05);
    }

    /* Status Chips */
    .status-chips {
        display: flex;
        justify-content: center;
        gap: 8px;
        flex-wrap: wrap;
        margin-bottom: 20px;
    }

    .status-chip {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        background: rgba(255, 255, 255, 0.08);
        border-radius: 20px;
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.75);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .status-chip .mud-icon-root {
        font-size: 0.875rem !important;
        opacity: 0.7;
    }

    .chip-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #22C55E;
        box-shadow: 0 0 8px rgba(34, 197, 94, 0.5);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BLOQUE 2: CTAs - INTEGRADOS EN LA CARD
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .cta-section {
        border-top: none;
        padding-top: 8px;
        margin-top: 0;
    }

    .btn-primary-cta {
        background: var(--dt-button-primary-bg) !important;
        color: var(--dt-button-primary-text) !important;
        font-weight: 600 !important;
        text-transform: none !important;
        border-radius: 28px !important;
        padding: 10px 17px !important;
        font-size: 1rem !important;
        margin-bottom: 15px !important;
        box-shadow: 0 4px 20px var(--dt-accent-soft) !important;
        letter-spacing: 0.01em;
    }
    
    .btn-primary-cta.mud-width-full {
        width: 73%;
    }

    .btn-primary-cta:hover {
        background: var(--dt-button-primary-hover) !important;
        box-shadow: 0 6px 28px var(--dt-accent-soft) !important;
        transform: translateY(-2px);
    }

    .cta-row {
        display: flex;
        gap: 10px;
        justify-content: center;
        flex-wrap: nowrap;
    }

    .cta-row .mud-button-root {
        flex: 1;
        min-width: 95px;
        max-width: 120px;
        border-radius: 25px !important;
        text-transform: none !important;
        font-weight: 500 !important;
        padding: 6px 19px !important;
        font-size: 0.875rem !important;
    }

    /* WhatsApp - Outlined Green */
    .btn-whatsapp {
        background: transparent !important;
        border: 2px solid #25D366 !important;
        color: #25D366 !important;
        transition: all 0.2s ease !important;
    }

    .btn-whatsapp:hover {
        background: rgba(37, 211, 102, 0.15) !important;
        border-color: #2EE575 !important;
    }

    .btn-whatsapp .mud-icon-root {
        color: #25D366 !important;
    }

    /* Llamar - Neutral Theme (uses theme tokens) */
    .btn-call {
        background: transparent !important;
        border: 2px solid var(--dt-button-secondary-border) !important;
        color: var(--dt-text-secondary) !important;
        transition: all 0.2s ease !important;
    }

    .btn-call:hover {
        background: var(--dt-state-hover-overlay) !important;
        border-color: var(--dt-accent-primary) !important;
        color: var(--dt-accent-primary) !important;
    }

    .btn-call .mud-icon-root {
        color: var(--dt-text-secondary) !important;
    }
    
    .btn-call:hover .mud-icon-root {
        color: var(--dt-accent-primary) !important;
    }

    /* Email - Outlined Orange */
    .btn-email {
        background: transparent !important;
        border: 2px solid #F59E0B !important;
        color: #FBBF24 !important;
        transition: all 0.2s ease !important;
    }

    .btn-email:hover {
        background: rgba(245, 158, 11, 0.15) !important;
        border-color: #FBBF24 !important;
    }

    .btn-email .mud-icon-root {
        color: #FBBF24 !important;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PORTFOLIO GALLERY SECTION
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .public-gallery-section {
        margin-top: 24px;
        padding-top: 24px;
        border-top: 1px solid rgba(139, 92, 246, 0.2);
    }
    
    .gallery-section-title {
        font-size: 0.8rem;
        font-weight: 600;
        color: rgba(255, 255, 255, 0.6);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin: 0 0 16px;
        text-align: center;
    }
    
    .public-gallery-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
    }
    
    .public-gallery-item {
        position: relative;
        aspect-ratio: 1;
        border-radius: 16px;
        overflow: hidden;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        background: rgba(30, 41, 59, 0.5);
    }
    
    .public-gallery-item:hover {
        transform: scale(1.03);
        box-shadow: 0 8px 24px var(--dt-accent-soft);
    }
    
    .public-gallery-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    .gallery-image-overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        padding: 12px;
        background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
    }
    
    .gallery-image-overlay span {
        font-size: 0.75rem;
        font-weight: 500;
        color: white;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       LIGHTBOX MODAL
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .lightbox-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.95);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        padding: 20px;
    }
    
    .lightbox-close {
        position: absolute;
        top: 20px;
        right: 20px;
        width: 48px;
        height: 48px;
        border: none;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        color: white;
        font-size: 1.75rem;
        cursor: pointer;
        transition: background 0.2s;
        z-index: 10000;
    }
    
    .lightbox-close:hover {
        background: rgba(255, 255, 255, 0.2);
    }
    
    .lightbox-content {
        position: relative;
        max-width: 90vw;
        max-height: 80vh;
    }
    
    .lightbox-content img {
        max-width: 100%;
        max-height: 70vh;
        border-radius: 16px;
        object-fit: contain;
    }
    
    .lightbox-caption {
        text-align: center;
        padding: 16px;
        color: white;
    }
    
    .lightbox-caption h3 {
        margin: 0 0 8px;
        font-size: 1.1rem;
        font-weight: 600;
    }
    
    .lightbox-caption p {
        margin: 0;
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.7);
    }
    
    .lightbox-nav {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 52px;
        height: 52px;
        border: none;
        background: rgba(139, 92, 246, 0.3);
        border-radius: 50%;
        color: white;
        font-size: 2rem;
        cursor: pointer;
        transition: background 0.2s;
    }
    
    .lightbox-nav:hover {
        background: rgba(139, 92, 246, 0.5);
    }
    
    .lightbox-prev { left: 20px; }
    .lightbox-next { right: 20px; }
    
    @@media (max-width: 600px) {
        .lightbox-prev { left: 10px; }
        .lightbox-next { right: 10px; }
        .lightbox-nav { width: 44px; height: 44px; font-size: 1.5rem; }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BLOQUE 3: FORMULARIO DE LEAD - DARK THEME INTEGRATED
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .lead-form-card {
        width: 100%;
        max-width: 420px;
        background: transparent;
        padding: 24px 0 0;
        position: relative;
        margin-top: 19px;
    }
    
    .lead-form-card.success-state {
        background: #15873f;
        border-radius: 20px;
        padding: 24px;
        border: 1px solid rgba(16, 185, 129, 0.3);
    }
    
    /* Form Header */
    .form-header {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 6px;
        padding-bottom: 0;
        border-bottom: none;
        color: rgba(255, 255, 255, 0.9);
    }
    
    .form-header-icon {
        display: none;
    }
    
    .form-header .mud-icon-root {
        font-size: 1rem !important;
        color: rgba(255, 255, 255, 0.7) !important;
    }

    .form-title {
        color: rgba(255, 255, 255, 0.95) !important;
        font-weight: 600 !important;
        font-size: 0.95rem !important;
        margin: 0 !important;
        line-height: 1.2 !important;
    }
    
    .form-subtitle {
        color: rgba(255, 255, 255, 0.5) !important;
        font-size: 0.8rem !important;
        margin-bottom: 16px;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       COMPACT PREMIUM FORM FIELDS - Dense but elegant
       Target: 42px inputs, 12px gaps, consistent density
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .premium-form {
        display: flex;
        flex-direction: column;
        gap: 0;
    }
    
    .compact-field {
        margin-bottom: 14px;
    }
    
    .compact-label {
        display: flex;
        align-items: center;
        gap: 5px;
        margin-bottom: 6px;
        font-size: 0.8rem;
        font-weight: 500;
        color: rgba(255, 255, 255, 0.7);
        line-height: 1.2;
    }
    
    .compact-label .label-icon {
        color: rgba(255, 255, 255, 0.5);
        font-size: 0.9rem !important;
        width: 16px !important;
        height: 16px !important;
    }
    
    .compact-label .required {
        color: #F87171;
        margin-left: 1px;
    }
    
    .compact-label .optional {
        color: var(--surface-text-muted, rgba(255, 255, 255, 0.4));
        font-weight: 400;
        font-size: 0.75rem;
    }
    
    /* Dark Theme Input Styling - Premium Form Fields */
    .compact-input .mud-input-outlined-border {
        border-radius: 12px !important;
        border: 1.5px solid var(--dt-surface-input-border) !important;
        background: var(--dt-surface-input) !important;
        transition: all 0.2s ease !important;
    }
    
    .compact-input:hover .mud-input-outlined-border {
        border-color: var(--dt-accent-soft) !important;
        background: var(--dt-surface-input) !important;
    }
    
    .compact-input:focus-within .mud-input-outlined-border {
        border-color: var(--dt-surface-input-focus) !important;
        box-shadow: 0 0 0 3px var(--dt-focus-ring) !important;
        background: var(--dt-surface-input) !important;
    }
    
    .compact-input .mud-input-root {
        height: 46px !important;
        min-height: 46px !important;
    }
    
    .compact-input .mud-input-slot {
        padding-top: 0 !important;
        padding-bottom: 0 !important;
        font-size: 0.9375rem !important;
        font-weight: 500 !important;
        letter-spacing: 0.2px !important;
        color: var(--surface-input-text, #FFFFFF) !important;
    }
    
    .compact-input .mud-input-root-outlined .mud-input-slot {
        padding: 10px 14px !important;
    }
    
    .compact-input .mud-input-adornment-end {
        color: #22C55E !important;
        margin-right: 6px !important;
    }
    
    .compact-input .mud-input-adornment-end .mud-icon-root {
        font-size: 1.1rem !important;
    }

    /* Force pure white text in ALL form inputs */
    .premium-form input,
    .premium-form textarea,
    .premium-form .mud-input-slot,
    .premium-form .mud-input input,
    .premium-form .mud-input textarea,
    .compact-input input,
    .compact-input textarea,
    .compact-input .mud-input-slot,
    .compact-input .mud-input-slot input,
    .compact-input .mud-input-slot textarea,
    .lead-form-card input,
    .lead-form-card textarea,
    .lead-form-card .mud-input-slot {
        color: var(--dt-text-primary) !important;
        -webkit-text-fill-color: var(--dt-text-primary) !important;
        caret-color: var(--dt-accent-primary) !important;
        opacity: 1 !important;
    }

    .premium-form input::placeholder,
    .premium-form textarea::placeholder,
    .compact-input input::placeholder,
    .compact-input textarea::placeholder,
    .lead-form-card input::placeholder,
    .lead-form-card textarea::placeholder {
        color: rgba(255, 255, 255, 0.4) !important;
        -webkit-text-fill-color: rgba(255, 255, 255, 0.4) !important;
        font-weight: 400 !important;
        opacity: 1 !important;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       AUTOFILL OVERRIDES - Maintain theme colors when browser autofill is active
       Chrome/Safari use :-webkit-autofill, Firefox uses :autofill
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    /* Chrome/Safari Autofill - use box-shadow to override UA background */
    .native-text-input:-webkit-autofill,
    .native-text-input:-webkit-autofill:hover,
    .native-text-input:-webkit-autofill:focus,
    .native-textarea-input:-webkit-autofill,
    .native-textarea-input:-webkit-autofill:hover,
    .native-textarea-input:-webkit-autofill:focus,
    .premium-form input:-webkit-autofill,
    .premium-form input:-webkit-autofill:hover,
    .premium-form input:-webkit-autofill:focus,
    .lead-form-card input:-webkit-autofill,
    .lead-form-card input:-webkit-autofill:hover,
    .lead-form-card input:-webkit-autofill:focus {
        /* Override browser autofill background with theme surface */
        -webkit-box-shadow: 0 0 0 1000px var(--dt-surface-input) inset !important;
        box-shadow: 0 0 0 1000px var(--dt-surface-input) inset !important;
        -webkit-text-fill-color: var(--dt-text-primary) !important;
        color: var(--dt-text-primary) !important;
        caret-color: var(--dt-accent-primary) !important;
        border-color: var(--dt-surface-input-border) !important;
        transition: background-color 5000s ease-in-out 0s !important;
    }
    
    /* Firefox Autofill */
    .native-text-input:autofill,
    .native-text-input:autofill:hover,
    .native-text-input:autofill:focus,
    .native-textarea-input:autofill,
    .native-textarea-input:autofill:hover,
    .native-textarea-input:autofill:focus,
    .premium-form input:autofill,
    .premium-form input:autofill:hover,
    .premium-form input:autofill:focus,
    .lead-form-card input:autofill,
    .lead-form-card input:autofill:hover,
    .lead-form-card input:autofill:focus {
        background-color: var(--dt-surface-input) !important;
        color: var(--dt-text-primary) !important;
        -webkit-text-fill-color: var(--dt-text-primary) !important;
        caret-color: var(--dt-accent-primary) !important;
        border-color: var(--dt-surface-input-border) !important;
    }
    
    /* Compact Textarea - 2 lines, ~60px */
    .compact-input.compact-textarea .mud-input-root {
        height: auto !important;
        min-height: 56px !important;
    }
    
    .compact-input.compact-textarea .mud-input-slot {
        padding: 10px 12px !important;
    }
    
    /* Override MudBlazor default margins in dense mode */
    .compact-input.mud-input-control {
        margin-top: 0 !important;
        margin-bottom: 0 !important;
    }
    
    .compact-input .mud-input-helper-text {
        font-size: 0.7rem !important;
        margin-top: 2px !important;
        min-height: 16px;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       NATIVE TEXT INPUTS - Same style as phone-number-input
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .native-input-wrapper {
        position: relative;
        width: 100%;
    }
    
    .native-text-input,
    .native-textarea-input {
        width: 100%;
        height: 46px;
        padding: 0 38px 0 14px;
        font-size: 0.9375rem;
        font-weight: 500;
        letter-spacing: 0.3px;
        font-family: Inter, "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        color: var(--dt-text-primary);
        -webkit-text-fill-color: var(--dt-text-primary);
        background: var(--dt-surface-input);
        border: 1.5px solid var(--dt-surface-input-border);
        border-radius: 12px;
        outline: none;
        transition: all 0.2s ease;
        caret-color: var(--dt-accent-primary);
        box-sizing: border-box;
    }
    
    .native-textarea-input {
        height: auto;
        min-height: 70px;
        padding: 12px 14px;
        resize: vertical;
        line-height: 1.4;
    }
    
    .native-text-input::placeholder,
    .native-textarea-input::placeholder {
        color: rgba(255, 255, 255, 0.4);
        -webkit-text-fill-color: rgba(255, 255, 255, 0.4);
        font-weight: 400;
        letter-spacing: 0;
    }
    
    .native-text-input:hover,
    .native-textarea-input:hover {
        border-color: var(--dt-accent-soft);
        background: var(--dt-surface-input);
    }
    
    .native-text-input:focus,
    .native-textarea-input:focus {
        border-color: var(--dt-surface-input-focus);
        background: var(--dt-surface-input);
        box-shadow: 0 0 0 3px var(--dt-focus-ring);
    }
    
    /* Valid State */
    .native-text-input.is-valid {
        border-color: rgba(34, 197, 94, 0.5);
    }
    
    .native-text-input.is-valid:focus {
        border-color: #22C55E;
        box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.2);
    }
    
    /* Error State */
    .native-text-input.has-error {
        border-color: rgba(248, 113, 113, 0.6);
    }
    
    .native-text-input.has-error:focus {
        border-color: #F87171;
        box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.15);
    }
    
    /* Input Adornment (checkmark icon) */
    .input-adornment {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        display: flex;
        align-items: center;
        pointer-events: none;
    }
    
    .input-adornment .mud-icon-root {
        font-size: 1.1rem !important;
    }
    
    .input-adornment.valid {
        color: #22C55E;
    }
    
    .input-adornment.error {
        color: #F87171;
    }
    
    /* Field Error Message */
    .field-error {
        display: block;
        font-size: 0.75rem;
        color: #F87171;
        font-weight: 500;
        margin-top: 4px;
        padding-left: 2px;
    }
    
    /* Submit Button - Uses accent color */
    .premium-submit-btn {
        width: 100%;
        height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        background: var(--dt-button-primary-bg);
        color: var(--dt-button-primary-text);
        font-size: 0.9375rem;
        font-weight: 600;
        border: none;
        border-radius: 14px;
        cursor: pointer;
        transition: all 0.25s ease;
        box-shadow: 0 4px 16px var(--dt-accent-soft);
        margin-top: 8px;
    }
    
    .premium-submit-btn:hover:not(:disabled) {
        transform: translateY(-2px);
        background: var(--dt-button-primary-hover);
        box-shadow: 0 6px 24px var(--dt-accent-soft);
    }
    
    .premium-submit-btn:active:not(:disabled) {
        transform: translateY(0);
    }
    
    .premium-submit-btn.disabled,
    .premium-submit-btn:disabled {
        background: rgba(75, 85, 99, 0.5);
        color: rgba(255, 255, 255, 0.4);
        cursor: not-allowed;
        box-shadow: none;
        opacity: var(--dt-state-disabled-opacity);
    }
    
    .premium-submit-btn.loading {
        background: var(--dt-button-primary-bg);
        cursor: wait;
    }
    
    .premium-submit-btn.error {
        background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
        box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
    }
    
    /* Button Spinner */
    .btn-spinner {
        width: 20px;
        height: 20px;
        border: 2px solid rgba(255,255,255,0.3);
        border-top-color: #fff;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
    }
    
    @@keyframes spin {
        to { transform: rotate(360deg); }
    }
    
    .submit-error-hint {
        text-align: center;
        margin-top: 12px;
    }
    
    /* Success Overlay */
    .success-overlay {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 32px 16px;
        animation: fadeIn 0.4s ease;
    }
    
    @@keyframes fadeIn {
        from { opacity: 0; transform: scale(0.95); }
        to { opacity: 1; transform: scale(1); }
    }
    
    .success-icon-container {
        width: 80px;
        height: 80px;
        background: rgba(255,255,255,0.2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 20px;
        animation: popIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }
    
    @@keyframes popIn {
        0% { transform: scale(0); }
        80% { transform: scale(1.1); }
        100% { transform: scale(1); }
    }
    
    .success-icon {
        color: #fff !important;
        font-size: 2.5rem !important;
    }
    
    .success-title {
        color: #fff !important;
        font-weight: 700 !important;
        margin-bottom: 8px !important;
    }
    
    .success-message {
        color: rgba(255,255,255,0.9) !important;
        margin-bottom: 24px !important;
    }
    
    .success-btn {
        color: #fff !important;
        font-weight: 500 !important;
        text-transform: none !important;
        border: 1px solid rgba(255,255,255,0.3) !important;
        border-radius: 8px !important;
        padding: 8px 16px !important;
    }
    
    .success-btn:hover {
        background: rgba(255,255,255,0.15) !important;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       FOOTER MÃNIMO
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .footer-minimal {
        text-align: center;
        color: rgba(255, 255, 255, 0.4);
        padding-top: 24px;
        font-size: 0.8rem;
    }

    .footer-minimal strong {
        color: rgba(255, 255, 255, 0.6);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       RESPONSIVE - MOBILE FIRST
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    @@media (max-width: 480px) {
        .landing-wrapper {
            padding: 16px 12px 32px;
            gap: 20px;
        }

        .profile-card, .lead-form-card {
            border-radius: 20px;
        }

        .card-header-gradient {
            height: 70px;
        }

        .avatar-container {
            margin-top: -40px;
        }

        .profile-avatar {
            width: 80px !important;
            height: 80px !important;
        }

        .card-content {
            padding: 0 16px 20px;
        }

        .cta-row .mud-button-root {
            min-width: 90px;
            font-size: 0.8rem !important;
            padding: 8px 10px !important;
        }

        .lead-form-card {
            padding: 20px 16px;
        }
    }

    /* Desktop - Cards mÃ¡s anchas */
    @@media (min-width: 768px) {
        .landing-wrapper {
            padding: 40px 24px 60px;
        }

        .profile-card, .lead-form-card {
            max-width: 440px;
        }

        .cta-row .mud-button-root {
            min-width: 120px;
        }
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       AUTO-CONTRAST SYSTEM
       Dynamic text colors based on surface luminance
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    /* === MODO OSCURO (texto claro sobre fondo oscuro) === */
    .contrast-dark {
        --surface-text-primary: #FFFFFF;
        --surface-text-secondary: rgba(255, 255, 255, 0.75);
        --surface-text-muted: rgba(255, 255, 255, 0.5);
        --surface-input-bg: rgba(255, 255, 255, 0.08);
        --surface-input-border: rgba(255, 255, 255, 0.2);
        --surface-input-text: #FFFFFF;
        --surface-input-placeholder: rgba(255, 255, 255, 0.5);
        --surface-icon: rgba(255, 255, 255, 0.85);
        --surface-chip-bg: rgba(255, 255, 255, 0.1);
        --surface-chip-text: rgba(255, 255, 255, 0.8);
        --surface-chip-border: rgba(255, 255, 255, 0.15);
        --surface-label-text: rgba(255, 255, 255, 0.85);
    }
    
    /* === MODO CLARO (texto oscuro sobre fondo claro) === */
    .contrast-light {
        --surface-text-primary: #1A1A2E;
        --surface-text-secondary: rgba(26, 26, 46, 0.75);
        --surface-text-muted: rgba(26, 26, 46, 0.5);
        --surface-input-bg: rgba(0, 0, 0, 0.06);
        --surface-input-border: rgba(0, 0, 0, 0.25);
        --surface-input-text: #1A1A2E;
        --surface-input-placeholder: rgba(0, 0, 0, 0.45);
        --surface-icon: rgba(26, 26, 46, 0.85);
        --surface-chip-bg: rgba(0, 0, 0, 0.08);
        --surface-chip-text: rgba(26, 26, 46, 0.8);
        --surface-chip-border: rgba(0, 0, 0, 0.15);
        --surface-label-text: rgba(26, 26, 46, 0.85);
    }
    
    /* Profile card text - contrast aware */
    .profile-card.contrast-dark .profile-name,
    .profile-card.contrast-light .profile-name {
        color: var(--surface-text-primary) !important;
    }
    
    .profile-card.contrast-dark .profile-title,
    .profile-card.contrast-dark .profile-bio,
    .profile-card.contrast-light .profile-title,
    .profile-card.contrast-light .profile-bio {
        color: var(--surface-text-secondary) !important;
    }
    
    .profile-card.contrast-dark .profile-location,
    .profile-card.contrast-light .profile-location {
        color: var(--surface-text-muted) !important;
    }
    
    /* Status chips - contrast aware */
    .profile-card.contrast-dark .status-chip,
    .profile-card.contrast-light .status-chip {
        background: var(--surface-chip-bg) !important;
        color: var(--surface-chip-text) !important;
        border-color: var(--surface-chip-border) !important;
    }
    
    /* Form header - contrast aware */
    .lead-form-card.contrast-dark .form-title,
    .lead-form-card.contrast-light .form-title {
        color: var(--surface-text-primary) !important;
    }
    
    .lead-form-card.contrast-dark .form-subtitle,
    .lead-form-card.contrast-light .form-subtitle {
        color: var(--surface-text-muted) !important;
    }
    
    /* Labels - contrast aware */
    .lead-form-card.contrast-dark .compact-label,
    .lead-form-card.contrast-light .compact-label {
        color: var(--surface-label-text) !important;
    }
    
    .lead-form-card.contrast-dark .label-icon,
    .lead-form-card.contrast-light .label-icon {
        color: var(--surface-icon) !important;
    }
    
    /* Native inputs - contrast aware */
    .lead-form-card.contrast-dark .native-text-input,
    .lead-form-card.contrast-dark .native-textarea-input,
    .lead-form-card.contrast-light .native-text-input,
    .lead-form-card.contrast-light .native-textarea-input {
        background: var(--surface-input-bg) !important;
        border-color: var(--surface-input-border) !important;
        color: var(--surface-input-text) !important;
        -webkit-text-fill-color: var(--surface-input-text) !important;
    }
    
    .lead-form-card.contrast-dark .native-text-input::placeholder,
    .lead-form-card.contrast-dark .native-textarea-input::placeholder,
    .lead-form-card.contrast-light .native-text-input::placeholder,
    .lead-form-card.contrast-light .native-textarea-input::placeholder {
        color: var(--surface-input-placeholder) !important;
        -webkit-text-fill-color: var(--surface-input-placeholder) !important;
    }
    
    /* MudBlazor inputs in form - contrast aware */
    .lead-form-card.contrast-dark .mud-input-slot,
    .lead-form-card.contrast-dark .mud-input > input,
    .lead-form-card.contrast-dark .mud-select-input,
    .lead-form-card.contrast-light .mud-input-slot,
    .lead-form-card.contrast-light .mud-input > input,
    .lead-form-card.contrast-light .mud-select-input {
        color: var(--surface-input-text) !important;
        -webkit-text-fill-color: var(--surface-input-text) !important;
    }
    
    /* Icons in inputs - contrast aware */
    .lead-form-card.contrast-dark .input-adornment .mud-icon-root,
    .lead-form-card.contrast-light .input-adornment .mud-icon-root {
        color: var(--surface-icon) !important;
    }
    
    /* Social icons - contrast aware */
    .profile-card.contrast-dark .social-icon,
    .profile-card.contrast-light .social-icon {
        color: var(--surface-icon) !important;
    }
    
    /* Gallery title - contrast aware */
    .profile-card.contrast-dark .gallery-section-title,
    .profile-card.contrast-light .gallery-section-title {
        color: var(--surface-text-primary) !important;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       COUNTRY PHONE INPUT - Contrast aware styling for light themes
       Forces proper text/placeholder colors on phone number field
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    /* Phone number input text - contrast aware */
    .lead-form-card.contrast-dark .phone-number-input,
    .lead-form-card.contrast-light .phone-number-input {
        color: var(--surface-input-text) !important;
        -webkit-text-fill-color: var(--surface-input-text) !important;
    }
    
    /* Phone number placeholder - contrast aware */
    .lead-form-card.contrast-dark .phone-number-input::placeholder,
    .lead-form-card.contrast-light .phone-number-input::placeholder {
        color: var(--surface-input-placeholder) !important;
        -webkit-text-fill-color: var(--surface-input-placeholder) !important;
        opacity: 1 !important;
    }
    
    /* Phone label - contrast aware */
    .lead-form-card.contrast-dark .phone-input-label,
    .lead-form-card.contrast-light .phone-input-label {
        color: var(--surface-label-text) !important;
    }
    
    .lead-form-card.contrast-dark .phone-input-label .label-icon,
    .lead-form-card.contrast-light .phone-input-label .label-icon {
        color: var(--surface-text-muted) !important;
    }
    
    /* Country selector text - contrast aware */
    .lead-form-card.contrast-dark .country-selector-wrapper .mud-input-slot,
    .lead-form-card.contrast-dark .country-selector-wrapper .mud-select-input,
    .lead-form-card.contrast-light .country-selector-wrapper .mud-input-slot,
    .lead-form-card.contrast-light .country-selector-wrapper .mud-select-input {
        color: var(--surface-input-text) !important;
        -webkit-text-fill-color: var(--surface-input-text) !important;
    }
    
    /* Country dial code - contrast aware */
    .lead-form-card.contrast-dark .country-dial,
    .lead-form-card.contrast-light .country-dial {
        color: var(--surface-input-text) !important;
    }
    
    /* Phone hints and counters - contrast aware */
    .lead-form-card.contrast-dark .digit-counter,
    .lead-form-card.contrast-dark .example-hint,
    .lead-form-card.contrast-light .digit-counter,
    .lead-form-card.contrast-light .example-hint {
        color: var(--surface-text-muted) !important;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SERVICES TEMPLATE - Matches TemplateLibrary Preview
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    .services-template-section {
        margin: 24px 0 20px;
        width: 100%;
    }
    
    .services-template-section .services-section-title {
        font-size: 0.75rem;
        font-weight: 600;
        color: rgba(255,255,255,0.5);
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 12px;
    }
    
    .services-cards-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    
    .service-card-item {
        display: flex;
        align-items: center;
        gap: 14px;
        padding: 14px 16px;
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 12px;
        transition: all 0.2s ease;
    }
    
    .service-card-item:hover {
        background: rgba(255,255,255,0.08);
        border-color: rgba(20,184,166,0.3);
    }
    
    .service-card-icon {
        width: 42px;
        height: 42px;
        min-width: 42px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
    }
    
    .service-card-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 2px;
    }
    
    .service-card-name {
        font-size: 0.95rem;
        font-weight: 600;
        color: #ffffff;
    }
    
    .service-card-meta {
        font-size: 0.8rem;
        color: rgba(255,255,255,0.6);
    }
    
    /* Services Template CTAs */
    .services-cta-section {
        margin-top: 20px;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    
    .btn-booking-primary {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        width: 100%;
        padding: 14px 20px;
        background: linear-gradient(135deg, #14B8A6, #0891B2);
        border: none;
        border-radius: 12px;
        color: #ffffff;
        font-size: 0.95rem;
        font-weight: 600;
        text-decoration: none;
        cursor: pointer;
        transition: all 0.25s ease;
    }
    
    .btn-booking-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 24px rgba(20,184,166,0.4);
    }
    
    .btn-quote-outlined {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        width: 100%;
        padding: 14px 20px;
        background: transparent;
        border: 1px solid rgba(20,184,166,0.5);
        border-radius: 12px;
        color: #14B8A6;
        font-size: 0.95rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.25s ease;
    }
    
    .btn-quote-outlined:hover {
        background: rgba(20,184,166,0.1);
        border-color: #14B8A6;
    }
    
    .btn-quote-link {
        display: block;
        width: 100%;
        text-align: center;
        margin-top: 12px;
        padding: 8px;
        background: transparent;
        border: none;
        color: rgba(255,255,255,0.6);
        font-size: 0.85rem;
        cursor: pointer;
        text-decoration: underline;
        text-underline-offset: 3px;
        transition: color 0.2s ease;
    }
    
    .btn-quote-link:hover {
        color: #14B8A6;
    }
    
    a.btn-quote-link {
        text-decoration: underline;
    }
    
    /* Services Contact Footer */
    .services-contact-footer {
        margin-top: 24px;
        padding-top: 16px;
        border-top: 1px solid rgba(255,255,255,0.08);
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    
    .services-contact-footer .contact-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.85rem;
        color: rgba(255,255,255,0.6);
        text-decoration: none;
        transition: color 0.2s ease;
    }
    
    .services-contact-footer .contact-item:hover {
        color: #14B8A6;
    }
</style>

@code {
    [Parameter] public string OrgSlug { get; set; } = "";
    [Parameter] public string CardSlug { get; set; } = "";

    private Card? _card;
    private Organization? _organization;
    private bool _isLoading = true;
    private bool _isSubmitting = false;
    private bool _showSuccess = false;
    private bool _submitError = false;
    private bool _isPhoneValid = false;
    private ContactFormModel _contactForm = new();
    
    // Field validation errors
    private string? _nameError = null;
    private string? _emailError = null;
    
    // Computed properties for validation
    private bool IsNameValid => !string.IsNullOrWhiteSpace(_contactForm.FullName) && _contactForm.FullName.Length >= 2;
    private bool IsEmailValid => !string.IsNullOrWhiteSpace(_contactForm.Email) && 
                                  System.Text.RegularExpressions.Regex.IsMatch(_contactForm.Email, @"^[^@\s]+@[^@\s]+\.[^@\s]+$");
    private bool CanSubmit => !_isSubmitting && IsNameValid && IsEmailValid && _isPhoneValid;
    
    // Deserialized JSON fields
    private SocialLinksModel? _socialLinks;
    private List<WebsiteLinkModel> _websiteLinks = new();
    
    // Gallery (Portfolio Template)
    private List<GalleryImageModel> _galleryImages = new();
    private bool _lightboxOpen = false;
    private GalleryImageModel? _selectedImage;
    private int _selectedIndex = 0;
    
    // Services (Services Template)
    private List<DataTouch.Domain.Entities.Service> _services = new();
    private bool _isServicesTemplate = false;
    
    // Appearance Style
    private CardStyleModel _cardStyle = new();
    private ThemeTokens _themeTokens = PresetRegistry.Default.Tokens;

    private MudTheme _theme = new()
    {
        PaletteDark = new PaletteDark()
        {
            Primary = "#8B5CF6",
            Secondary = "#A78BFA",
            Background = "#0d0a1a",
            Surface = "#19122d",
            TextPrimary = "#FFFFFF",
            TextSecondary = "#B3B3B3",
            TextDisabled = "#666666",
            ActionDefault = "#FFFFFF",
            ActionDisabled = "#4D4D4D",
            ActionDisabledBackground = "#1A1A1A",
            DrawerText = "#FFFFFF",
            DrawerIcon = "#B3B3B3",
            LinesDefault = "#3D2866",
            LinesInputs = "#3D2866",
            Divider = "#2D1B4E",
        },
        PaletteLight = new PaletteLight()
        {
            Primary = "#8B5CF6",
            Secondary = "#A78BFA",
            TextPrimary = "#FFFFFF",
            TextSecondary = "#B3B3B3",
        }
    };

    private class ContactFormModel
    {
        [System.ComponentModel.DataAnnotations.Required(ErrorMessage = "El nombre es requerido")]
        public string FullName { get; set; } = "";
        
        [System.ComponentModel.DataAnnotations.Required(ErrorMessage = "El email es requerido")]
        [System.ComponentModel.DataAnnotations.EmailAddress(ErrorMessage = "Email no vÃ¡lido")]
        public string Email { get; set; } = "";
        
        public string Phone { get; set; } = "";
        public string PhoneCountryCode { get; set; } = "SV";
        public string? PhoneE164 { get; set; }
        
        public string? Message { get; set; }
    }

    protected override async Task OnInitializedAsync()
    {
        _organization = await DbContext.Organizations
            .FirstOrDefaultAsync(o => o.Slug == OrgSlug && o.IsActive);

        if (_organization != null)
        {
            _card = await DbContext.Cards
                .Include(c => c.User)
                .FirstOrDefaultAsync(c => c.OrganizationId == _organization.Id && c.Slug == CardSlug && c.IsActive);
            
            if (_card != null)
            {
                DeserializeJsonFields();
                
                // Detect template type
                _isServicesTemplate = _card.TemplateType == "services-quotes";
                
                // Load services for services template
                _services = await DbContext.Services
                    .Where(s => s.CardId == _card.Id && s.IsActive)
                    .OrderBy(s => s.DisplayOrder)
                    .ToListAsync();
            }
        }
        _isLoading = false;
    }
    
    private void DeserializeJsonFields()
    {
        // Social Links
        if (!string.IsNullOrEmpty(_card?.SocialLinksJson))
        {
            try
            {
                _socialLinks = System.Text.Json.JsonSerializer.Deserialize<SocialLinksModel>(_card.SocialLinksJson);
            }
            catch { _socialLinks = null; }
        }

        // Website Links
        if (!string.IsNullOrEmpty(_card?.WebsiteLinksJson))
        {
            try
            {
                _websiteLinks = System.Text.Json.JsonSerializer.Deserialize<List<WebsiteLinkModel>>(_card.WebsiteLinksJson) ?? new();
            }
            catch { _websiteLinks = new(); }
        }
        
        // Gallery Images
        if (!string.IsNullOrEmpty(_card?.GalleryImagesJson))
        {
            try
            {
                _galleryImages = System.Text.Json.JsonSerializer.Deserialize<List<GalleryImageModel>>(_card.GalleryImagesJson) ?? new();
            }
            catch { _galleryImages = new(); }
        }
        
        // Appearance Style
        if (!string.IsNullOrEmpty(_card?.AppearanceStyleJson))
        {
            try
            {
                _cardStyle = System.Text.Json.JsonSerializer.Deserialize<CardStyleModel>(_card.AppearanceStyleJson) ?? new();
                
                // Load ThemeTokens from preset registry
                if (!string.IsNullOrEmpty(_cardStyle.PresetId))
                {
                    var preset = PresetRegistry.GetById(_cardStyle.PresetId);
                    if (preset != null)
                    {
                        _themeTokens = preset.Tokens;
                    }
                }
            }
            catch { _cardStyle = new(); }
        }
    }
    
    private string GetDisplayCompanyName()
    {
        if (!string.IsNullOrEmpty(_card?.CompanyName))
            return _card.CompanyName;
        return _organization?.Name ?? "";
    }

    private async Task DownloadVCard()
    {
        if (_card == null) return;

        var vcard = $@"BEGIN:VCARD
VERSION:3.0
FN:{_card.FullName}
TITLE:{_card.Title}
TEL:{GetFullPhoneForLink()}
EMAIL:{_card.Email}
ORG:{_organization?.Name}
END:VCARD";

        var bytes = System.Text.Encoding.UTF8.GetBytes(vcard);
        var base64 = Convert.ToBase64String(bytes);
        var fileName = $"{_card.FullName?.Replace(" ", "_")}.vcf";

        await JSRuntime.InvokeVoidAsync("eval", $@"
            var link = document.createElement('a');
            link.href = 'data:text/vcard;base64,{base64}';
            link.download = '{fileName}';
            link.click();
        ");
        Snackbar.Add("Contacto guardado", Severity.Success);
    }

    private async Task OpenSocialLink(string url)
    {
        await JSRuntime.InvokeVoidAsync("open", url, "_blank");
    }

    private async Task SubmitContact()
    {
        if (_card == null || _organization == null) return;
        if (!CanSubmit) return;

        _isSubmitting = true;
        _submitError = false;
        
        try
        {
            var lead = new Lead
            {
                Id = Guid.NewGuid(),
                OrganizationId = _organization.Id,
                CardId = _card.Id,
                OwnerUserId = _card.UserId,
                FullName = _contactForm.FullName.Trim(),
                Email = _contactForm.Email.Trim().ToLowerInvariant(),
                Phone = _contactForm.Phone,
                PhoneCountryCode = GetDialCodeFromCountryCode(_contactForm.PhoneCountryCode),
                PhoneE164 = _contactForm.PhoneE164,
                Message = _contactForm.Message?.Trim(),
                Source = "CARD_CONTACT_FORM",
                Status = "New",
                CreatedAt = DateTime.UtcNow
            };

            DbContext.Leads.Add(lead);
            await DbContext.SaveChangesAsync();

            // Show success animation
            _showSuccess = true;
            _isSubmitting = false;
        }
        catch
        {
            _submitError = true;
            _isSubmitting = false;
        }
    }
    
    private string GetDialCodeFromCountryCode(string countryCode)
    {
        // Map country codes to dial codes
        var dialCodes = new Dictionary<string, string>
        {
            { "SV", "+503" }, { "GT", "+502" }, { "HN", "+504" }, { "NI", "+505" },
            { "CR", "+506" }, { "PA", "+507" }, { "BZ", "+501" }, { "MX", "+52" },
            { "US", "+1" }, { "CA", "+1" }, { "CO", "+57" }, { "PE", "+51" },
            { "AR", "+54" }, { "CL", "+56" }, { "EC", "+593" }, { "VE", "+58" },
            { "BO", "+591" }, { "PY", "+595" }, { "UY", "+598" }, { "DO", "+1" },
            { "PR", "+1" }, { "CU", "+53" }, { "ES", "+34" }, { "FR", "+33" },
            { "DE", "+49" }, { "IT", "+39" }, { "GB", "+44" }, { "PT", "+351" }
        };
        return dialCodes.TryGetValue(countryCode, out var dial) ? dial : "+503";
    }
    
    private void ResetForm()
    {
        _contactForm = new ContactFormModel();
        _showSuccess = false;
        _submitError = false;
        _isPhoneValid = false;
    }
    
    private string GetSubmitButtonClass()
    {
        if (_isSubmitting) return "loading";
        if (_submitError) return "error";
        if (!CanSubmit) return "disabled";
        return "ready";
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Services/Booking Methods
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    private string GetBookingUrl()
    {
        if (_organization == null || _card == null) return "#";
        return $"/p/{_organization.Slug}/{_card.Slug}/book";
    }
    
    private async Task ScrollToContactForm()
    {
        await JSRuntime.InvokeVoidAsync("scrollToElement", ".lead-form-card");
    }
    
    private async Task OpenQuoteModal()
    {
        var parameters = new DialogParameters<QuoteRequestModal>
        {
            { x => x.Services, _services },
            { x => x.CardId, _card!.Id }
        };
        
        var options = new DialogOptions
        {
            MaxWidth = MaxWidth.Small,
            FullWidth = true,
            CloseButton = true,
            BackdropClick = false
        };
        
        await DialogService.ShowAsync<QuoteRequestModal>("Solicitar CotizaciÃ³n", parameters, options);
    }
    
    private string GetServiceIconColor(int index)
    {
        var colors = new[] { 
            "linear-gradient(135deg, #EC4899, #F97316)", // Pink to Orange
            "linear-gradient(135deg, #3B82F6, #8B5CF6)", // Blue to Purple
            "linear-gradient(135deg, #14B8A6, #10B981)", // Teal to Green
            "linear-gradient(135deg, #F59E0B, #EF4444)", // Amber to Red
            "linear-gradient(135deg, #8B5CF6, #EC4899)"  // Purple to Pink
        };
        return colors[index % colors.Length];
    }
    
    // ViewModels for JSON fields
    private class SocialLinksModel
    {
        public string? LinkedIn { get; set; }
        public string? Instagram { get; set; }
        public string? YouTube { get; set; }
        public string? Twitter { get; set; }

        public bool HasAnyLink()
        {
            return !string.IsNullOrEmpty(LinkedIn) ||
                   !string.IsNullOrEmpty(Instagram) ||
                   !string.IsNullOrEmpty(YouTube) ||
                   !string.IsNullOrEmpty(Twitter);
        }
    }

    private class WebsiteLinkModel
    {
        public string Title { get; set; } = "";
        public string Url { get; set; } = "";
    }
    
    private class GalleryImageModel
    {
        public string Url { get; set; } = "";
        public string? Title { get; set; }
        public string? Description { get; set; }
        public int Order { get; set; }
    }
    
    private class CardStyleModel
    {
        public string BackgroundType { get; set; } = "gradient";
        public string BackgroundValue { get; set; } = "linear-gradient(135deg, #1a1035 0%, #2d1b4e 50%, #1a1035 100%)";
        public string? BackgroundImageUrl { get; set; }
        
        // Card Independence
        public bool CardLinkedToBackground { get; set; } = true;
        public string CardContainerStyle { get; set; } = "glass";
        public string CardBackgroundColor { get; set; } = "#1A1035";
        public int GlassIntensity { get; set; } = 40;
        public string BorderRadius { get; set; } = "medium";
        public string ShadowStyle { get; set; } = "soft";
        public string AvatarSize { get; set; } = "M";
        public bool AvatarGlow { get; set; } = true;
        public string ButtonShape { get; set; } = "rounded";
        public string ButtonStyle { get; set; } = "filled";
        public double OverlayOpacity { get; set; } = 0.3;
        public bool ShowGrain { get; set; } = false;
        
        // Contrast settings
        public string ContrastMode { get; set; } = "auto";
        public bool BackgroundIsDark { get; set; } = true;
        public bool CardIsDark { get; set; } = true;
        public bool CardIsDarkOverride { get; set; } = true;
        
        // Preset tracking (new v2)
        public string? PresetId { get; set; } = "premium-dark";
        public string? AccentColor { get; set; } = "#7C3AED";
    }
    
    private string GetDynamicBackgroundStyle()
    {
        if (_cardStyle.BackgroundType == "image" && !string.IsNullOrEmpty(_cardStyle.BackgroundImageUrl))
            return $"background: url('{_cardStyle.BackgroundImageUrl}') center/cover no-repeat, linear-gradient(180deg, #0d0a1a 0%, #1a1035 100%);";
        if (_cardStyle.BackgroundType == "solid")
            return $"background: {_themeTokens.BgValue};";
        return $"background: {_themeTokens.BgValue};";
    }
    
    private string GetThemeCssVariables()
    {
        return ThemeHelper.GenerateCssVariables(_themeTokens);
    }
    
    private string GetCardBackgroundStyle()
    {
        if (_cardStyle.CardLinkedToBackground) return "";
        return $"background: {_cardStyle.CardBackgroundColor} !important;";
    }
    
    // Get contrast class for background surface
    private string GetBackgroundContrastClass()
    {
        if (_cardStyle.ContrastMode == "force-light") return "contrast-light";
        if (_cardStyle.ContrastMode == "force-dark") return "contrast-dark";
        return _cardStyle.BackgroundIsDark ? "contrast-dark" : "contrast-light";
    }
    
    // Get contrast class for card surface
    private string GetCardContrastClass()
    {
        if (_cardStyle.ContrastMode == "force-light") return "contrast-light";
        if (_cardStyle.ContrastMode == "force-dark") return "contrast-dark";
        
        if (!_cardStyle.CardLinkedToBackground)
        {
            return _cardStyle.CardIsDarkOverride ? "contrast-dark" : "contrast-light";
        }
        
        return _cardStyle.CardIsDark ? "contrast-dark" : "contrast-light";
    }
    
    // Gallery Lightbox Methods
    private void OpenLightbox(GalleryImageModel image)
    {
        _selectedImage = image;
        _selectedIndex = _galleryImages.OrderBy(i => i.Order).ToList().IndexOf(image);
        _lightboxOpen = true;
    }
    
    private void CloseLightbox()
    {
        _lightboxOpen = false;
        _selectedImage = null;
    }
    
    private void PrevImage()
    {
        if (_galleryImages.Count == 0) return;
        var ordered = _galleryImages.OrderBy(i => i.Order).ToList();
        _selectedIndex = (_selectedIndex - 1 + ordered.Count) % ordered.Count;
        _selectedImage = ordered[_selectedIndex];
    }
    
    private void NextImage()
    {
        if (_galleryImages.Count == 0) return;
        var ordered = _galleryImages.OrderBy(i => i.Order).ToList();
        _selectedIndex = (_selectedIndex + 1) % ordered.Count;
        _selectedImage = ordered[_selectedIndex];
    }
    private string GetFullPhoneForLink()
    {
        if (_card == null) return "";
        var code = _card.PhoneCountryCode ?? "";
        var number = _card.Phone?.Replace(" ", "").Replace("-", "") ?? "";
        return $"{code}{number}";
    }

    private string GetFullWhatsAppForLink() 
    {
        if (_card == null) return "";
        var code = _card.WhatsAppCountryCode?.Replace("+", "") ?? ""; // WA expects 52... not +52
        var number = _card.WhatsAppNumber?.Replace(" ", "").Replace("-", "") ?? "";
        return $"{code}{number}";
    }
}
