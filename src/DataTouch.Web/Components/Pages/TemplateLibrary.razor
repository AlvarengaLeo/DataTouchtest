@page "/templates"
@attribute [Authorize]
@inject ISnackbar Snackbar
@inject NavigationManager Navigation
@inject DataTouch.Web.Services.AuthService AuthService
@inject DataTouch.Infrastructure.Data.DataTouchDbContext DbContext
@using Microsoft.EntityFrameworkCore

<PageTitle>Elegir Plantilla - DataTouch</PageTitle>

<div class="templates-module @(_navDirection)" @onkeydown="HandleKeyDown" tabindex="0">
    <header class="module-header">
        <h1 class="header-title">Elige el diseÃ±o de tu tarjeta</h1>
        <p class="header-subtitle">Selecciona ahora. Personaliza los detalles despuÃ©s.</p>
    </header>

    <section class="carousel-section">
        <button class="nav-arrow nav-arrow--left" @onclick="NavigatePrev" aria-label="Plantilla anterior">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15,18 9,12 15,6"></polyline>
            </svg>
        </button>

        <div class="carousel-container">
            <div class="carousel-track">
                @foreach (var pos in _visiblePositions)
                {
                    var template = GetTemplateAt(pos);
                    var isActive = pos == 0;
                    <div class="carousel-item @GetStateClass(pos)" style="@GetItemStyle(pos)" @onclick="() => HandleCardClick(pos)">
                        <div class="page-wrapper">
                            <div class="iphone-frame">
                                <div class="dynamic-island"></div>
                                <div class="iphone-screen">
                                    <div class="screen-content" @onscroll="OnScreenScroll">
                                        @if (template.IsPortfolio)
                                        {
                                            @* Portfolio Creative Full Preview - Matches Public Card 1:1 *@
                                            <div class="portfolio-preview-full">
                                                @* Hero Section *@
                                                <div class="pp-hero">
                                                    <div class="pp-avatar">
                                                        <span>@GetUserInitials()</span>
                                                    </div>
                                                    <h3 class="pp-name">@GetUserDisplayName()</h3>
                                                    <p class="pp-title">@(_userCard?.Title ?? "Tu Cargo")</p>
                                                    <p class="pp-company"><span class="pp-company-icon">ğŸ¢</span> @(_userCard?.CompanyName ?? _userCard?.Organization?.Name ?? "Tu Empresa")</p>
                                                    <p class="pp-bio">@(_userCard?.Bio ?? "Tu biografÃ­a aparecerÃ¡ aquÃ­. Describe tu experiencia y especialidades.")</p>
                                                    
                                                    @* Social Icons *@
                                                    <div class="pp-social-row">
                                                        <span class="pp-social-icon">
                                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                                                        </span>
                                                        <span class="pp-social-icon">
                                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
                                                        </span>
                                                        <span class="pp-social-icon">
                                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                                                        </span>
                                                        <span class="pp-social-icon">
                                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>
                                                        </span>
                                                    </div>
                                                </div>

                                                @* Status Chips *@
                                                <div class="pp-chips">
                                                    <span class="pp-chip"><span class="pp-chip-dot"></span> Disponible</span>
                                                    <span class="pp-chip">â± Responde &lt; 1h</span>
                                                    <span class="pp-chip">ğŸ“ El Salvador</span>
                                                </div>

                                                @* Mi Trabajo Section with REAL images *@
                                                <div class="pp-work-section">
                                                    <h4 class="pp-section-title">MI TRABAJO</h4>
                                                    <div class="pp-gallery-grid">
                                                        <div class="pp-gallery-item">
                                                            <img src="https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=400&fit=crop" alt="Portfolio 1" />
                                                        </div>
                                                        <div class="pp-gallery-item">
                                                            <img src="https://images.unsplash.com/photo-1469474968028-56623f02e42e?w=400&h=400&fit=crop" alt="Portfolio 2" />
                                                        </div>
                                                        <div class="pp-gallery-item">
                                                            <img src="https://images.unsplash.com/photo-1433086966358-54859d0ed716?w=400&h=400&fit=crop" alt="Portfolio 3" />
                                                        </div>
                                                        <div class="pp-gallery-item">
                                                            <img src="https://images.unsplash.com/photo-1501785888041-af3ef285b470?w=400&h=400&fit=crop" alt="Portfolio 4" />
                                                        </div>
                                                    </div>
                                                </div>

                                                @* CTAs *@
                                                <div class="pp-cta-section">
                                                    <button class="pp-cta-primary"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg> Guardar Contacto</button>
                                                    <div class="pp-cta-row">
                                                        <button class="pp-cta-secondary pp-whatsapp"><svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg> WhatsApp</button>
                                                        <button class="pp-cta-secondary pp-call"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg> Llamar</button>
                                                        <button class="pp-cta-secondary pp-email"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg> Email</button>
                                                    </div>
                                                </div>

                                                @* Contact Form *@
                                                <div class="pp-form-section">
                                                    <h4 class="pp-form-title">Â¿Quieres que te contacte?</h4>
                                                    <p class="pp-form-subtitle">DÃ©jame tus datos y te respondo pronto</p>
                                                    
                                                    <div class="pp-form-field">
                                                        <label>ğŸ‘¤ Nombre completo *</label>
                                                        <div class="pp-input">Juan PÃ©rez</div>
                                                    </div>
                                                    <div class="pp-form-field">
                                                        <label>ğŸ“§ Correo electrÃ³nico *</label>
                                                        <div class="pp-input">tu@email.com</div>
                                                    </div>
                                                    <div class="pp-form-field">
                                                        <label>ğŸ“± TelÃ©fono *</label>
                                                        <div class="pp-phone-row">
                                                            <div class="pp-country-code">SV +503</div>
                                                            <div class="pp-input pp-phone-input">7000 0000</div>
                                                        </div>
                                                    </div>
                                                    <div class="pp-form-field">
                                                        <label>ğŸ’¬ Mensaje (opcional)</label>
                                                        <div class="pp-textarea">Â¿En quÃ© puedo ayudarte?</div>
                                                    </div>
                                                    <button class="pp-submit-btn">â¤ Enviar mensaje</button>
                                                </div>

                                                @* Footer *@
                                                <div class="pp-footer">
                                                    <span>Powered by <strong>DataTouch</strong></span>
                                                </div>
                                            </div>
                                        }
                                        else if (template.IsDefault)
                                        {
                                            @* Default/Perfil Profesional Preview - Matches Public Card Layout *@
                                            <div class="default-preview-full">
                                                @* Hero Section *@
                                                <div class="dp-hero">
                                                    <div class="dp-avatar">
                                                        <span>@GetUserInitials()</span>
                                                    </div>
                                                    <h3 class="dp-name">@GetUserDisplayName()</h3>
                                                    <p class="dp-title">@(_userCard?.Title ?? "Tu Cargo")</p>
                                                    <p class="dp-company"><span class="dp-company-icon">ğŸ¢</span> @(_userCard?.CompanyName ?? _userCard?.Organization?.Name ?? "Tu Empresa")</p>
                                                    <p class="dp-bio">@(_userCard?.Bio ?? "Tu biografÃ­a aparecerÃ¡ aquÃ­. Describe tu experiencia y especialidades.")</p>
                                                    
                                                    @* Social Icons *@
                                                    <div class="dp-social-row">
                                                        <span class="dp-social-icon">
                                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                                                        </span>
                                                        <span class="dp-social-icon">
                                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
                                                        </span>
                                                        <span class="dp-social-icon">
                                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                                                        </span>
                                                    </div>
                                                </div>

                                                @* Status Chips *@
                                                <div class="dp-chips">
                                                    <span class="dp-chip"><span class="dp-chip-dot"></span> Disponible</span>
                                                    <span class="dp-chip">â± Responde &lt; 1h</span>
                                                    <span class="dp-chip">ğŸ“ El Salvador</span>
                                                </div>

                                                @* CTAs *@
                                                <div class="dp-cta-section">
                                                    <button class="dp-cta-primary"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg> Guardar Contacto</button>
                                                    <div class="dp-cta-row">
                                                        <button class="dp-cta-secondary dp-whatsapp"><svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg> WhatsApp</button>
                                                        <button class="dp-cta-secondary dp-call"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg> Llamar</button>
                                                        <button class="dp-cta-secondary dp-email"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg> Email</button>
                                                    </div>
                                                </div>

                                                @* Contact Form *@
                                                <div class="dp-form-section">
                                                    <h4 class="dp-form-title">Â¿Quieres que te contacte?</h4>
                                                    <p class="dp-form-subtitle">DÃ©jame tus datos y te respondo pronto</p>
                                                    
                                                    <div class="dp-form-field">
                                                        <label>ğŸ‘¤ Nombre completo *</label>
                                                        <div class="dp-input">Juan PÃ©rez</div>
                                                    </div>
                                                    <div class="dp-form-field">
                                                        <label>ğŸ“§ Correo electrÃ³nico *</label>
                                                        <div class="dp-input">tu@email.com</div>
                                                    </div>
                                                    <div class="dp-form-field">
                                                        <label>ğŸ“± TelÃ©fono *</label>
                                                        <div class="dp-phone-row">
                                                            <div class="dp-country-code">SV +503</div>
                                                            <div class="dp-input dp-phone-input">7000 0000</div>
                                                        </div>
                                                    </div>
                                                    <div class="dp-form-field">
                                                        <label>ğŸ’¬ Mensaje (opcional)</label>
                                                        <div class="dp-textarea">Â¿En quÃ© puedo ayudarte?</div>
                                                    </div>
                                                    <button class="dp-submit-btn">â¤ Enviar mensaje</button>
                                                </div>

                                                @* Footer *@
                                                <div class="dp-footer">
                                                    <span>Powered by <strong>DataTouch</strong></span>
                                                </div>
                                            </div>
                                        }
                                        else if (template.IsServices)
                                        {
                                            @* Services & Quotes Template Preview *@
                                            <div class="services-preview-full">
                                                @* Hero Section *@
                                                <div class="sp-hero">
                                                    <div class="sp-avatar">
                                                        <span>@GetUserInitials()</span>
                                                    </div>
                                                    <h3 class="sp-name">@GetUserDisplayName()</h3>
                                                    <p class="sp-title">@(_userCard?.Title ?? "Consultor Profesional")</p>
                                                    <p class="sp-company">ğŸ¢ @(_userCard?.CompanyName ?? "AsesorÃ­a Empresarial")</p>
                                                </div>

                                                @* Services Section *@
                                                <div class="sp-services-section">
                                                    <h4 class="sp-section-title">MIS SERVICIOS</h4>
                                                    <div class="sp-services-list">
                                                        <div class="sp-service-card">
                                                            <div class="sp-service-icon">ğŸ’¼</div>
                                                            <div class="sp-service-info">
                                                                <span class="sp-service-name">ConsultorÃ­a Empresarial</span>
                                                                <span class="sp-service-meta">60 min â€¢ Desde $50</span>
                                                            </div>
                                                        </div>
                                                        <div class="sp-service-card">
                                                            <div class="sp-service-icon">ğŸ“Š</div>
                                                            <div class="sp-service-info">
                                                                <span class="sp-service-name">AnÃ¡lisis de Proyectos</span>
                                                                <span class="sp-service-meta">90 min â€¢ Desde $75</span>
                                                            </div>
                                                        </div>
                                                        <div class="sp-service-card">
                                                            <div class="sp-service-icon">ğŸ¯</div>
                                                            <div class="sp-service-info">
                                                                <span class="sp-service-name">PlanificaciÃ³n EstratÃ©gica</span>
                                                                <span class="sp-service-meta">120 min â€¢ Desde $100</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                @* Booking CTAs *@
                                                <div class="sp-cta-section">
                                                    <button class="sp-cta-primary sp-book">ğŸ“… Reservar Cita</button>
                                                    <button class="sp-cta-secondary sp-quote">ğŸ“ Solicitar CotizaciÃ³n</button>
                                                </div>

                                                @* Contact Info *@
                                                <div class="sp-contact-section">
                                                    <div class="sp-contact-item">ğŸ“§ tu@email.com</div>
                                                    <div class="sp-contact-item">ğŸ“± +503 7000-0000</div>
                                                </div>

                                                @* Footer *@
                                                <div class="sp-footer">
                                                    <span>Powered by <strong>DataTouch</strong></span>
                                                </div>
                                            </div>
                                        }
                                        else
                                        {
                                            @* Standard Template Preview *@
                                            <div class="standard-preview-full">
                                                <div class="preview-hero" style="background: @template.HeroGradient;">
                                                    <div class="preview-avatar"><span>S</span></div>
                                                    <h3 class="preview-name">Sarah Johnson</h3>
                                                    <p class="preview-title">Marketing Director</p>
                                                    <p class="preview-company">Nurtured â€¢ Devoted</p>
                                                </div>
                                                <div class="preview-actions">
                                                    <button class="action-btn">ğŸ“</button>
                                                    <button class="action-btn">ğŸ“¹</button>
                                                    <button class="action-btn">ğŸ’¬</button>
                                                    <button class="action-btn">âœ‰ï¸</button>
                                                </div>
                                                <div class="preview-section">
                                                    <h4 class="section-title">Acerca de</h4>
                                                    <p class="section-text">Profesional de marketing con mÃ¡s de 10 aÃ±os en estrategia digital y desarrollo de marca.</p>
                                                </div>
                                                <div class="preview-section">
                                                    <h4 class="section-title">Contacto</h4>
                                                    <div class="contact-item">ğŸ“§ sarah.johnson@example.com</div>
                                                    <div class="contact-item">ğŸ“± +1 (555) 123-4567</div>
                                                </div>
                                                <div class="preview-section">
                                                    <h4 class="section-title">Enlaces</h4>
                                                    <div class="link-btn">ğŸ”— Perfil de LinkedIn</div>
                                                    <div class="link-btn">ğŸŒ Sitio Web Personal</div>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                    @if (isActive && !_hasScrolled)
                                    {
                                        <div class="scroll-hint"><span>Desliza para explorar</span></div>
                                    }
                                </div>
                                <div class="home-indicator"></div>
                            </div>
                            <div class="page-shadow"></div>
                        </div>
                        <div class="item-label">
                            <span class="item-name">@template.Name</span>
                            @if (isActive) { <span class="selected-badge">âœ“ Seleccionado</span> }
                        </div>
                    </div>
                }
            </div>
        </div>

        <button class="nav-arrow nav-arrow--right" @onclick="NavigateNext" aria-label="Siguiente plantilla">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9,18 15,12 9,6"></polyline>
            </svg>
        </button>
    </section>

    <footer class="decision-dock">
        <div class="dock-content">
            <div class="dock-info">
                <span class="dock-name">@SelectedTemplate?.Name</span>
                <span class="dock-desc">@SelectedTemplate?.Description</span>
            </div>
            <div class="dock-dots">
                @for (int i = 0; i < _templates.Count; i++)
                {
                    var idx = i;
                    <button class="dot @(idx == _activeIndex ? "dot--active" : "")" @onclick="() => GoToIndex(idx)"></button>
                }
            </div>
            <button class="cta-primary" @onclick="UseThisDesign">
                <span>Usar este diseÃ±o</span>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <path d="M5 12h14M12 5l7 7-7 7"/>
                </svg>
            </button>
        </div>
    </footer>
</div>

<style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       3D BOOK PAGE TURN - PREMIUM ANIMATION SYSTEM
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .templates-module {
        /* Phone dimensions */
        --phone-width: clamp(260px, 22vw, 320px);
        --phone-height: clamp(540px, 65vh, 680px);
        --phone-radius: 52px;
        
        /* 3D Perspective */
        --perspective: 1600px;
        
        /* Page Turn Animation - REFINED */
        --page-turn-duration: 850ms;
        --page-turn-easing: cubic-bezier(0.16, 1, 0.3, 1); /* Heavy ease-out, organic deceleration */
        
        /* Spacing - Increased for openness */
        --spacing-adjacent: 1.1;
        --spacing-far: 1.65;
        
        /* Z-Depth - Enhanced separation */
        --z-active: 80px;
        --z-adjacent: -60px;
        --z-far: -140px;
        
        min-height: 100vh;
        padding: 15px 18px 45px;
        background: linear-gradient(165deg, #0a0d12 0%, #111720 50%, #0c1015 100%);
        display: flex;
        flex-direction: column;
        outline: none;
        overflow: hidden;
    }

    .module-header { text-align: left; margin-bottom: 20px; padding-left: 48px; }
    .header-title { font-size: 1.75rem; font-weight: 600; color: #f3f4f6; margin: 0 0 4px 0; }
    .header-subtitle { font-size: 0.925rem; color: #9ca3af; margin: 0; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CAROUSEL - 3D PERSPECTIVE STAGE
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .carousel-section {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        min-height: 500px;
        padding: 0 80px;
        perspective: var(--perspective);
        perspective-origin: center center;
    }

    .carousel-container {
        width: 100%;
        max-width: 1400px;
        display: flex;
        justify-content: center;
        transform-style: preserve-3d;
    }

    .carousel-track {
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        height: calc(var(--phone-height) + 100px);
        width: 100%;
        transform-style: preserve-3d;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CAROUSEL ITEMS - BOOK PAGE BEHAVIOR
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .carousel-item {
        position: absolute;
        display: flex;
        flex-direction: column;
        align-items: center;
        transform-style: preserve-3d;
        transition: 
            transform var(--page-turn-duration) var(--page-turn-easing),
            opacity var(--page-turn-duration) var(--page-turn-easing);
        will-change: transform, opacity;
        cursor: pointer;
    }

    .page-wrapper {
        position: relative;
        transform-style: preserve-3d;
    }

    /* Dynamic page shadow during turn */
    .page-shadow {
        position: absolute;
        top: 5%;
        left: -20px;
        right: -20px;
        bottom: 5%;
        background: transparent;
        border-radius: var(--phone-radius);
        pointer-events: none;
        opacity: 0;
        transition: opacity var(--page-turn-duration) var(--page-turn-easing);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ACTIVE STATE - CENTER HERO (100% SHARP - NO BLUR)
       Key fix: Override transform-style to FLAT to break 3D context
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .carousel-item--active {
        z-index: 50;
        /* CRITICAL: Override preserve-3d to flat - this breaks 3D blur */
        transform-style: flat !important;
        /* Simple 2D transform - NO scale to prevent interpolation blur */
        transform: translateX(0) translateY(0);
        opacity: 1;
        /* Ensure no filters */
        filter: none !important;
        -webkit-filter: none !important;
    }
    
    .carousel-item--active .page-wrapper {
        transform-style: flat !important;
    }
    
    .carousel-item--active .iphone-frame {
        transform-style: flat !important;
        filter: none !important;
        -webkit-filter: none !important;
        box-shadow: 
            0 4px 12px rgba(0,0,0,0.08),
            0 12px 40px rgba(0,0,0,0.12),
            0 32px 80px rgba(0,0,0,0.18),
            0 0 100px rgba(99, 102, 241, 0.15);
    }
    
    .carousel-item--active .iphone-screen {
        filter: none !important;
        -webkit-filter: none !important;
        backdrop-filter: none !important;
        overflow: visible;
        pointer-events: auto !important;
    }
    
    /* SCROLL FIX: Ensure screen-content can scroll */
    .carousel-item--active .screen-content {
        filter: none !important;
        -webkit-filter: none !important;
        overflow-y: auto !important;
        overflow-x: hidden !important;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
        -ms-overflow-style: none;
        pointer-events: auto !important;
        position: relative;
        z-index: 10;
        touch-action: pan-y;
    }
    .carousel-item--active .screen-content::-webkit-scrollbar {
        display: none;
    }
    
    .carousel-item--active .portfolio-preview-full,
    .carousel-item--active .portfolio-preview-full * {
        filter: none !important;
        -webkit-filter: none !important;
        backdrop-filter: none !important;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       LEFT PAGES - Turned/Stacked Behind (like read pages)
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .carousel-item--adjacent-left {
        z-index: 30;
        transform-origin: right center;
        transform: 
            translateX(calc(-1 * var(--spacing-adjacent) * var(--phone-width))) 
            translateZ(var(--z-adjacent)) 
            rotateY(42deg) 
            scale(0.82);
        opacity: 0.50;
        filter: blur(0.8px) brightness(0.78);
    }

    .carousel-item--adjacent-left .page-shadow {
        opacity: 0.35;
        background: linear-gradient(to right, rgba(0,0,0,0.25), transparent);
    }

    .carousel-item--far-left {
        z-index: 15;
        transform-origin: right center;
        transform: 
            translateX(calc(-1 * var(--spacing-far) * var(--phone-width))) 
            translateZ(var(--z-far)) 
            rotateY(55deg) 
            scale(0.65);
        opacity: 0.20;
        filter: blur(1.5px) brightness(0.6);
        pointer-events: none;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       RIGHT PAGES - Waiting to be turned (unread stack)
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .carousel-item--adjacent-right {
        z-index: 30;
        transform-origin: left center;
        transform: 
            translateX(calc(var(--spacing-adjacent) * var(--phone-width))) 
            translateZ(var(--z-adjacent)) 
            rotateY(-42deg) 
            scale(0.82);
        opacity: 0.50;
        filter: blur(0.8px) brightness(0.78);
    }

    .carousel-item--adjacent-right .page-shadow {
        opacity: 0.35;
        background: linear-gradient(to left, rgba(0,0,0,0.25), transparent);
    }

    .carousel-item--far-right {
        z-index: 15;
        transform-origin: left center;
        transform: 
            translateX(calc(var(--spacing-far) * var(--phone-width))) 
            translateZ(var(--z-far)) 
            rotateY(-55deg) 
            scale(0.65);
        opacity: 0.20;
        filter: blur(1.5px) brightness(0.6);
        pointer-events: none;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       DIRECTION-BASED PAGE TURN ANIMATION
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .nav-next .carousel-item--active {
        animation: pageEnterFromRight var(--page-turn-duration) var(--page-turn-easing) forwards;
    }

    .nav-prev .carousel-item--active {
        animation: pageEnterFromLeft var(--page-turn-duration) var(--page-turn-easing) forwards;
    }

    @@keyframes pageEnterFromRight {
        0% {
            transform: 
                translateX(calc(var(--spacing-adjacent) * var(--phone-width))) 
                translateZ(var(--z-adjacent)) 
                rotateY(-42deg) 
                scale(0.82);
            opacity: 0.50;
        }
        60% {
            transform: 
                translateX(calc(0.15 * var(--phone-width))) 
                translateZ(40px) 
                rotateY(-8deg) 
                scale(0.98);
            opacity: 0.92;
        }
        100% {
            /* CRITICAL: Pure 2D transform at end - no translateZ to avoid blur */
            transform: translateX(0) translateY(0);
            opacity: 1;
            filter: none;
        }
    }

    @@keyframes pageEnterFromLeft {
        0% {
            transform: 
                translateX(calc(-1 * var(--spacing-adjacent) * var(--phone-width))) 
                translateZ(var(--z-adjacent)) 
                rotateY(42deg) 
                scale(0.82);
            opacity: 0.50;
        }
        60% {
            transform: 
                translateX(calc(-0.15 * var(--phone-width))) 
                translateZ(40px) 
                rotateY(8deg) 
                scale(0.98);
            opacity: 0.92;
        }
        100% {
            /* CRITICAL: Pure 2D transform at end - no translateZ to avoid blur */
            transform: translateX(0) translateY(0);
            opacity: 1;
            filter: none;
        }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       iPHONE FRAME (unchanged)
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .iphone-frame {
        width: var(--phone-width);
        height: var(--phone-height);
        background: linear-gradient(145deg, #2a2f3a, #1a1f28);
        border-radius: var(--phone-radius);
        padding: 10px;
        position: relative;
        box-shadow: inset 0 0 0 1px rgba(255,255,255,0.08), 0 30px 60px -15px rgba(0,0,0,0.5);
    }

    .dynamic-island {
        position: absolute;
        top: 18px;
        left: 50%;
        transform: translateX(-50%);
        width: 100px;
        height: 28px;
        background: #0a0c10;
        border-radius: 20px;
        z-index: 20;
    }

    .iphone-screen {
        flex: 1;
        height: calc(100% - 10px);
        background: #0f1218;
        border-radius: calc(var(--phone-radius) - 10px);
        overflow: hidden;
        position: relative;
    }

    .screen-content {
        height: 100%;
        width: 100%;
        overflow-y: auto;
        overflow-x: hidden;
        scrollbar-width: none;
        -ms-overflow-style: none;
        -webkit-overflow-scrolling: touch;
        border-radius: calc(var(--phone-radius) - 10px);
    }
    .screen-content::-webkit-scrollbar { display: none; }

    .home-indicator {
        position: absolute;
        bottom: 8px;
        left: 50%;
        transform: translateX(-50%);
        width: 36%;
        height: 4px;
        background: rgba(255,255,255,0.2);
        border-radius: 2px;
    }

    /* Preview content styles */
    .standard-preview-full {
        background: #0f1218;
        border-radius: calc(var(--phone-radius) - 10px);
        min-height: 100%;
        overflow: hidden;
    }
    .preview-hero { padding: 52px 20px 24px; text-align: center; border-radius: calc(var(--phone-radius) - 10px) calc(var(--phone-radius) - 10px) 0 0; }
    .preview-avatar { width: 72px; height: 72px; border-radius: 50%; background: linear-gradient(135deg, #6366f1, #8b5cf6); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 1.5rem; margin: 0 auto 12px; }
    .preview-name { font-size: 1.1rem; font-weight: 600; color: #f9fafb; margin: 0 0 4px 0; }
    .preview-title { font-size: 0.8rem; color: #d1d5db; margin: 0; }
    .preview-company { font-size: 0.7rem; color: #9ca3af; margin: 0; }
    .preview-actions { display: flex; justify-content: center; gap: 14px; padding: 16px 20px; }
    .action-btn { width: 44px; height: 44px; border-radius: 50%; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; font-size: 1rem; cursor: pointer; }
    .preview-section { padding: 18px 20px; border-top: 1px solid rgba(255,255,255,0.06); }
    .section-title { font-size: 0.75rem; font-weight: 600; color: #9ca3af; margin: 0 0 10px 0; text-transform: uppercase; }
    .section-text { font-size: 0.8rem; color: #e5e7eb; margin: 0; line-height: 1.6; }
    .contact-item { font-size: 0.75rem; color: #d1d5db; padding: 8px 0; }
    .link-btn { font-size: 0.75rem; color: #a5b4fc; padding: 12px 16px; background: rgba(99,102,241,0.1); border-radius: 12px; margin-bottom: 8px; }
    .scroll-hint { position: absolute; bottom: 12px; left: 50%; transform: translateX(-50%); font-size: 0.6rem; color: rgba(255,255,255,0.5); background: rgba(0,0,0,0.5); padding: 4px 10px; border-radius: 10px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PORTFOLIO PREVIEW FULL - Matches Public Card 1:1
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .portfolio-preview-full {
        display: block;
        background: linear-gradient(180deg, #0d0a1a 0%, #1a1035 30%, #2d1b4e 60%, #1a1035 100%);
        padding: 50px 16px 16px;
        padding-bottom: 40px;
        border-radius: calc(var(--phone-radius) - 10px);
        min-height: 100%;
    }
    
    /* Hero Section */
    .pp-hero {
        text-align: center;
        padding-bottom: 16px;
    }
    
    .pp-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: linear-gradient(135deg, #8B5CF6 0%, #A855F7 50%, #7C3AED 100%);
        border: 3px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.3), 0 0 30px rgba(139, 92, 246, 0.4);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 700;
        font-size: 1.75rem;
        margin: 0 auto 12px;
    }
    
    .pp-name {
        font-size: 1.25rem;
        font-weight: 700;
        color: #fff;
        margin: 0 0 4px;
    }
    
    .pp-title {
        font-size: 0.8rem;
        color: rgba(255,255,255,0.7);
        margin: 0 0 6px;
    }
    
    .pp-company {
        font-size: 0.7rem;
        color: rgba(255,255,255,0.5);
        margin: 0 0 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 4px;
    }
    
    .pp-company-icon {
        font-size: 0.65rem;
    }
    
    .pp-bio {
        font-size: 0.7rem;
        color: rgba(255,255,255,0.85);
        line-height: 1.5;
        margin: 0 0 12px;
        max-width: 280px;
        margin-left: auto;
        margin-right: auto;
    }
    
    /* Social Row */
    .pp-social-row {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin-bottom: 12px;
    }
    
    .pp-social-icon {
        width: 36px;
        height: 36px;
        border-radius: 10px;
        background: rgba(30, 20, 50, 0.9);
        border: 1px solid rgba(139, 92, 246, 0.25);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        color: rgba(255,255,255,0.9);
    }
    
    /* Status Chips */
    .pp-chips {
        display: flex;
        justify-content: center;
        gap: 4px;
        flex-wrap: nowrap;
        margin-bottom: 16px;
    }
    
    .pp-chip {
        display: inline-flex;
        align-items: center;
        gap: 3px;
        padding: 3px 8px;
        background: rgba(255,255,255,0.06);
        border-radius: 12px;
        font-size: 0.55rem;
        color: rgba(255,255,255,0.7);
        border: 1px solid rgba(255,255,255,0.08);
        white-space: nowrap;
    }
    
    .pp-chip-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: #22C55E;
        box-shadow: 0 0 6px rgba(34, 197, 94, 0.5);
    }
    
    /* Mi Trabajo Section */
    .pp-work-section {
        border-top: 1px solid rgba(139, 92, 246, 0.15);
        padding-top: 14px;
        margin-bottom: 14px;
    }
    
    .pp-section-title {
        font-size: 0.6rem;
        font-weight: 600;
        color: rgba(255,255,255,0.5);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin: 0 0 10px;
        text-align: center;
    }
    
    .pp-gallery-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
    }
    
    .pp-gallery-item {
        aspect-ratio: 1;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        overflow: hidden;
        background: rgba(30, 41, 59, 0.5);
    }
    
    .pp-gallery-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
        image-rendering: -webkit-optimize-contrast;
    }
    
    /* CTAs */
    .pp-cta-section {
        margin-bottom: 16px;
    }
    
    .pp-cta-primary {
        width: 100%;
        padding: 10px 16px;
        background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 50%, #7C3AED 100%);
        border: none;
        border-radius: 20px;
        color: white;
        font-size: 0.75rem;
        font-weight: 600;
        cursor: pointer;
        margin-bottom: 10px;
        box-shadow: 0 4px 16px rgba(139, 92, 246, 0.35);
    }
    
    .pp-cta-row {
        display: flex;
        gap: 6px;
    }
    
    .pp-cta-secondary {
        flex: 1;
        padding: 8px 10px;
        border-radius: 16px;
        border: 2px solid;
        background: transparent;
        font-size: 0.65rem;
        font-weight: 500;
        cursor: pointer;
    }
    
    .pp-whatsapp {
        border-color: #25D366;
        color: #25D366;
    }
    
    .pp-call {
        border-color: #8B5CF6;
        color: #A78BFA;
    }
    
    .pp-email {
        border-color: #F59E0B;
        color: #FBBF24;
    }
    
    /* Contact Form */
    .pp-form-section {
        border-top: 1px solid rgba(139, 92, 246, 0.15);
        padding-top: 14px;
    }
    
    .pp-form-title {
        font-size: 0.8rem;
        font-weight: 600;
        color: rgba(255,255,255,0.9);
        margin: 0 0 4px;
    }
    
    .pp-form-subtitle {
        font-size: 0.6rem;
        color: rgba(255,255,255,0.5);
        margin: 0 0 12px;
    }
    
    .pp-form-field {
        margin-bottom: 10px;
    }
    
    .pp-form-field label {
        display: block;
        font-size: 0.6rem;
        color: rgba(255,255,255,0.7);
        margin-bottom: 4px;
    }
    
    .pp-input {
        padding: 8px 10px;
        background: rgba(25, 18, 45, 0.8);
        border: 1px solid rgba(139, 92, 246, 0.2);
        border-radius: 8px;
        font-size: 0.65rem;
        color: rgba(255,255,255,0.6);
    }
    
    .pp-phone-row {
        display: flex;
        gap: 6px;
    }
    
    .pp-country-code {
        padding: 8px 10px;
        background: rgba(25, 18, 45, 0.8);
        border: 1px solid rgba(139, 92, 246, 0.2);
        border-radius: 8px;
        font-size: 0.6rem;
        color: rgba(255,255,255,0.7);
        white-space: nowrap;
    }
    
    .pp-phone-input {
        flex: 1;
    }
    
    .pp-textarea {
        padding: 8px 10px;
        background: rgba(25, 18, 45, 0.8);
        border: 1px solid rgba(139, 92, 246, 0.2);
        border-radius: 8px;
        font-size: 0.65rem;
        color: rgba(255,255,255,0.5);
        min-height: 40px;
    }
    
    .pp-submit-btn {
        width: 100%;
        padding: 10px 16px;
        background: linear-gradient(135deg, #14B8A6 0%, #0D9488 100%);
        border: none;
        border-radius: 10px;
        color: rgba(255,255,255,0.6);
        font-size: 0.7rem;
        font-weight: 600;
        cursor: pointer;
        margin-top: 8px;
    }
    
    /* Footer */
    .pp-footer {
        text-align: center;
        padding: 16px 0 8px;
        font-size: 0.55rem;
        color: rgba(255,255,255,0.4);
    }
    
    .pp-footer strong {
        color: rgba(255,255,255,0.6);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       DEFAULT/PERFIL PROFESIONAL PREVIEW - Matches Public Card Layout
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .default-preview-full {
        display: block;
        background: linear-gradient(180deg, #0d0a1a 0%, #1a1035 30%, #2d1b4e 60%, #1a1035 100%);
        padding: 50px 16px 16px;
        padding-bottom: 40px;
        border-radius: calc(var(--phone-radius) - 10px);
        min-height: 100%;
    }
    
    /* Hero Section */
    .dp-hero {
        text-align: center;
        padding-bottom: 16px;
    }
    
    .dp-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: linear-gradient(135deg, #8B5CF6 0%, #A855F7 50%, #7C3AED 100%);
        border: 3px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.3), 0 0 30px rgba(139, 92, 246, 0.4);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 700;
        font-size: 1.75rem;
        margin: 0 auto 12px;
    }
    
    .dp-name {
        font-size: 1.25rem;
        font-weight: 700;
        color: #fff;
        margin: 0 0 4px;
    }
    
    .dp-title {
        font-size: 0.8rem;
        color: rgba(255,255,255,0.7);
        margin: 0 0 6px;
    }
    
    .dp-company {
        font-size: 0.7rem;
        color: rgba(255,255,255,0.5);
        margin: 0 0 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 4px;
    }
    
    .dp-company-icon {
        font-size: 0.65rem;
    }
    
    .dp-bio {
        font-size: 0.7rem;
        color: rgba(255,255,255,0.85);
        line-height: 1.5;
        margin: 0 0 12px;
        max-width: 280px;
        margin-left: auto;
        margin-right: auto;
    }
    
    /* Social Row */
    .dp-social-row {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin-bottom: 12px;
    }
    
    .dp-social-icon {
        width: 36px;
        height: 36px;
        border-radius: 10px;
        background: rgba(30, 20, 50, 0.9);
        border: 1px solid rgba(139, 92, 246, 0.25);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        color: rgba(255,255,255,0.9);
    }
    
    /* Status Chips */
    .dp-chips {
        display: flex;
        justify-content: center;
        gap: 4px;
        flex-wrap: nowrap;
        margin-bottom: 16px;
    }
    
    .dp-chip {
        display: inline-flex;
        align-items: center;
        gap: 3px;
        padding: 3px 8px;
        background: rgba(255,255,255,0.06);
        border-radius: 12px;
        font-size: 0.55rem;
        color: rgba(255,255,255,0.7);
        border: 1px solid rgba(255,255,255,0.08);
        white-space: nowrap;
    }
    
    .dp-chip-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: #22C55E;
        box-shadow: 0 0 6px rgba(34, 197, 94, 0.5);
    }
    
    /* CTAs */
    .dp-cta-section {
        margin-bottom: 16px;
    }
    
    .dp-cta-primary {
        width: 100%;
        padding: 10px 16px;
        background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 50%, #7C3AED 100%);
        border: none;
        border-radius: 20px;
        color: white;
        font-size: 0.75rem;
        font-weight: 600;
        cursor: pointer;
        margin-bottom: 10px;
        box-shadow: 0 4px 16px rgba(139, 92, 246, 0.35);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
    }
    
    .dp-cta-row {
        display: flex;
        gap: 6px;
    }
    
    .dp-cta-secondary {
        flex: 1;
        padding: 8px 10px;
        border-radius: 16px;
        border: 2px solid;
        background: transparent;
        font-size: 0.65rem;
        font-weight: 500;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 4px;
    }
    
    .dp-whatsapp {
        border-color: #25D366;
        color: #25D366;
    }
    
    .dp-call {
        border-color: #8B5CF6;
        color: #A78BFA;
    }
    
    .dp-email {
        border-color: #F59E0B;
        color: #FBBF24;
    }
    
    /* Contact Form */
    .dp-form-section {
        border-top: 1px solid rgba(139, 92, 246, 0.15);
        padding-top: 14px;
    }
    
    .dp-form-title {
        font-size: 0.8rem;
        font-weight: 600;
        color: rgba(255,255,255,0.9);
        margin: 0 0 4px;
    }
    
    .dp-form-subtitle {
        font-size: 0.6rem;
        color: rgba(255,255,255,0.5);
        margin: 0 0 12px;
    }
    
    .dp-form-field {
        margin-bottom: 10px;
    }
    
    .dp-form-field label {
        display: block;
        font-size: 0.6rem;
        color: rgba(255,255,255,0.7);
        margin-bottom: 4px;
    }
    
    .dp-input {
        padding: 8px 10px;
        background: rgba(25, 18, 45, 0.8);
        border: 1px solid rgba(139, 92, 246, 0.2);
        border-radius: 8px;
        font-size: 0.65rem;
        color: rgba(255,255,255,0.6);
    }
    
    .dp-phone-row {
        display: flex;
        gap: 6px;
    }
    
    .dp-country-code {
        padding: 8px 10px;
        background: rgba(25, 18, 45, 0.8);
        border: 1px solid rgba(139, 92, 246, 0.2);
        border-radius: 8px;
        font-size: 0.6rem;
        color: rgba(255,255,255,0.7);
        white-space: nowrap;
    }
    
    .dp-phone-input {
        flex: 1;
    }
    
    .dp-textarea {
        padding: 8px 10px;
        background: rgba(25, 18, 45, 0.8);
        border: 1px solid rgba(139, 92, 246, 0.2);
        border-radius: 8px;
        font-size: 0.65rem;
        color: rgba(255,255,255,0.5);
        min-height: 40px;
    }
    
    .dp-submit-btn {
        width: 100%;
        padding: 10px 16px;
        background: linear-gradient(135deg, #14B8A6 0%, #0D9488 100%);
        border: none;
        border-radius: 10px;
        color: rgba(255,255,255,0.6);
        font-size: 0.7rem;
        font-weight: 600;
        cursor: pointer;
        margin-top: 8px;
    }
    
    /* Footer */
    .dp-footer {
        text-align: center;
        padding: 16px 0 8px;
        font-size: 0.55rem;
        color: rgba(255,255,255,0.4);
    }
    
    .dp-footer strong {
        color: rgba(255,255,255,0.6);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SERVICES & QUOTES TEMPLATE PREVIEW
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .services-preview-full {
        display: block;
        background: linear-gradient(180deg, #0f171e 0%, #0d2528 30%, #134e4a 60%, #0d2528 100%);
        padding: 50px 16px 16px;
        padding-bottom: 40px;
        border-radius: calc(var(--phone-radius) - 10px);
        min-height: 100%;
    }
    
    /* Hero Section */
    .sp-hero {
        text-align: center;
        padding-bottom: 14px;
    }
    
    .sp-avatar {
        width: 70px;
        height: 70px;
        border-radius: 50%;
        background: linear-gradient(135deg, #14B8A6 0%, #0D9488 50%, #0891B2 100%);
        border: 3px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.3), 0 0 30px rgba(20, 184, 166, 0.4);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 700;
        font-size: 1.5rem;
        margin: 0 auto 10px;
    }
    
    .sp-name {
        font-size: 1.15rem;
        font-weight: 700;
        color: #fff;
        margin: 0 0 4px;
    }
    
    .sp-title {
        font-size: 0.75rem;
        color: rgba(255,255,255,0.7);
        margin: 0 0 4px;
    }
    
    .sp-company {
        font-size: 0.65rem;
        color: rgba(255,255,255,0.5);
        margin: 0;
    }
    
    /* Services Section */
    .sp-services-section {
        margin-top: 12px;
        padding: 12px 0;
        border-top: 1px solid rgba(20, 184, 166, 0.15);
    }
    
    .sp-section-title {
        font-size: 0.65rem;
        font-weight: 600;
        color: rgba(255, 255, 255, 0.5);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin: 0 0 10px;
    }
    
    .sp-services-list {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    
    .sp-service-card {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 12px;
        background: rgba(20, 184, 166, 0.08);
        border: 1px solid rgba(20, 184, 166, 0.2);
        border-radius: 10px;
    }
    
    .sp-service-icon {
        font-size: 1.1rem;
    }
    
    .sp-service-info {
        display: flex;
        flex-direction: column;
        gap: 2px;
    }
    
    .sp-service-name {
        font-size: 0.7rem;
        font-weight: 600;
        color: rgba(255, 255, 255, 0.9);
    }
    
    .sp-service-meta {
        font-size: 0.55rem;
        color: rgba(255, 255, 255, 0.5);
    }
    
    /* Booking CTAs */
    .sp-cta-section {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-top: 14px;
    }
    
    .sp-cta-primary {
        width: 100%;
        padding: 10px 16px;
        border-radius: 10px;
        border: none;
        font-size: 0.75rem;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
    }
    
    .sp-book {
        background: linear-gradient(135deg, #14B8A6 0%, #0D9488 100%);
        color: white;
        box-shadow: 0 4px 14px rgba(20, 184, 166, 0.3);
    }
    
    .sp-cta-secondary {
        width: 100%;
        padding: 9px 16px;
        border-radius: 10px;
        border: 2px solid rgba(20, 184, 166, 0.4);
        background: transparent;
        color: #5EEAD4;
        font-size: 0.7rem;
        font-weight: 500;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
    }
    
    /* Contact Section */
    .sp-contact-section {
        margin-top: 14px;
        padding: 10px 0;
        border-top: 1px solid rgba(20, 184, 166, 0.15);
        display: flex;
        flex-direction: column;
        gap: 6px;
    }
    
    .sp-contact-item {
        font-size: 0.6rem;
        color: rgba(255, 255, 255, 0.6);
    }
    
    /* Footer */
    .sp-footer {
        text-align: center;
        padding: 12px 0 8px;
        font-size: 0.55rem;
        color: rgba(255,255,255,0.4);
    }
    
    .sp-footer strong {
        color: rgba(255,255,255,0.6);
    }


    /* Labels */
    .item-label { display: flex; flex-direction: column; align-items: center; gap: 6px; margin-top: 16px; }
    .item-name { font-size: 1rem; font-weight: 600; color: #f3f4f6; }
    .carousel-item:not(.carousel-item--active) .item-name { color: #9ca3af; }
    .selected-badge { font-size: 0.7rem; color: #a5b4fc; background: rgba(99,102,241,0.15); padding: 5px 12px; border-radius: 14px; }

    /* Navigation arrows */
    .nav-arrow { position: absolute; top: 50%; transform: translateY(-50%); width: 44px; height: 44px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.03); color: #6b7280; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 180ms; z-index: 60; }
    .nav-arrow:hover { background: rgba(255,255,255,0.08); color: #f3f4f6; }
    .nav-arrow--left { left: 16px; }
    .nav-arrow--right { right: 16px; }

    /* Decision dock */
    .decision-dock { padding: 16px 32px 20px; }
    .dock-content { display: flex; align-items: center; justify-content: center; gap: 36px; padding: 16px 28px; background: rgba(18,24,32,0.9); border: 1px solid rgba(255,255,255,0.06); border-radius: 20px; backdrop-filter: blur(16px); max-width: 720px; margin: 0 auto; }
    .dock-info { display: flex; flex-direction: column; min-width: 160px; }
    .dock-name { font-size: 1.1rem; font-weight: 600; color: #f3f4f6; }
    .dock-desc { font-size: 0.825rem; color: #9ca3af; }
    .dock-dots { display: flex; gap: 10px; }
    .dot { width: 10px; height: 10px; border-radius: 50%; border: none; background: rgba(255,255,255,0.12); cursor: pointer; padding: 0; transition: all 220ms; }
    .dot--active { background: #6366f1; width: 28px; border-radius: 6px; }
    .cta-primary { display: flex; align-items: center; gap: 8px; padding: 13px 26px; border-radius: 26px; border: none; background: linear-gradient(135deg, #6366f1, #8b5cf6); color: #fff; font-size: 0.875rem; font-weight: 600; cursor: pointer; transition: all 200ms; }
    .cta-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(99,102,241,0.35); }

    /* Reduced motion */
    @@media (prefers-reduced-motion: reduce) {
        .carousel-item { transition: opacity 200ms ease, transform 200ms ease; }
        .nav-next .carousel-item--active, .nav-prev .carousel-item--active { animation: none; }
    }

    /* Responsive */
    @@media (max-width: 900px) {
        .templates-module { padding: 70px 16px 20px; --phone-width: clamp(200px, 50vw, 260px); --phone-height: clamp(420px, 55vh, 520px); }
        .carousel-section { padding: 0 48px; }
        .dock-content { gap: 20px; padding: 14px 20px; flex-wrap: wrap; }
    }
</style>

@code {
    private class TemplateData
    {
        public Guid Id { get; init; } = Guid.NewGuid();
        public required string Name { get; init; }
        public required string Description { get; init; }
        public required string HeroGradient { get; init; }
        public bool IsPortfolio { get; init; } = false;
        public bool IsDefault { get; init; } = false;
        public bool IsServices { get; init; } = false;
        public string TemplateType { get; init; } = "default";
    }

    // User data for portfolio preview
    private DataTouch.Domain.Entities.Card? _userCard;

    private int _activeIndex = 0; // Start at Perfil Profesional (first template)
    private bool _hasScrolled = false;
    private string _navDirection = "";
    private DateTime _lastNavTime = DateTime.MinValue;
    private readonly int[] _visiblePositions = { -2, -1, 0, 1, 2 };

    protected override async Task OnInitializedAsync()
    {
        // Load authenticated user's card data
        var email = AuthService.GetCurrentEmail();
        if (!string.IsNullOrEmpty(email))
        {
            _userCard = await DbContext.Cards
                .Include(c => c.Organization)
                .FirstOrDefaultAsync(c => c.Email == email);
        }
    }

    private string GetUserDisplayName()
    {
        // Priority: FullName > Email username > "Tu Nombre"
        if (!string.IsNullOrEmpty(_userCard?.FullName))
            return _userCard.FullName;
        
        var email = AuthService.GetCurrentEmail();
        if (!string.IsNullOrEmpty(email))
        {
            var atIndex = email.IndexOf('@');
            if (atIndex > 0)
                return email.Substring(0, atIndex);
        }
        
        return "Tu Nombre";
    }

    private string GetUserInitials()
    {
        var name = GetUserDisplayName();
        if (string.IsNullOrEmpty(name) || name == "Tu Nombre")
            return "TN";
        
        var parts = name.Split(' ', StringSplitOptions.RemoveEmptyEntries);
        if (parts.Length >= 2)
            return $"{parts[0][0]}{parts[1][0]}".ToUpper();
        
        return name.Length >= 2 ? name.Substring(0, 2).ToUpper() : name.ToUpper();
    }

    private readonly List<TemplateData> _templates = new()
    {
        new() { Name = "Perfil Profesional", Description = "Perfil con acciones rÃ¡pidas y formulario de contacto.", HeroGradient = "linear-gradient(180deg, #0d0a1a 0%, #1a1035 30%, #2d1b4e 60%, #1a1035 100%)", IsDefault = true, TemplateType = "default" },
        new() { Name = "Portafolio Creativo", Description = "GalerÃ­a visual para creativos y artistas.", HeroGradient = "linear-gradient(135deg, #8B5CF6, #EC4899)", IsPortfolio = true, TemplateType = "portfolio-creative" },
        new() { Name = "Servicios y Cotizaciones", Description = "Ofrece servicios, cotiza y agenda citas en lÃ­nea.", HeroGradient = "linear-gradient(135deg, #14B8A6, #0891B2)", IsServices = true, TemplateType = "services-quotes" },
        new() { Name = "Creative", Description = "Stand out with modern designs.", HeroGradient = "linear-gradient(135deg, #ec4899, #f97316)", TemplateType = "creative" },
        new() { Name = "Minimal", Description = "Clean and distraction-free.", HeroGradient = "linear-gradient(135deg, #6b7280, #4b5563)", TemplateType = "minimal" },
        new() { Name = "Professional", Description = "Best for sales and enterprise.", HeroGradient = "linear-gradient(135deg, #6366f1, #8b5cf6)", TemplateType = "professional" },
        new() { Name = "Corporate", Description = "Strong branding presence.", HeroGradient = "linear-gradient(135deg, #0ea5e9, #3b82f6)", TemplateType = "corporate" }
    };

    private TemplateData? SelectedTemplate => _templates.Count > 0 ? _templates[_activeIndex] : null;

    private int WrapIndex(int index) { var c = _templates.Count; return ((index % c) + c) % c; }
    private TemplateData GetTemplateAt(int pos) => _templates[WrapIndex(_activeIndex + pos)];
    private string GetStateClass(int pos) => pos switch { 0 => "carousel-item--active", -1 => "carousel-item--adjacent-left", 1 => "carousel-item--adjacent-right", -2 => "carousel-item--far-left", 2 => "carousel-item--far-right", _ => "" };
    private string GetItemStyle(int pos) => $"z-index: {pos switch { 0 => 50, -1 or 1 => 30, _ => 15 }};";

    private async Task NavigateNext()
    {
        if (IsThrottled()) return;
        _navDirection = "nav-next";
        _activeIndex = WrapIndex(_activeIndex + 1);
        StateHasChanged();
        await Task.Delay(750);
        _navDirection = "";
    }

    private async Task NavigatePrev()
    {
        if (IsThrottled()) return;
        _navDirection = "nav-prev";
        _activeIndex = WrapIndex(_activeIndex - 1);
        StateHasChanged();
        await Task.Delay(750);
        _navDirection = "";
    }

    private void GoToIndex(int idx) { if (idx != _activeIndex) { _navDirection = idx > _activeIndex ? "nav-next" : "nav-prev"; _activeIndex = WrapIndex(idx); } }
    private void HandleCardClick(int pos) { if (pos > 0) _ = NavigateNext(); else if (pos < 0) _ = NavigatePrev(); }
    private bool IsThrottled() { var now = DateTime.Now; if ((now - _lastNavTime).TotalMilliseconds < 700) return true; _lastNavTime = now; return false; }
    private async Task HandleKeyDown(KeyboardEventArgs e) { if (e.Key == "ArrowRight") await NavigateNext(); else if (e.Key == "ArrowLeft") await NavigatePrev(); else if (e.Key == "Enter" || e.Key == " ") UseThisDesign(); }
    private void OnScreenScroll() { if (!_hasScrolled) { _hasScrolled = true; StateHasChanged(); } }
    private void HandleWheel(WheelEventArgs e) { }
    private void UseThisDesign() { if (SelectedTemplate != null) { Snackbar.Add($"âœ“ DiseÃ±o seleccionado: {SelectedTemplate.Name}", Severity.Success); Navigation.NavigateTo($"/cards/mine?template={SelectedTemplate.TemplateType}"); } }
}
